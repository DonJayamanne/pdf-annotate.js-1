{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 59e89cdaf93308c40d35","webpack:///./index.js","webpack:///./src/PDFJSAnnotate.js","webpack:///./src/adapter/StoreAdapter.js","webpack:///./src/utils/abstractFunction.js","webpack:///./src/UI/event.js","webpack:///./~/events/events.js","webpack:///./src/UI/utils.js","webpack:///./~/create-stylesheet/index.js","webpack:///./src/render/appendChild.js","webpack:///./~/object-assign/index.js","webpack:///./src/render/renderLine.js","webpack:///./src/utils/setAttributes.js","webpack:///./src/utils/normalizeColor.js","webpack:///./src/render/renderPath.js","webpack:///./src/render/renderPoint.js","webpack:///./src/render/renderRect.js","webpack:///./src/render/renderText.js","webpack:///./src/render/renderCircle.js","webpack:///./src/render/renderArrow.js","webpack:///./src/utils/mathUtils.js","webpack:///./src/adapter/LocalStoreAdapter.js","webpack:///./src/utils/uuid.js","webpack:///./src/render/index.js","webpack:///./src/a11y/renderScreenReaderHints.js","webpack:///./src/a11y/insertScreenReaderHint.js","webpack:///./src/a11y/createScreenReaderOnly.js","webpack:///./src/a11y/insertElementWithinChildren.js","webpack:///./src/config.js","webpack:///./src/a11y/insertElementWithinElement.js","webpack:///./src/a11y/renderScreenReaderComments.js","webpack:///./src/a11y/insertScreenReaderComment.js","webpack:///./src/a11y/initEventHandlers.js","webpack:///./src/UI/index.js","webpack:///./src/UI/edit.js","webpack:///./src/UI/pen.js","webpack:///./src/UI/eraser.js","webpack:///./src/UI/arrow.js","webpack:///./src/UI/point.js","webpack:///./src/UI/rect.js","webpack:///./src/UI/circle.js","webpack:///./src/UI/text.js","webpack:///./src/UI/page.js"],"names":["PDFJSAnnotate","findAnnotationAtPoint","findSVGContainer","convertToScreenPoint","StoreAdapter","LocalStoreAdapter","__storeAdapter","getStoreAdapter","setStoreAdapter","adapter","UI","render","getAnnotations","documentId","userId","pageNumber","arguments","config","uuid","definition","Object","keys","forEach","key","annotationId","annotation","content","commentId","__getAnnotations","fn","then","annotations","a","__addAnnotation","addAnnotation","__editAnnotation","editAnnotation","__deleteAnnotation","deleteAnnotation","success","__addComment","addComment","comment","__deleteComment","deleteComment","abstractFunction","name","Error","fireEvent","addEventListener","removeEventListener","emitter","EventEmitter","clickNode","document","handleDocumentClick","e","clientX","clientY","target","emit","on","removeListener","findSVGAtPoint","pointIntersectsRect","getOffsetAnnotationRect","scaleUp","convertToSvgRect","convertToSvgPoint","scaleDown","getScroll","getOffset","disableUserSelect","enableUserSelect","getMetadata","BORDER_COLOR","userSelectStyleSheet","body","setAttribute","node","parentNode","nodeName","toUpperCase","getAttribute","x","y","elements","querySelectorAll","i","l","length","el","rect","getBoundingClientRect","candidate","elementFromPoint","type","top","bottom","left","right","offsetLeft","offsetTop","width","height","svg","result","viewport","scale","pt1","pt2","Math","min","abs","pt","xform","rotation","offset","scrollTop","scrollLeft","head","appendChild","removeChild","parseInt","JSON","parse","getTranslation","transformChild","isFirefox","test","navigator","userAgent","transform","trans","toLowerCase","path","querySelector","n","child","renderLine","group","createElementNS","stroke","color","strokeWidth","rectangles","r","line","x1","y1","x2","y2","setAttributes","UPPER_REGEX","BLACKLIST","keyCase","indexOf","replace","match","attributes","normalizeColor","REGEX_HASHLESS_HEX","renderPath","d","lines","p1","p2","push","join","fill","renderPoint","SIZE","D","outerSVG","innerSVG","viewBox","renderRect","fillOpacity","createRect","renderText","text","fontSize","size","innerHTML","g","renderCircle","circle","createCircle","cx","cy","renderArrow","arrow","arrowLength","pt0","unitX","unitZ","unitY","thickness","A","B","C","G","F","E","points","applyTransform","applyInverseTransform","translate","rotate","makePoint","makeVector","makeVectorFromPoints","addVector","multiplyVector","magnitude","negateVector","unitVector","crossProduct","p","m","xt","yt","m1","m2","angle","PI","cosValue","cos","sinValue","sin","getInverseTransform","z","xcoord","ycoord","zcoord","v","scalar","sqrt","pow","mag","u","Promise","resolve","reject","getAllAnnotations","filter","page","class","getAnnotation","findAnnotation","updateAnnotations","index","splice","getComments","_userId","all_annotations","localStorage","includes","getItem","setItem","stringify","REGEXP","PATTERN","replacement","c","random","toString","data","removeAttribute","Array","isArray","renderScreenReaderHints","SORT_TYPES","sortBy","sort","sortByPoint","b","sortByRectPoint","sortByLinePoint","lineA","lineB","insertScreenReaderHint","COMMENT_TYPES","num","rects","first","last","createScreenReaderOnly","createElement","createTextNode","style","position","overflow","insertElementWithinChildren","nodes","textClassQuery","insertBefore","textLayer","textRect","annotationLayerName","textLayerName","annotationSvgQuery","annotationClassQuery","insertElementWithinElement","OFFSET_ADJUST","max","textLayerElementFromPoint","temp","cloneNode","split","tail","unshift","pop","outerHTML","renderScreenReaderComments","comments","promise","getElementById","list","insertScreenReaderComment","item","initEventHandlers","reorderAnnotationsByType","removeAnnotation","insertComment","removeComment","removeElementById","elementId","disableEdit","enableEdit","disablePen","enablePen","setPen","enableEraser","disableEraser","disablePoint","enablePoint","disableRect","enableRect","disableCircle","enableCircle","setCircle","addCircle","disableArrow","enableArrow","setArrow","disableText","enableText","setText","createPage","renderPage","_enabled","isDragging","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","OVERLAY_BORDER_SIZE","createEditOverlay","destroyEditOverlay","anchor","id","styleLeft","styleTop","boxSizing","border","borderRadius","zIndex","background","padding","textAlign","textDecoration","handleDocumentKeyup","handleDocumentMousedown","borderColor","boxShadow","display","handleDocumentMousemove","handleDocumentMouseup","keyCode","cursor","minY","maxY","minX","maxX","offsetHeight","offsetWidth","attribX","attribY","modelStart","modelEnd","modelDelta","firstChild","t","modelX","modelY","viewY","viewX","setTimeout","handleAnnotationClick","_candraw","_penSize","_penColor","handleDocumentPointerdown","preventDefault","handleDocumentPointerupChrome","saveToStorage","changedTouches","handleDocumentPointerup","handleDocumentPointermove","srcElement","classList","contains","savePoint","handleDocumentPointermoveChrome","point","toFixed","penSize","penColor","_canerase","handleDocumentDown","handleDocumentUp","handleDocumentTouchMove","erase","handleDocumentMouseMove","parentElement","originY","originX","event","input","handleInputBlur","handleInputKeyup","focus","closeInput","value","trim","assign","_type","getSelectionRects","selection","window","getSelection","range","getRangeAt","getClientRects","saveRect","map","removeAllRanges","boundingRect","_circleRadius","_circleColor","circleRadius","circleColor","saveCircle","radius","svg_pt","oldType","_textSize","_textColor","saveText","textSize","textColor","PAGE_TEMPLATE","children","canvas","mozOpaque","renderOptions","pdfDocument","all","getPage","pdfPage","canvasContext","getContext","alpha","totalRotation","getViewport","scalePage","getTextContent","normalizeWhitespace","textContent","textLayerFactory","PDFJS","DefaultTextLayerFactory","textLayerBuilder","createTextLayerBuilder","setTextContent","context","wrapper","outputScale","getOutputScale","scaled","sx","sy","sfx","approximateFraction","sfy","visibility","roundToDivide","floor","xinv","limit","x_","q","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","div","round"],"mappings":"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AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB,QAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA,gBAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,IAAG;AACH,qBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,MAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;;;;;;SChRgBd,gB,GAAAA,gB;SAqBA6D,c,GAAAA,c;SAyBA9D,qB,GAAAA,qB;SAqBA+D,mB,GAAAA,mB;SAUAC,uB,GAAAA,uB;SAoBAC,O,GAAAA,O;SAWAC,gB,GAAAA,gB;SAeAC,iB,GAAAA,iB;SAcAjE,oB,GAAAA,oB;SAqBAkE,S,GAAAA,S;SAiBAC,S,GAAAA,S;SAoBAC,S,GAAAA,S;SAkBAC,iB,GAAAA,iB;SAUAC,gB,GAAAA,gB;SAWAC,W,GAAAA,W;;AAvQhB;;;;AACA;;AACA;;;;AASO,KAAMC,sCAAe,SAArB;;AAEP,KAAMC,uBAAuB,gCAAiB;AAC5CC,SAAM;AACJ,4BAAuB,MADnB;AAED,yBAAoB,MAFnB;AAGA,wBAAmB,MAHnB;AAII,oBAAe;AAJnB;AADsC,EAAjB,CAA7B;AAQAD,sBAAqBE,YAArB,CAAkC,+BAAlC,EAAmE,MAAnE;;AAEA;;;;;;AAMO,UAAS5E,gBAAT,CAA0B6E,IAA1B,EAAgC;AACrC,OAAIC,aAAaD,IAAjB;;AAEA,UAAO,CAACC,aAAaA,WAAWA,UAAzB,KACCA,eAAe1B,QADvB,EACiC;AAC/B,SAAI0B,WAAWC,QAAX,CAAoBC,WAApB,OAAsC,KAAtC,IACAF,WAAWG,YAAX,CAAwB,6BAAxB,MAA2D,MAD/D,EACuE;AACrE,cAAOH,UAAP;AACD;AACF;;AAED,UAAO,IAAP;AACD;;AAED;;;;;;;AAOO,UAASjB,cAAT,CAAwBqB,CAAxB,EAA2BC,CAA3B,EAA8B;AACnC,OAAIC,WAAWhC,SAASiC,gBAAT,CAA0B,yCAA1B,CAAf;;AAEA,QAAK,IAAIC,IAAE,CAAN,EAASC,IAAEH,SAASI,MAAzB,EAAiCF,IAAEC,CAAnC,EAAsCD,GAAtC,EAA2C;AACzC,SAAIG,KAAKL,SAASE,CAAT,CAAT;AACA,SAAII,OAAOD,GAAGE,qBAAH,EAAX;;AAEA,SAAI7B,oBAAoBoB,CAApB,EAAuBC,CAAvB,EAA0BO,IAA1B,CAAJ,EAAqC;AACnC,cAAOD,EAAP;AACD;AACF;;AAED,UAAO,IAAP;AACD;;AAED;;;;;;;;;;AAUO,UAAS1F,qBAAT,CAA+BmF,CAA/B,EAAkCC,CAAlC,EAAqC;AAC1C,OAAIM,KAAK,IAAT;AACA,OAAIG,YAAYxC,SAASyC,gBAAT,CAA0BX,CAA1B,EAA6BC,CAA7B,CAAhB;AACA,UAAO,CAACM,EAAD,IAAOG,SAAP,IAAoBA,cAAcxC,QAAzC,EAAmD;AACjD,SAAI0C,OAAOF,UAAUX,YAAV,CAAuB,wBAAvB,CAAX;AACA,SAAIa,IAAJ,EAAU;AACRL,YAAKG,SAAL;AACD;AACDA,iBAAYA,UAAUd,UAAtB;AACD;AACD,UAAOW,EAAP;AACD;;AAED;;;;;;;;AAQO,UAAS3B,mBAAT,CAA6BoB,CAA7B,EAAgCC,CAAhC,EAAmCO,IAAnC,EAAyC;AAC9C,UAAOP,KAAKO,KAAKK,GAAV,IAAiBZ,KAAKO,KAAKM,MAA3B,IAAqCd,KAAKQ,KAAKO,IAA/C,IAAuDf,KAAKQ,KAAKQ,KAAxE;AACD;;AAED;;;;;;AAMO,UAASnC,uBAAT,CAAiC0B,EAAjC,EAAqC;AAC1C,OAAIC,OAAOD,GAAGE,qBAAH,EAAX;;AAD0C,oBAEVtB,UAAUoB,EAAV,CAFU;AAAA,OAEpCU,UAFoC,cAEpCA,UAFoC;AAAA,OAExBC,SAFwB,cAExBA,SAFwB;;AAG1C,UAAO;AACLL,UAAKL,KAAKK,GAAL,GAAWK,SADX;AAELH,WAAMP,KAAKO,IAAL,GAAYE,UAFb;AAGLD,YAAOR,KAAKQ,KAAL,GAAaC,UAHf;AAILH,aAAQN,KAAKM,MAAL,GAAcI,SAJjB;AAKLC,YAAOX,KAAKW,KALP;AAMLC,aAAQZ,KAAKY;AANR,IAAP;AAQD;;AAED;;;;;;;AAOO,UAAStC,OAAT,CAAiBuC,GAAjB,EAAsBb,IAAtB,EAA4B;AACjC,OAAIc,SAAS,EAAb;;AADiC,sBAEdhC,YAAY+B,GAAZ,CAFc;AAAA,OAE3BE,QAF2B,gBAE3BA,QAF2B;;AAIjCvF,UAAOC,IAAP,CAAYuE,IAAZ,EAAkBtE,OAAlB,CAA0B,UAACC,GAAD,EAAS;AACjCmF,YAAOnF,GAAP,IAAcqE,KAAKrE,GAAL,IAAYoF,SAASC,KAAnC;AACD,IAFD;;AAIA,UAAOF,MAAP;AACD;;AAEM,UAASvC,gBAAT,CAA0ByB,IAA1B,EAAgCa,GAAhC,EAAqCE,QAArC,EAA+C;AACpD,OAAIE,MAAM,CAACjB,KAAKR,CAAN,EAASQ,KAAKP,CAAd,CAAV;AACA,OAAIyB,MAAM,CAAClB,KAAKR,CAAL,GAASQ,KAAKW,KAAf,EAAsBX,KAAKP,CAAL,GAASO,KAAKY,MAApC,CAAV;;AAEAK,SAAMzC,kBAAkByC,GAAlB,EAAuBJ,GAAvB,EAA4BE,QAA5B,CAAN;AACAG,SAAM1C,kBAAkB0C,GAAlB,EAAuBL,GAAvB,EAA4BE,QAA5B,CAAN;;AAEA,UAAO;AACLvB,QAAG2B,KAAKC,GAAL,CAASH,IAAI,CAAJ,CAAT,EAAiBC,IAAI,CAAJ,CAAjB,CADE;AAELzB,QAAG0B,KAAKC,GAAL,CAASH,IAAI,CAAJ,CAAT,EAAiBC,IAAI,CAAJ,CAAjB,CAFE;AAGLP,YAAOQ,KAAKE,GAAL,CAASH,IAAI,CAAJ,IAASD,IAAI,CAAJ,CAAlB,CAHF;AAILL,aAAQO,KAAKE,GAAL,CAASH,IAAI,CAAJ,IAASD,IAAI,CAAJ,CAAlB;AAJH,IAAP;AAMD;;AAEM,UAASzC,iBAAT,CAA2B8C,EAA3B,EAA+BT,GAA/B,EAAoCE,QAApC,EAA8C;AACnD,OAAID,SAAS,EAAb;AACAC,cAAWA,YAAYjC,YAAY+B,GAAZ,EAAiBE,QAAxC;;AAEA,OAAIQ,QAAQ,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAAZ;AACAA,WAAQ,sBAAMA,KAAN,EAAaR,SAASC,KAAtB,EAA6BD,SAASC,KAAtC,CAAR;AACAO,WAAQ,uBAAOA,KAAP,EAAcR,SAASS,QAAvB,CAAR;;AAEA,OAAIC,SAAS,iCAAeV,QAAf,CAAb;AACAQ,WAAQ,0BAAUA,KAAV,EAAiBE,OAAOjC,CAAxB,EAA2BiC,OAAOhC,CAAlC,CAAR;;AAEA,UAAO,sCAAsB6B,EAAtB,EAA0BC,KAA1B,CAAP;AACD;;AAEM,UAAShH,oBAAT,CAA8B+G,EAA9B,EAAkCT,GAAlC,EAAuCE,QAAvC,EAAiD;AACtD,OAAID,SAAS,EAAb;AACAC,cAAWA,YAAYjC,YAAY+B,GAAZ,EAAiBE,QAAxC;;AAEA,OAAIQ,QAAQ,CAAE,CAAF,EAAK,CAAL,EAAQ,CAAR,EAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAAZ;AACAA,WAAQ,sBAAMA,KAAN,EAAaR,SAASC,KAAtB,EAA6BD,SAASC,KAAtC,CAAR;AACAO,WAAQ,uBAAOA,KAAP,EAAcR,SAASS,QAAvB,CAAR;;AAEA,OAAIC,SAAS,iCAAeV,QAAf,CAAb;AACAQ,WAAQ,0BAAUA,KAAV,EAAiBE,OAAOjC,CAAxB,EAA2BiC,OAAOhC,CAAlC,CAAR;;AAEA,UAAO,+BAAe6B,EAAf,EAAmBC,KAAnB,CAAP;AACD;;AAED;;;;;;;AAOO,UAAS9C,SAAT,CAAmBoC,GAAnB,EAAwBb,IAAxB,EAA8B;AACnC,OAAIc,SAAS,EAAb;;AADmC,uBAEhBhC,YAAY+B,GAAZ,CAFgB;AAAA,OAE7BE,QAF6B,iBAE7BA,QAF6B;;AAInCvF,UAAOC,IAAP,CAAYuE,IAAZ,EAAkBtE,OAAlB,CAA0B,UAACC,GAAD,EAAS;AACjCmF,YAAOnF,GAAP,IAAcqE,KAAKrE,GAAL,IAAYoF,SAASC,KAAnC;AACD,IAFD;;AAIA,UAAOF,MAAP;AACD;;AAED;;;;;;AAMO,UAASpC,SAAT,CAAmBqB,EAAnB,EAAuB;AAC5B,OAAI2B,YAAY,CAAhB;AACA,OAAIC,aAAa,CAAjB;AACA,OAAIvC,aAAaW,EAAjB;;AAEA,UAAO,CAACX,aAAaA,WAAWA,UAAzB,KACCA,eAAe1B,QADvB,EACiC;AAC/BgE,kBAAatC,WAAWsC,SAAxB;AACAC,mBAAcvC,WAAWuC,UAAzB;AACD;;AAED,UAAO,EAAED,oBAAF,EAAaC,sBAAb,EAAP;AACD;;AAED;;;;;;AAMO,UAAShD,SAAT,CAAmBoB,EAAnB,EAAuB;AAC5B,OAAIX,aAAaW,EAAjB;;AAEA,UAAO,CAACX,aAAaA,WAAWA,UAAzB,KACCA,eAAe1B,QADvB,EACiC;AAC/B,SAAI0B,WAAWC,QAAX,CAAoBC,WAApB,OAAsC,KAA1C,EAAiD;AAC/C;AACD;AACF;;AAED,OAAIU,OAAOZ,WAAWa,qBAAX,EAAX;;AAEA,UAAO,EAAEQ,YAAYT,KAAKO,IAAnB,EAAyBG,WAAWV,KAAKK,GAAzC,EAAP;AACD;;AAED;;;AAGO,UAASzB,iBAAT,GAA6B;AAClC,OAAI,CAACI,qBAAqBI,UAA1B,EAAsC;AACpC1B,cAASkE,IAAT,CAAcC,WAAd,CAA0B7C,oBAA1B;AACD;AACF;;AAGD;;;AAGO,UAASH,gBAAT,GAA4B;AACjC,OAAIG,qBAAqBI,UAAzB,EAAqC;AACnCJ,0BAAqBI,UAArB,CAAgC0C,WAAhC,CAA4C9C,oBAA5C;AACD;AACF;;AAED;;;;;AAKO,UAASF,WAAT,CAAqB+B,GAArB,EAA0B;AAC/B,UAAO;AACL5F,iBAAY4F,IAAItB,YAAJ,CAAiB,4BAAjB,CADP;AAELrE,aAAQ2F,IAAItB,YAAJ,CAAiB,wBAAjB,CAFH;AAGLpE,iBAAY4G,SAASlB,IAAItB,YAAJ,CAAiB,wBAAjB,CAAT,EAAqD,EAArD,CAHP;AAILwB,eAAUiB,KAAKC,KAAL,CAAWpB,IAAItB,YAAJ,CAAiB,4BAAjB,CAAX;AAJL,IAAP;AAMD,E;;;;;;AC9QD;AACA;AACA;AACA;AACA,IAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA,wBAAuB,2CAA2C;AAClE;;AAEA;AACA;AACA;AACA,IAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA,6CAA4C;AAC5C;;AAEA;AACA;AACA;AACA,IAAG;AACH;;;;;;;;;;;;SChBgB2C,c,GAAAA,c;SA6FAL,W,GAAAA,W;SAwDAM,c,GAAAA,c;;AAvKhB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,KAAMC,YAAY,WAAWC,IAAX,CAAgBC,UAAUC,SAA1B,CAAlB;;AAEA;;;;;;;AAOO,UAASL,cAAT,CAAwBnB,QAAxB,EAAkC;AACvC,OAAIvB,UAAJ;AACA,OAAIC,UAAJ;;AAEA;AACA;AACA,WAAOsB,SAASS,QAAT,GAAoB,GAA3B;AACE,UAAK,CAAL;AACEhC,WAAIC,IAAI,CAAR;AACA;AACF,UAAK,EAAL;AACED,WAAI,CAAJ;AACAC,WAAKsB,SAASJ,KAAT,GAAiBI,SAASC,KAA3B,GAAoC,CAAC,CAAzC;AACA;AACF,UAAK,GAAL;AACExB,WAAKuB,SAASJ,KAAT,GAAiBI,SAASC,KAA3B,GAAoC,CAAC,CAAzC;AACAvB,WAAKsB,SAASH,MAAT,GAAkBG,SAASC,KAA5B,GAAqC,CAAC,CAA1C;AACA;AACF,UAAK,GAAL;AACExB,WAAKuB,SAASH,MAAT,GAAkBG,SAASC,KAA5B,GAAqC,CAAC,CAA1C;AACAvB,WAAI,CAAJ;AACA;AAfJ;;AAkBA,UAAO,EAAED,IAAF,EAAKC,IAAL,EAAP;AACD;;AAED;;;;;;;AAOA,UAAS+C,SAAT,CAAmBrD,IAAnB,EAAyB4B,QAAzB,EAAmC;AACjC,OAAI0B,QAAQP,eAAenB,QAAf,CAAZ;;AAEA;AACA5B,QAAKD,YAAL,CAAkB,WAAlB,aAAwC6B,SAASC,KAAjD,iBAAkED,SAASS,QAA3E,oBAAkGiB,MAAMjD,CAAxG,UAA8GiD,MAAMhD,CAApH;;AAEA;AACA,OAAI,CAAC2C,SAAD,IAAcjD,KAAKE,QAAL,CAAcqD,WAAd,OAAgC,KAAlD,EAAyD;AACvDvD,UAAKD,YAAL,CAAkB,GAAlB,EAAuB6C,SAAS5C,KAAKI,YAAL,CAAkB,GAAlB,CAAT,EAAiC,EAAjC,IAAuCwB,SAASC,KAAvE;AACA7B,UAAKD,YAAL,CAAkB,GAAlB,EAAuB6C,SAAS5C,KAAKI,YAAL,CAAkB,GAAlB,CAAT,EAAiC,EAAjC,IAAuCwB,SAASC,KAAvE;;AAEA,SAAIxB,IAAIuC,SAAS5C,KAAKI,YAAL,CAAkB,GAAlB,EAAuB,EAAvB,CAAT,CAAR;AACA,SAAIE,IAAIsC,SAAS5C,KAAKI,YAAL,CAAkB,GAAlB,EAAuB,EAAvB,CAAT,CAAR;AACA,SAAIoB,QAAQoB,SAAS5C,KAAKI,YAAL,CAAkB,OAAlB,CAAT,EAAqC,EAArC,CAAZ;AACA,SAAIqB,SAASmB,SAAS5C,KAAKI,YAAL,CAAkB,QAAlB,CAAT,EAAsC,EAAtC,CAAb;AACA,SAAIoD,OAAOxD,KAAKyD,aAAL,CAAmB,MAAnB,CAAX;AACA,SAAI/B,MAAM8B,KAAKvD,UAAf;;AAEA;AACA,MAACD,IAAD,EAAO0B,GAAP,EAAY8B,IAAZ,EAAkBxD,KAAKyD,aAAL,CAAmB,MAAnB,CAAlB,EAA8ClH,OAA9C,CAAsD,UAACmH,CAAD,EAAO;AAC3DA,SAAE3D,YAAF,CAAe,OAAf,EAAwB6C,SAASc,EAAEtD,YAAF,CAAe,OAAf,CAAT,EAAkC,EAAlC,IAAwCwB,SAASC,KAAzE;AACA6B,SAAE3D,YAAF,CAAe,QAAf,EAAyB6C,SAASc,EAAEtD,YAAF,CAAe,QAAf,CAAT,EAAmC,EAAnC,IAAyCwB,SAASC,KAA3E;AACD,MAHD;;AAKA;AACAwB,eAAUG,IAAV,EAAgB,4BAAa,EAAb,EAAiB5B,QAAjB,EAA2B,EAAEC,OAAO,CAAT,EAA3B,CAAhB;;AAEA,aAAOD,SAASS,QAAT,GAAoB,GAA3B;AACE,YAAK,EAAL;AACErC,cAAKD,YAAL,CAAkB,GAAlB,EAAuB6B,SAASJ,KAAT,GAAiBlB,CAAjB,GAAqBkB,KAA5C;AACAxB,cAAKD,YAAL,CAAkB,GAAlB,EAAuBM,CAAvB;AACAqB,aAAI3B,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA2B,aAAI3B,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AACF,YAAK,GAAL;AACEC,cAAKD,YAAL,CAAkB,GAAlB,EAAuB6B,SAASJ,KAAT,GAAiBnB,CAAjB,GAAqBmB,KAA5C;AACAxB,cAAKD,YAAL,CAAkB,GAAlB,EAAuB6B,SAASH,MAAT,GAAkBnB,CAAlB,GAAsBmB,MAA7C;AACAC,aAAI3B,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AACF,YAAK,GAAL;AACEC,cAAKD,YAAL,CAAkB,GAAlB,EAAuBO,CAAvB;AACAN,cAAKD,YAAL,CAAkB,GAAlB,EAAuB6B,SAASH,MAAT,GAAkBpB,CAAlB,GAAsBoB,MAA7C;AACAC,aAAI3B,YAAJ,CAAiB,GAAjB,EAAsB,CAAC,CAAvB;AACA2B,aAAI3B,YAAJ,CAAiB,GAAjB,EAAsB,CAAtB;AACA;AAjBJ;AAmBD;;AAED,UAAOC,IAAP;AACD;;AAED;;;;;;;;AAQO,UAAS0C,WAAT,CAAqBhB,GAArB,EAA0BhF,UAA1B,EAAsCkF,QAAtC,EAAgD;AACrD,OAAI,CAACA,QAAL,EAAe;AACbA,gBAAWiB,KAAKC,KAAL,CAAWpB,IAAItB,YAAJ,CAAiB,4BAAjB,CAAX,CAAX;AACD;;AAED,OAAIuD,cAAJ;AACA,WAAQjH,WAAWuE,IAAnB;AACE,UAAK,MAAL;AACA,UAAK,WAAL;AACE0C,eAAQ,0BAAWjH,UAAX,CAAR;AACA;AACF,UAAK,QAAL;AACA,UAAK,YAAL;AACA,UAAK,aAAL;AACEiH,eAAQ,4BAAajH,UAAb,CAAR;AACA;AACF,UAAK,WAAL;AACEiH,eAAQ,0BAAWjH,UAAX,CAAR;AACA;AACF,UAAK,OAAL;AACEiH,eAAQ,2BAAYjH,UAAZ,CAAR;AACA;AACF,UAAK,SAAL;AACEiH,eAAQ,0BAAWjH,UAAX,CAAR;AACA;AACF,UAAK,SAAL;AACEiH,eAAQ,0BAAWjH,UAAX,CAAR;AACA;AACF,UAAK,OAAL;AACEiH,eAAQ,2BAAYjH,UAAZ,CAAR;AACA;AAxBJ;;AA2BA;AACA;AACA,OAAIiH,KAAJ,EAAW;AACT;AACAA,WAAM5D,YAAN,CAAmB,sBAAnB,EAA2CrD,WAAWP,IAAtD;AACAwH,WAAM5D,YAAN,CAAmB,wBAAnB,EAA6CrD,WAAWuE,IAAxD;AACA0C,WAAM5D,YAAN,CAAmB,0BAAnB,EAA+CrD,WAAWX,MAA1D;AACA4H,WAAM5D,YAAN,CAAmB,aAAnB,EAAkC,IAAlC;;AAEA2B,SAAIgB,WAAJ,CAAgBW,UAAUM,KAAV,EAAiB/B,QAAjB,CAAhB;AACD;;AAED,UAAO+B,KAAP;AACD;;AAED;;;;;;;;AAQO,UAASX,cAAT,CAAwBtB,GAAxB,EAA6BiC,KAA7B,EAAoC/B,QAApC,EAA8C;AACnD,OAAI,CAACA,QAAL,EAAe;AACbA,gBAAWiB,KAAKC,KAAL,CAAWpB,IAAItB,YAAJ,CAAiB,4BAAjB,CAAX,CAAX;AACD;;AAED;AACA;AACA,OAAIuD,KAAJ,EAAW;AACTA,aAAQN,UAAUM,KAAV,EAAiB/B,QAAjB,CAAR;AACD;;AAED,UAAO+B,KAAP;AACD;;mBAEc;AACb;;;;AAIAZ,iCALa;;AAOb;;;AAGAL,2BAVa;;AAYb;;;AAGAM;AAfa,E;;;;;;ACrLf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA,iCAAgC;AAChC;AACA;AACA;AACA;;AAEA;AACA;AACA,kBAAiB,QAAQ;AACzB;AACA;AACA;AACA;AACA,IAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAG;AACH,mCAAkC;AAClC;AACA;AACA;;AAEA;AACA,GAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,iBAAgB,sBAAsB;AACtC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,mBAAkB,oBAAoB;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;mBC/EwBY,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoB3G,CAApB,EAAuB;AACpC,OAAI4G,QAAQtF,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,GAAvD,CAAZ;AACA,gCAAcD,KAAd,EAAqB;AACnBE,aAAQ,8BAAe9G,EAAE+G,KAAF,IAAW,MAA1B,CADW;AAEnBC,kBAAa;AAFM,IAArB;;AAKAhH,KAAEiH,UAAF,CAAa3H,OAAb,CAAqB,UAAC4H,CAAD,EAAO;AAC1B,SAAIC,OAAO7F,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,kCAAcM,IAAd,EAAoB;AAClBC,WAAIF,EAAE9D,CADY;AAElBiE,WAAIH,EAAE7D,CAFY;AAGlBiE,WAAIJ,EAAE9D,CAAF,GAAM8D,EAAE3C,KAHM;AAIlBgD,WAAIL,EAAE7D;AAJY,MAApB;;AAOAuD,WAAMnB,WAAN,CAAkB0B,IAAlB;AACD,IAXD;;AAaA,UAAOP,KAAP;AACD;;;;;;;;;;;;mBCXuBY,a;AApBxB,KAAMC,cAAc,QAApB;;AAEA;AACA,KAAMC,YAAY,CAChB,SADgB,CAAlB;;AAIA,KAAIC,UAAU,SAAVA,OAAU,CAACpI,GAAD,EAAS;AACrB,OAAImI,UAAUE,OAAV,CAAkBrI,GAAlB,MAA2B,CAAC,CAAhC,EAAmC;AACjCA,WAAMA,IAAIsI,OAAJ,CAAYJ,WAAZ,EAAyB;AAAA,cAAS,MAAMK,MAAMxB,WAAN,EAAf;AAAA,MAAzB,CAAN;AACD;AACD,UAAO/G,GAAP;AACD,EALD;;AAOA;;;;;;AAMe,UAASiI,aAAT,CAAuBzE,IAAvB,EAA6BgF,UAA7B,EAAyC;AACtD3I,UAAOC,IAAP,CAAY0I,UAAZ,EAAwBzI,OAAxB,CAAgC,UAACC,GAAD,EAAS;AACvCwD,UAAKD,YAAL,CAAkB6E,QAAQpI,GAAR,CAAlB,EAAgCwI,WAAWxI,GAAX,CAAhC;AACD,IAFD;AAGD;;;;;;;;;;;;mBChBuByI,c;AARxB,KAAMC,qBAAqB,8BAA3B;;AAEA;;;;;;AAMe,UAASD,cAAT,CAAwBjB,KAAxB,EAA+B;AAC5C,OAAIkB,mBAAmBhC,IAAnB,CAAwBc,KAAxB,CAAJ,EAAoC;AAClCA,mBAAYA,KAAZ;AACD;AACD,UAAOA,KAAP;AACD;;;;;;;;;;;;mBCHuBmB,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoBlI,CAApB,EAAuB;AACpC,OAAImI,IAAI,EAAR;AACA,OAAI5B,OAAOjF,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAGA,QAAK,IAAIrD,IAAE,CAAN,EAASC,IAAEzD,EAAEoI,KAAF,CAAQ1E,MAAxB,EAAgCF,IAAEC,CAAlC,EAAqCD,GAArC,EAA0C;AACxC,SAAI6E,KAAKrI,EAAEoI,KAAF,CAAQ5E,CAAR,CAAT;AACA,SAAI8E,KAAKtI,EAAEoI,KAAF,CAAQ5E,IAAE,CAAV,CAAT;AACA,SAAI8E,EAAJ,EAAQ;AACNH,SAAEI,IAAF,OAAWF,GAAG,CAAH,CAAX,SAAoBA,GAAG,CAAH,CAApB,SAA6BC,GAAG,CAAH,CAA7B,SAAsCA,GAAG,CAAH,CAAtC;AACD;AACF;;AAEH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CE,gCAAc/B,IAAd,EAAoB;AAClB4B,QAAMA,EAAEK,IAAF,CAAO,GAAP,CAAN,MADkB;AAElB1B,aAAQ,8BAAe9G,EAAE+G,KAAF,IAAW,MAA1B,CAFU;AAGlBC,kBAAahH,EAAEuE,KAAF,IAAW,CAHN;AAIlBkE,WAAM;AAJY,IAApB;;AAOA,UAAOlC,IAAP;AACD;;;;;;;;;;;;mBC9DuBmC,W;;AAZxB;;;;;;AAEA,KAAMC,OAAO,EAAb;AACA,KAAMC,IAAI,6WAAV;;AAEA;;;;;;;AAOe,UAASF,WAAT,CAAqB1I,CAArB,EAAwB;AACrC,OAAI6I,WAAWvH,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAf;AACA,OAAIiC,WAAWxH,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,KAAvD,CAAf;AACA,OAAIjD,OAAOtC,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;AACA,OAAIN,OAAOjF,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,gCAAcgC,QAAd,EAAyB;AACvBtE,YAAOoE,IADgB;AAEvBnE,aAAQmE,IAFe;AAGvBvF,QAAGpD,EAAEoD,CAHkB;AAIvBC,QAAGrD,EAAEqD;AAJkB,IAAzB;;AAOA,gCAAcyF,QAAd,EAAwB;AACtBvE,YAAOoE,IADe;AAEtBnE,aAAQmE,IAFc;AAGtBvF,QAAG,CAHmB;AAItBC,QAAIsF,OAAO,IAAR,GAAgB,CAAC,CAJE;AAKtBI,cAAS;AALa,IAAxB;;AAQA,gCAAcnF,IAAd,EAAoB;AAClBW,YAAOoE,IADW;AAElBnE,aAAQmE,IAFU;AAGlB7B,aAAQ,MAHU;AAIlB2B,WAAM;AAJY,IAApB;;AAOA,gCAAclC,IAAd,EAAoB;AAClB4B,QAAGS,CADe;AAElB5B,kBAAa,EAFK;AAGlBF,aAAQ,MAHU;AAIlB2B,WAAM;AAJY,IAApB;;AAOAK,YAASrD,WAAT,CAAqBc,IAArB;AACAsC,YAASpD,WAAT,CAAqB7B,IAArB;AACAiF,YAASpD,WAAT,CAAqBqD,QAArB;;AAEA,UAAOD,QAAP;AACD;;;;;;;;;;;;mBC1CuBG,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoBhJ,CAApB,EAAuB;AACpC,OAAIA,EAAEgE,IAAF,KAAW,WAAf,EAA4B;AAC1B,SAAI4C,QAAQtF,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,GAAvD,CAAZ;AACA,kCAAcD,KAAd,EAAqB;AACnB6B,aAAM,8BAAezI,EAAE+G,KAAF,IAAW,MAA1B,CADa;AAEnBkC,oBAAa;AAFM,MAArB;;AAKAjJ,OAAEiH,UAAF,CAAa3H,OAAb,CAAqB,UAAC4H,CAAD,EAAO;AAC1BN,aAAMnB,WAAN,CAAkByD,WAAWhC,CAAX,CAAlB;AACD,MAFD;;AAIA,YAAON,KAAP;AACD,IAZD,MAYO;AACL,SAAIhD,OAAOsF,WAAWlJ,CAAX,CAAX;AACA,kCAAc4D,IAAd,EAAoB;AAClBkD,eAAQ,8BAAe9G,EAAE+G,KAAF,IAAW,MAA1B,CADU;AAElB0B,aAAM;AAFY,MAApB;;AAKA,YAAO7E,IAAP;AACD;AACF;;AAED,UAASsF,UAAT,CAAoBhC,CAApB,EAAuB;AACrB,OAAItD,OAAOtC,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;;AAEA,gCAAcjD,IAAd,EAAoB;AAClBR,QAAG8D,EAAE9D,CADa;AAElBC,QAAG6D,EAAE7D,CAFa;AAGlBkB,YAAO2C,EAAE3C,KAHS;AAIlBC,aAAQ0C,EAAE1C;AAJQ,IAApB;;AAOA,UAAOZ,IAAP;AACD;;;;;;;;;;;;mBCnCuBuF,U;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,UAAT,CAAoBnJ,CAApB,EAAuB;;AAEpC;AACA;AACA,OAAIoJ,OAAO9H,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,MAAvD,CAAX;AACA,OAAIzD,IAAIpD,EAAEoD,CAAV;AACA,OAAIC,IAAIrD,EAAEqD,CAAV;;AAEA,gCAAc+F,IAAd,EAAoB;AAClBhG,QAAGA,CADe;AAElBC,QAAGA,CAFe;AAGlBoF,WAAM,8BAAezI,EAAE+G,KAAF,IAAW,MAA1B,CAHY;AAIlBsC,eAAUrJ,EAAEsJ,IAJM;AAKlBlD,4BAAqBpG,EAAEoF,QAAvB,UAAoChC,CAApC,UAA0CC,CAA1C;AALkB,IAApB;AAOA+F,QAAKG,SAAL,GAAiBvJ,EAAEN,OAAnB;;AAEA,OAAI8J,IAAIlI,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,GAAvD,CAAR;AACA2C,KAAE/D,WAAF,CAAc2D,IAAd;;AAEA,UAAOI,CAAP;AACD;;;;;;;;;;;;mBCrBuBC,Y;;AAVxB;;;;AACA;;;;;;AAEA;;;;;;;AAOe,UAASA,YAAT,CAAsBzJ,CAAtB,EAAyB;AACtC,OAAI0J,SAASC,aAAa3J,CAAb,CAAb;AACA,OAAI+G,QAAQ,8BAAe/G,EAAE+G,KAAF,IAAW,MAA1B,CAAZ;;AAEA,OAAI/G,EAAEgE,IAAF,KAAW,QAAf,EACE,6BAAc0F,MAAd,EAAsB;AACpB5C,aAAQC,KADY;AAEpB0B,WAAM,MAFc;AAGpB,qBAAgB;AAHI,IAAtB;AAKF,OAAIzI,EAAEgE,IAAF,KAAW,aAAf,EACE,6BAAc0F,MAAd,EAAsB;AACpB5C,aAAQC,KADY;AAEpB0B,WAAM,MAFc;AAGpB,qBAAgB;AAHI,IAAtB;;AAMF,OAAIzI,EAAEgE,IAAF,KAAW,YAAf,EACE,6BAAc0F,MAAd,EAAsB;AACpB5C,aAAQC,KADY;AAEpB0B,WAAM1B,KAFc;AAGpB,qBAAgB;AAHI,IAAtB;;AAMF,UAAO2C,MAAP;AACD;;AAED,UAASC,YAAT,CAAsB3J,CAAtB,EAAyB;AACvB,OAAI0J,SAASpI,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,QAAvD,CAAb;AACA,gCAAc6C,MAAd,EAAsB;AACpBE,SAAI5J,EAAE4J,EADc;AAEpBC,SAAI7J,EAAE6J,EAFc;AAGpB3C,QAAGlH,EAAEkH;AAHe,IAAtB;;AAMA,UAAOwC,MAAP;AACD;;;;;;;;;;;;mBC/BuBI,W;;AAfxB;;;;AACA;;;;AACA;;;;AAMA;;;;;;;AAOe,UAASA,WAAT,CAAqB9J,CAArB,EAAwB;AACrC,OAAImI,IAAI,EAAR;AACA,OAAI4B,QAAQzI,SAASuF,eAAT,CAAyB,4BAAzB,EAAuD,SAAvD,CAAZ;;AAEA,OAAI7G,EAAEoI,KAAF,CAAQ1E,MAAR,IAAkB,CAAtB,EAAyB;AACvB,SAAI2E,KAAKrI,EAAEoI,KAAF,CAAQ,CAAR,CAAT;AACA,SAAIE,KAAKtI,EAAEoI,KAAF,CAAQpI,EAAEoI,KAAF,CAAQ1E,MAAR,GAAiB,CAAzB,CAAT;;AAEA,SAAIsG,cAAc,EAAlB;AACA,SAAIC,MAAM,0BAAU5B,GAAG,CAAH,CAAV,EAAiBA,GAAG,CAAH,CAAjB,EAAwB,CAAxB,CAAV;AACA,SAAIxD,MAAM,0BAAUyD,GAAG,CAAH,CAAV,EAAiBA,GAAG,CAAH,CAAjB,EAAwB,CAAxB,CAAV;AACA,SAAIlF,IAAI,qCAAqB6G,GAArB,EAA0BpF,GAA1B,CAAR;AACA,SAAIqF,QAAQ,2BAAW9G,CAAX,CAAZ;AACAyB,WAAM,0BAAUoF,GAAV,EAAe,+BAAeC,KAAf,EAAsBF,WAAtB,CAAf,CAAN;AACA5G,SAAI,qCAAqB6G,GAArB,EAA0BpF,GAA1B,CAAJ;AACA,SAAIsF,QAAQ,2BAAW,CAAX,EAAc,CAAd,EAAiB,CAAjB,CAAZ;AACA,SAAIC,QAAQ,2BAAW,6BAAaF,KAAb,EAAoBC,KAApB,CAAX,CAAZ;AACA,SAAIE,YAAYrK,EAAEuE,KAAF,IAAW,EAA3B;;AAEA,SAAI+F,IAAI,0BAAUL,GAAV,EAAe,+BAAeG,KAAf,EAAsBC,YAAY,GAAlC,CAAf,CAAR;AACA,SAAIE,IAAI,0BAAUD,CAAV,EAAa,+BAAeJ,KAAf,EAAsB,0BAAU9G,CAAV,IAAeiH,YAAY,GAAjD,CAAb,CAAR;AACA,SAAIG,IAAI,0BAAUD,CAAV,EAAa,+BAAeH,KAAf,EAAsBC,SAAtB,CAAb,CAAR;AACA,SAAIzB,IAAI/D,GAAR;AACA,SAAI4F,IAAI,0BAAUR,GAAV,EAAe,+BAAe,6BAAaG,KAAb,CAAf,EAAoCC,YAAY,GAAhD,CAAf,CAAR;AACA,SAAIK,IAAI,0BAAUD,CAAV,EAAa,+BAAeP,KAAf,EAAsB,0BAAU9G,CAAV,IAAeiH,YAAY,GAAjD,CAAb,CAAR;AACA,SAAIM,IAAI,0BAAUD,CAAV,EAAa,+BAAe,6BAAaN,KAAb,CAAf,EAAoCC,SAApC,CAAb,CAAR;;AAEA,SAAIO,SAAS,KACXN,EAAElH,CADS,GACL,GADK,GACCkH,EAAEjH,CADH,GACO,GADP,GAEXkH,EAAEnH,CAFS,GAEL,GAFK,GAECmH,EAAElH,CAFH,GAEO,GAFP,GAGXmH,EAAEpH,CAHS,GAGL,GAHK,GAGCoH,EAAEnH,CAHH,GAGO,GAHP,GAIXuF,EAAExF,CAJS,GAIL,GAJK,GAICwF,EAAEvF,CAJH,GAIO,GAJP,GAKXsH,EAAEvH,CALS,GAKL,GALK,GAKCuH,EAAEtH,CALH,GAKO,GALP,GAMXqH,EAAEtH,CANS,GAML,GANK,GAMCsH,EAAErH,CANH,GAMO,GANP,GAOXoH,EAAErH,CAPS,GAOL,GAPK,GAOCqH,EAAEpH,CAPhB;;AASA,kCAAc0G,KAAd,EAAqB;AACnBa,eAAQA,MADW;AAEnB9D,eAAQ,8BAAe9G,EAAE+G,KAAF,IAAW,MAA1B,CAFW;AAGnB0B,aAAM,8BAAezI,EAAE+G,KAAF,IAAW,MAA1B;AAHa,MAArB;AAKD;;AAED,UAAOgD,KAAP;AACD;;;;;;;;;;;;SCzDec,c,GAAAA,c;SAQAC,qB,GAAAA,qB;SASA1E,S,GAAAA,S;SAWA2E,S,GAAAA,S;SAYAC,M,GAAAA,M;SAgBApG,K,GAAAA,K;SAkBAqG,S,GAAAA,S;SAIAC,U,GAAAA,U;SAIAC,oB,GAAAA,oB;SAQAC,S,GAAAA,S;SAIAC,c,GAAAA,c;SAIAC,S,GAAAA,S;SAOAC,Y,GAAAA,Y;SAIAC,U,GAAAA,U;SAQAC,Y,GAAAA,Y;AAvHhB;AACA;AACO,UAASZ,cAAT,CAAwBa,CAAxB,EAA2BC,CAA3B,EAA8B;AACnC,OAAIC,KAAKF,EAAE,CAAF,IAAOC,EAAE,CAAF,CAAP,GAAcD,EAAE,CAAF,IAAOC,EAAE,CAAF,CAArB,GAA4BA,EAAE,CAAF,CAArC;AACA,OAAIE,KAAKH,EAAE,CAAF,IAAOC,EAAE,CAAF,CAAP,GAAcD,EAAE,CAAF,IAAOC,EAAE,CAAF,CAArB,GAA4BA,EAAE,CAAF,CAArC;AACA,UAAO,CAACC,EAAD,EAAKC,EAAL,CAAP;AACD;;AAED;AACA;AACO,UAASf,qBAAT,CAA+BY,CAA/B,EAAkCC,CAAlC,EAAqC;AAC1C,OAAIxD,IAAIwD,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAP,GAAcA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAA7B;AACA,OAAIC,KAAK,CAACF,EAAE,CAAF,IAAOC,EAAE,CAAF,CAAP,GAAcD,EAAE,CAAF,IAAOC,EAAE,CAAF,CAArB,GAA4BA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAnC,GAA0CA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAlD,IAA0DxD,CAAnE;AACA,OAAI0D,KAAK,CAAC,CAACH,EAAE,CAAF,CAAD,GAAQC,EAAE,CAAF,CAAR,GAAeD,EAAE,CAAF,IAAOC,EAAE,CAAF,CAAtB,GAA6BA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAApC,GAA2CA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAnD,IAA2DxD,CAApE;AACA,UAAO,CAACyD,EAAD,EAAKC,EAAL,CAAP;AACD;;AAGD;AACO,UAASzF,SAAT,CAAmB0F,EAAnB,EAAuBC,EAAvB,EAA2B;AAChC,UAAO,CACLD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CADnB,EAELD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAFnB,EAGLD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAHnB,EAILD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAJnB,EAKLD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAxB,GAAgCD,GAAG,CAAH,CAL3B,EAMLA,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAR,GAAgBD,GAAG,CAAH,IAAQC,GAAG,CAAH,CAAxB,GAAgCD,GAAG,CAAH,CAN3B,CAAP;AAQD;;AAEM,UAASf,SAAT,CAAmBY,CAAnB,EAAsBvI,CAAtB,EAAyBC,CAAzB,EAA4B;AACjC,UAAO,CACLsI,EAAE,CAAF,CADK,EAELA,EAAE,CAAF,CAFK,EAGLA,EAAE,CAAF,CAHK,EAILA,EAAE,CAAF,CAJK,EAKLA,EAAE,CAAF,IAAOvI,CAAP,GAAWuI,EAAE,CAAF,IAAOtI,CAAlB,GAAsBsI,EAAE,CAAF,CALjB,EAMLA,EAAE,CAAF,IAAOvI,CAAP,GAAWuI,EAAE,CAAF,IAAOtI,CAAlB,GAAsBsI,EAAE,CAAF,CANjB,CAAP;AAQD;;AAGM,UAASX,MAAT,CAAgBW,CAAhB,EAAmBK,KAAnB,EAA0B;AAC/BA,WAAQA,QAAQjH,KAAKkH,EAAb,GAAkB,GAA1B;;AAEA,OAAIC,WAAWnH,KAAKoH,GAAL,CAASH,KAAT,CAAf;AACA,OAAII,WAAWrH,KAAKsH,GAAL,CAASL,KAAT,CAAf;;AAEA,UAAO,CACLL,EAAE,CAAF,IAAOO,QAAP,GAAkBP,EAAE,CAAF,IAAOS,QADpB,EAELT,EAAE,CAAF,IAAOO,QAAP,GAAkBP,EAAE,CAAF,IAAOS,QAFpB,EAGLT,EAAE,CAAF,IAAQ,CAACS,QAAT,GAAqBT,EAAE,CAAF,IAAOO,QAHvB,EAILP,EAAE,CAAF,IAAQ,CAACS,QAAT,GAAqBT,EAAE,CAAF,IAAOO,QAJvB,EAKLP,EAAE,CAAF,CALK,EAMLA,EAAE,CAAF,CANK,CAAP;AAQD;;AAEM,UAAS/G,KAAT,CAAe+G,CAAf,EAAkBvI,CAAlB,EAAqBC,CAArB,EAAwB;AAC7B,UAAO,CACLsI,EAAE,CAAF,IAAOvI,CADF,EAELuI,EAAE,CAAF,IAAOvI,CAFF,EAGLuI,EAAE,CAAF,IAAOtI,CAHF,EAILsI,EAAE,CAAF,IAAOtI,CAJF,EAKLsI,EAAE,CAAF,CALK,EAMLA,EAAE,CAAF,CANK,CAAP;AAQD;;AAED,UAASW,mBAAT,CAA6BX,CAA7B,EAAgC;AAC9B,OAAIxD,IAAIwD,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAP,GAAcA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAA7B;AACA,UAAO,CAACA,EAAE,CAAF,IAAOxD,CAAR,EAAW,CAACwD,EAAE,CAAF,CAAD,GAAQxD,CAAnB,EAAsB,CAACwD,EAAE,CAAF,CAAD,GAAQxD,CAA9B,EAAiCwD,EAAE,CAAF,IAAOxD,CAAxC,EACL,CAACwD,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAP,GAAcA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAtB,IAA8BxD,CADzB,EAC4B,CAACwD,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAP,GAAcA,EAAE,CAAF,IAAOA,EAAE,CAAF,CAAtB,IAA8BxD,CAD1D,CAAP;AAED;;AAGM,UAAS8C,SAAT,CAAmB7H,CAAnB,EAAsBC,CAAtB,EAAyBkJ,CAAzB,EAA4B;AACjC,UAAO,EAAEnJ,GAAGA,CAAL,EAAQC,GAAGA,CAAX,EAAckJ,GAAGA,CAAjB,EAAP;AACD;;AAEM,UAASrB,UAAT,CAAoBsB,MAApB,EAA4BC,MAA5B,EAAoCC,MAApC,EAA4C;AACjD,UAAO,EAAEF,QAAQA,MAAV,EAAkBC,QAAQA,MAA1B,EAAkCC,QAAQA,MAA1C,EAAP;AACD;;AAEM,UAASvB,oBAAT,CAA8BtG,GAA9B,EAAmCC,GAAnC,EACP;AACE,OAAI0H,SAAS1H,IAAI1B,CAAJ,GAAQyB,IAAIzB,CAAzB;AACA,OAAIqJ,SAAS3H,IAAIzB,CAAJ,GAAQwB,IAAIxB,CAAzB;AACA,OAAIqJ,SAAS5H,IAAIyH,CAAJ,GAAQ1H,IAAI0H,CAAzB;AACA,UAAOrB,WAAWsB,MAAX,EAAmBC,MAAnB,EAA2BC,MAA3B,CAAP;AACD;;AAEM,UAAStB,SAAT,CAAmBlG,EAAnB,EAAuByH,CAAvB,EAA0B;AAC/B,UAAO1B,UAAU/F,GAAG9B,CAAH,GAAOuJ,EAAEH,MAAnB,EAA2BtH,GAAG7B,CAAH,GAAOsJ,EAAEF,MAApC,EAA4CvH,GAAGqH,CAAH,GAAOI,EAAED,MAArD,CAAP;AACD;;AAEM,UAASrB,cAAT,CAAwBsB,CAAxB,EAA2BC,MAA3B,EAAmC;AACxC,UAAO1B,WAAWyB,EAAEH,MAAF,GAAWI,MAAtB,EAA8BD,EAAEF,MAAF,GAAWG,MAAzC,EAAiDD,EAAED,MAAF,GAAWE,MAA5D,CAAP;AACD;;AAEM,UAAStB,SAAT,CAAmBqB,CAAnB,EACP;AACE,UAAO5H,KAAK8H,IAAL,CACL9H,KAAK+H,GAAL,CAASH,EAAEH,MAAX,EAAmB,CAAnB,IAAwBzH,KAAK+H,GAAL,CAASH,EAAEF,MAAX,EAAmB,CAAnB,CAAxB,GAAgD1H,KAAK+H,GAAL,CAASH,EAAED,MAAX,EAAmB,CAAnB,CAD3C,CAAP;AAGD;;AAEM,UAASnB,YAAT,CAAsBoB,CAAtB,EAAyB;AAC9B,UAAOtB,eAAesB,CAAf,EAAkB,CAAC,CAAnB,CAAP;AACD;;AAEM,UAASnB,UAAT,CAAoBmB,CAApB,EAAuB;AAC5B,OAAII,MAAMzB,UAAUqB,CAAV,CAAV;AACA,OAAIH,SAASG,EAAEH,MAAF,GAAWO,GAAxB;AACA,OAAIN,SAASE,EAAEF,MAAF,GAAWM,GAAxB;AACA,OAAIL,SAASC,EAAED,MAAF,GAAWK,GAAxB;AACA,UAAO7B,WAAWsB,MAAX,EAAmBC,MAAnB,EAA2BC,MAA3B,CAAP;AACD;;AAEM,UAASjB,YAAT,CAAsBuB,CAAtB,EAAyBL,CAAzB,EAA4B;AACjC;AACA;AACA;AACA;AACA,OAAIH,SAASQ,EAAEP,MAAF,GAAWE,EAAED,MAAb,GAAsBM,EAAEN,MAAF,GAAWC,EAAEF,MAAhD;AACA,OAAIA,SAASO,EAAEN,MAAF,GAAWC,EAAEH,MAAb,GAAsBQ,EAAER,MAAF,GAAWG,EAAED,MAAhD;AACA,OAAIA,SAASM,EAAER,MAAF,GAAWG,EAAEF,MAAb,GAAsBO,EAAEP,MAAF,GAAWE,EAAEH,MAAhD;AACA,UAAOtB,WAAWsB,MAAX,EAAmBC,MAAnB,EAA2BC,MAA3B,CAAP;AACD,E;;;;;;;;;;;;;;AChID;;;;AACA;;;;;;;;;;;;;;AAEA;AACA;KACqBrO,iB;;;AACnB,gCAA6B;AAAA,SAAjBS,MAAiB,uEAAR,MAAQ;;AAAA;;AAAA,uIACrB;AACJF,qBADI,0BACWC,UADX,EACuBC,MADvB,EAC+BC,UAD/B,EAC2C;AAC7C,gBAAO,IAAIkO,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIpN,cAAcqN,oBAAoBC,MAApB,CAA2B,UAAC7J,CAAD,EAAO;AAClD,oBAAOA,EAAE8J,IAAF,KAAWvO,UAAX,IAAyByE,EAAE+J,KAAF,KAAY,YAA5C;AACD,YAFiB,CAAlB;;AAIAL,mBAAQ;AACNrO,mCADM;AAENC,2BAFM;AAGNC,mCAHM;AAINgB;AAJM,YAAR;AAMD,UAXM,CAAP;AAYD,QAdG;AAgBJyN,oBAhBI,yBAgBU3O,UAhBV,EAgBsBW,YAhBtB,EAgBoC;AACtC,gBAAOyN,QAAQC,OAAR,CAAgBtO,eAAeC,UAAf,EAA2BC,MAA3B,EAAmC2O,eAAe5O,UAAf,EAA2BC,MAA3B,EAAmCU,YAAnC,CAAnC,CAAhB,CAAP;AACD,QAlBG;AAoBJU,oBApBI,yBAoBUrB,UApBV,EAoBsBC,MApBtB,EAoB8BC,UApB9B,EAoB0CU,UApB1C,EAoBsD;AACxD,gBAAO,IAAIwN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC1N,sBAAW8N,KAAX,GAAmB,YAAnB;AACA9N,sBAAWP,IAAX,GAAkB,qBAAlB;AACAO,sBAAW6N,IAAX,GAAkBvO,UAAlB;AACAU,sBAAWX,MAAX,GAAoBA,MAApB;;AAEA,eAAIiB,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACAiB,uBAAYwI,IAAZ,CAAiB9I,UAAjB;AACAiO,6BAAkB7O,UAAlB,EAA8BC,MAA9B,EAAsCiB,WAAtC;;AAEAmN,mBAAQzN,UAAR;AACD,UAXM,CAAP;AAYD,QAjCG;AAmCJW,qBAnCI,0BAmCWvB,UAnCX,EAmCuBC,MAnCvB,EAmC+BU,YAnC/B,EAmC6CC,UAnC7C,EAmCyD;AAC3D,gBAAO,IAAIwN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIpN,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACAiB,uBAAY0N,eAAe5O,UAAf,EAA2BC,MAA3B,EAAmCU,YAAnC,CAAZ,IAAgEC,UAAhE;AACAiO,6BAAkB7O,UAAlB,EAA8BC,MAA9B,EAAsCiB,WAAtC;;AAEAmN,mBAAQzN,UAAR;AACD,UANM,CAAP;AAOD,QA3CG;AA6CJa,uBA7CI,4BA6CazB,UA7Cb,EA6CyBC,MA7CzB,EA6CiCU,YA7CjC,EA6C+C;AACjD,gBAAO,IAAIyN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIQ,QAAQF,eAAe5O,UAAf,EAA2BC,MAA3B,EAAmCU,YAAnC,CAAZ;AACA,eAAImO,QAAQ,CAAC,CAAb,EAAgB;AACd,iBAAI5N,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACAiB,yBAAY6N,MAAZ,CAAmBD,KAAnB,EAA0B,CAA1B;AACAD,+BAAkB7O,UAAlB,EAA8BC,MAA9B,EAAsCiB,WAAtC;AACD;;AAEDmN,mBAAQ,IAAR;AACD,UATM,CAAP;AAUD,QAxDG;AA0DJW,kBA1DI,uBA0DQhP,UA1DR,EA0DoBC,MA1DpB,EA0D4BU,YA1D5B,EA0D0C;AAC5C,gBAAO,IAAIyN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCD,mBAAQtO,eAAeC,UAAf,EAA2BC,MAA3B,EAAmCuO,MAAnC,CAA0C,UAAC7J,CAAD,EAAO;AACvD,oBAAOA,EAAE+J,KAAF,KAAY,SAAZ,IAAyB/J,EAAE/D,UAAF,KAAiBD,YAAjD;AACD,YAFO,CAAR;AAGD,UAJM,CAAP;AAKD,QAhEG;AAkEJiB,iBAlEI,sBAkEO5B,UAlEP,EAkEmBC,MAlEnB,EAkE2BU,YAlE3B,EAkEyCE,OAlEzC,EAkEkD;AACpD,gBAAO,IAAIuN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,eAAIzM,UAAU;AACZ6M,oBAAO,SADK;AAEZrO,mBAAM,qBAFM;AAGZO,yBAAYD,YAHA;AAIZE,sBAASA;AAJG,YAAd;;AAOA,eAAIK,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACAiB,uBAAYwI,IAAZ,CAAiB7H,OAAjB;AACAgN,6BAAkB7O,UAAlB,EAA8BC,MAA9B,EAAsCiB,WAAtC;;AAEAmN,mBAAQxM,OAAR;AACD,UAbM,CAAP;AAcD,QAjFG;AAmFJE,oBAnFI,yBAmFU/B,UAnFV,EAmFsBC,MAnFtB,EAmF8Ba,SAnF9B,EAmFyC;AAC3C,gBAAO,IAAIsN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtCvO,0BAAeC,UAAf,EAA2BC,MAA3B;AACA,eAAI6O,QAAQ,CAAC,CAAb;AACA,eAAI5N,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACA,gBAAK,IAAI0E,IAAE,CAAN,EAASC,IAAE1D,YAAY2D,MAA5B,EAAoCF,IAAEC,CAAtC,EAAyCD,GAAzC,EAA8C;AAC5C,iBAAIzD,YAAYyD,CAAZ,EAAetE,IAAf,KAAwBS,SAA5B,EAAuC;AACrCgO,uBAAQnK,CAAR;AACA;AACD;AACF;;AAED,eAAImK,QAAQ,CAAC,CAAb,EAAgB;AACd5N,yBAAY6N,MAAZ,CAAmBD,KAAnB,EAA0B,CAA1B;AACAD,+BAAkB7O,UAAlB,EAA8BC,MAA9B,EAAsCiB,WAAtC;AACD;;AAEDmN,mBAAQ,IAAR;AACD,UAjBM,CAAP;AAkBD;AAtGG,MADqB;;AAyG3B,WAAKY,OAAL,GAAehP,MAAf;AAzG2B;AA0G5B;;;;yBACW;AACV,cAAO,KAAKgP,OAAZ;AACD;;;;GA9G4C1P,sB;;mBAA1BC,iB;;;AAiHrB,UAAS+O,iBAAT,GAA4B;AAC1B,OAAIW,kBAAkB,EAAtB;AACA,QAAI,IAAIvK,IAAI,CAAZ,EAAgBA,IAAIwK,aAAatK,MAAjC,EAAyCF,GAAzC,EAA6C;AAC3C,SAAGwK,aAAazO,GAAb,CAAiBiE,CAAjB,EAAoByK,QAApB,CAA6B,aAA7B,CAAH,EAA+C;AAC7CF,uBAAgBxF,IAAhB,2CAAwB3C,KAAKC,KAAL,CAAWmI,aAAaE,OAAb,CAAqBF,aAAazO,GAAb,CAAiBiE,CAAjB,CAArB,CAAX,CAAxB;AACD;AACF;AACD,UAAOuK,eAAP;AACD;;AAED,UAASnP,cAAT,CAAwBC,UAAxB,EAAoCC,MAApC,EAA4C;AAC1C,UAAO8G,KAAKC,KAAL,CAAWmI,aAAaE,OAAb,CAAwBrP,UAAxB,SAAsCC,MAAtC,kBAAX,KAA2E,EAAlF;AACD;;AAED,UAAS4O,iBAAT,CAA2B7O,UAA3B,EAAuCC,MAAvC,EAA+CiB,WAA/C,EAA4D;AAC1DiO,gBAAaG,OAAb,CAAwBtP,UAAxB,SAAsCC,MAAtC,mBAA4D8G,KAAKwI,SAAL,CAAerO,WAAf,CAA5D;AACD;AACD;;;;;;;;;;AAUA,UAAS0N,cAAT,CAAwB5O,UAAxB,EAAoCC,MAApC,EAA4CU,YAA5C,EAA0D;AACxD,OAAImO,QAAQ,CAAC,CAAb;AACA,OAAI5N,cAAcnB,eAAeC,UAAf,EAA2BC,MAA3B,CAAlB;AACA,QAAK,IAAI0E,IAAE,CAAN,EAASC,IAAE1D,YAAY2D,MAA5B,EAAoCF,IAAEC,CAAtC,EAAyCD,GAAzC,EAA8C;AAC5C,SAAIzD,YAAYyD,CAAZ,EAAetE,IAAf,KAAwBM,YAA5B,EAA0C;AACxCmO,eAAQnK,CAAR;AACA;AACD;AACF;AACD,UAAOmK,KAAP;AACD;;;;;;;;;;;;mBC7IuBzO,I;AAdxB,KAAMmP,SAAS,OAAf;AACA,KAAMC,UAAU,sCAAhB;;AAEA,UAASC,WAAT,CAAqBC,CAArB,EAAwB;AACtB,OAAItH,IAAInC,KAAK0J,MAAL,KAAc,EAAd,GAAiB,CAAzB;AACA,OAAI9B,IAAI6B,KAAK,GAAL,GAAWtH,CAAX,GAAgBA,IAAE,GAAF,GAAM,GAA9B;AACA,UAAOyF,EAAE+B,QAAF,CAAW,EAAX,CAAP;AACD;;AAED;;;;;AAKe,UAASxP,IAAT,GAAgB;AAC7B,UAAOoP,QAAQzG,OAAR,CAAgBwG,MAAhB,EAAwBE,WAAxB,CAAP;AACD;;;;;;;;;;;;mBCDuB5P,M;;AAfxB;;;;AACA;;AACA;;;;;;AAEA;;;;;;;;;;;AAWe,UAASA,MAAT,CAAgB8F,GAAhB,EAAqBE,QAArB,EAA+BgK,IAA/B,EAAqC;AAClD,UAAO,IAAI1B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC;AACA1I,SAAI3B,YAAJ,CAAiB,6BAAjB,EAAgD,IAAhD;AACA2B,SAAI3B,YAAJ,CAAiB,4BAAjB,EAA+C8C,KAAKwI,SAAL,CAAezJ,QAAf,CAA/C;AACAF,SAAImK,eAAJ,CAAoB,4BAApB;AACAnK,SAAImK,eAAJ,CAAoB,wBAApB;;AAEA;AACA,SAAI,CAACD,IAAL,EAAW;AACTlK,WAAI8E,SAAJ,GAAgB,EAAhB;AACA,cAAO2D,QAAQzI,GAAR,CAAP;AACD;;AAEDA,SAAI3B,YAAJ,CAAiB,4BAAjB,EAA+C6L,KAAK9P,UAApD;AACA4F,SAAI3B,YAAJ,CAAiB,wBAAjB,EAA2C6L,KAAK7P,MAAhD;AACA2F,SAAI3B,YAAJ,CAAiB,wBAAjB,EAA2C6L,KAAK5P,UAAhD;;AAEA;AACA,SAAI,CAAC8P,MAAMC,OAAN,CAAcH,KAAK5O,WAAnB,CAAD,IAAoC4O,KAAK5O,WAAL,CAAiB2D,MAAjB,KAA4B,CAApE,EAAuE;AACrE,cAAOwJ,QAAQzI,GAAR,CAAP;AACD;;AAED;AACAkK,UAAK5O,WAAL,CAAiBT,OAAjB,CAAyB,UAACU,CAAD,EAAO;AAC9B,WAAI+C,OAAO0B,IAAI+B,aAAJ,CAAkB,4BAA4BxG,EAAEd,IAA9B,GAAqC,IAAvD,CAAX;AACA,WAAI6D,IAAJ,EAAU;AACR,0CAAe0B,GAAf,EAAoB1B,IAApB,EAA0B4B,QAA1B;AACD,QAFD,MAEO;AACL,uCAAYF,GAAZ,EAAiBzE,CAAjB,EAAoB2E,QAApB;AACD;AACF,MAPD;;AASAuI,aAAQzI,GAAR;AACD,IAjCM,CAAP;AAkCD;;;;;;;;;;;;mBCvCuBsK,uB;;AAXxB;;;;AACA;;;;;;AAEA;AACA;;AAEA;;;;;AAKe,UAASA,uBAAT,CAAiChP,WAAjC,EAA8C;AAC3DA,iBAAc8O,MAAMC,OAAN,CAAc/O,WAAd,IAA6BA,WAA7B,GAA2C,EAAzD;;AAEA;AACAX,UAAOC,IAAP,CAAY2P,UAAZ,EAAwB1P,OAAxB,CAAgC,UAAC0E,IAAD,EAAU;AACxC,SAAIiL,SAASD,WAAWhL,IAAX,CAAb;AACAjE,iBACGsN,MADH,CACU,UAACrN,CAAD;AAAA,cAAOA,EAAEgE,IAAF,KAAWA,IAAlB;AAAA,MADV,EAEGkL,IAFH,CAEQD,MAFR,EAGG3P,OAHH,CAGW,UAACU,CAAD,EAAIwD,CAAJ;AAAA,cAAU,sCAAuBxD,CAAvB,EAA0BwD,IAAI,CAA9B,CAAV;AAAA,MAHX;AAID,IAND;AAOD;;AAED;AACA;AACA;AACA,UAAS2L,WAAT,CAAqBnP,CAArB,EAAwBoP,CAAxB,EAA2B;AACzB,OAAIpP,EAAEqD,CAAF,GAAM+L,EAAE/L,CAAZ,EAAe;AACb,YAAOrD,EAAEoD,CAAF,GAAMgM,EAAEhM,CAAf;AACD,IAFD,MAEO;AACL,YAAO,CAAP;AACD;AACF;;AAED;AACA,UAASiM,eAAT,CAAyBrP,CAAzB,EAA4BoP,CAA5B,EAA+B;AAC7B,UAAOD,YAAYnP,EAAEiH,UAAF,CAAa,CAAb,CAAZ,EAA6BmI,EAAEnI,UAAF,CAAa,CAAb,CAA7B,CAAP;AACD;;AAED;AACA,UAASqI,eAAT,CAAyBtP,CAAzB,EAA4BoP,CAA5B,EAA+B;AAC7B,OAAIG,QAAQvP,EAAEoI,KAAF,CAAQ,CAAR,CAAZ;AACA,OAAIoH,QAAQJ,EAAEhH,KAAF,CAAQ,CAAR,CAAZ;AACA,UAAO+G,YACL,EAAC/L,GAAGmM,MAAM,CAAN,CAAJ,EAAclM,GAAGkM,MAAM,CAAN,CAAjB,EADK,EAEL,EAACnM,GAAGoM,MAAM,CAAN,CAAJ,EAAcnM,GAAGmM,MAAM,CAAN,CAAjB,EAFK,CAAP;AAID;;AAED;AACA,KAAMR,aAAa;AACjB,gBAAaK,eADI;AAEjB,gBAAaA,eAFI;AAGjB,cAAWC,eAHM;AAIjB,cAAWH,WAJM;AAKjB,YAASA,WALQ;AAMjB,WAAQA;AANS,EAAnB;;;;;;;;;;;;mBCrCwBM,sB;;AAdxB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA;AACA,KAAMC,gBAAgB,CAAC,WAAD,EAAc,OAAd,EAAuB,MAAvB,EAA8B,QAA9B,EAAuC,aAAvC,EAAqD,YAArD,CAAtB;;AAEA;;;;;;AAMe,UAASD,sBAAT,CAAgChQ,UAAhC,EAAqD;AAAA,OAATkQ,GAAS,uEAAH,CAAG;;AAClE,WAAQlQ,WAAWuE,IAAnB;AACE,UAAK,WAAL;AACA,UAAK,WAAL;AACE,WAAI4L,QAAQnQ,WAAWwH,UAAvB;AACA,WAAI4I,QAAQD,MAAM,CAAN,CAAZ;AACA,WAAIE,OAAOF,MAAMA,MAAMlM,MAAN,GAAe,CAArB,CAAX;;AAEA,iDACE,iDAAgCjE,WAAWuE,IAA3C,oBAA8D2L,GAA9D,EAAqElQ,WAAWP,IAAhF,CADF,EAEE2Q,MAAMzM,CAFR,EAEWyM,MAAMxM,CAFjB,EAEoB5D,WAAW6N,IAF/B,EAEqC,IAFrC;;AAKA,iDACE,+CAA8B7N,WAAWuE,IAAzC,oBAA4D2L,GAA5D,EAAsElQ,WAAWP,IAAjF,UADF,EAEE4Q,KAAK1M,CAAL,GAAS0M,KAAKvL,KAFhB,EAEuBuL,KAAKzM,CAF5B,EAE+B5D,WAAW6N,IAF1C,EAEgD,KAFhD;AAIA;;AAEF,UAAK,SAAL;AACA,UAAK,OAAL;AACE,WAAIlE,OAAO3J,WAAWuE,IAAX,KAAoB,SAApB,mBAA8CvE,WAAWC,OAAzD,SAAsE,EAAjF;;AAEA,kDACE,sCAA0BD,WAAWuE,IAArC,oBAAwD2L,GAAxD,GAA8DvG,IAA9D,EAAsE3J,WAAWP,IAAjF,CADF,EAEEO,WAAW2D,CAFb,EAEgB3D,WAAW4D,CAF3B,EAE8B5D,WAAW6N,IAFzC;AAIA;;AAEF,UAAK,SAAL;AACA,UAAK,MAAL;AACE,WAAIlK,IAAI,OAAO3D,WAAW2D,CAAlB,KAAwB,WAAxB,GAAsC3D,WAAW2D,CAAjD,GAAqD3D,WAAW2I,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAA7D;AACA,WAAI/E,IAAI,OAAO5D,WAAW4D,CAAlB,KAAwB,WAAxB,GAAsC5D,WAAW4D,CAAjD,GAAqD5D,WAAW2I,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAA7D;;AAEA,kDACE,2DAA4C3I,WAAWP,IAAvD,CADF,EAEEkE,CAFF,EAEKC,CAFL,EAEQ5D,WAAW6N,IAFnB;AAIA;;AAEF,UAAK,QAAL;AACA,UAAK,YAAL;AACA,UAAK,aAAL;AACE,WAAIhG,KAAK,OAAO7H,WAAWmK,EAAlB,KAAyB,WAAzB,GAAuCnK,WAAWmK,EAAlD,GAAuDnK,WAAW2I,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAAhE;AACA,WAAIb,KAAK,OAAO9H,WAAWoK,EAAlB,KAAyB,WAAzB,GAAuCpK,WAAWoK,EAAlD,GAAuDpK,WAAW2I,KAAX,CAAiB,CAAjB,EAAoB,CAApB,CAAhE;;AAEA,kDACE,2DAA4C3I,WAAWP,IAAvD,CADF,EAEEoI,EAFF,EAEMC,EAFN,EAEU9H,WAAW6N,IAFrB;AAIA;AAjDJ;;AAoDA;AACA,OAAIoC,cAAczB,QAAd,CAAuBxO,WAAWuE,IAAlC,CAAJ,EAA6C;AAC3C,+CAA2BvE,WAAWZ,UAAtC,EAAkDY,WAAWP,IAA7D;AACD;AACF;;;;;;;;;;;;mBChEuB6Q,sB;AAPxB;;;;;;;AAOe,UAASA,sBAAT,CAAgCrQ,OAAhC,EAAyCF,YAAzC,EAAuD;AACpE,OAAIuD,OAAOzB,SAAS0O,aAAT,CAAuB,KAAvB,CAAX;AACA,OAAI5G,OAAO9H,SAAS2O,cAAT,CAAwBvQ,OAAxB,CAAX;AACAqD,QAAK0C,WAAL,CAAiB2D,IAAjB;AACArG,QAAKD,YAAL,CAAkB,IAAlB,iCAAqDtD,YAArD;AACAuD,QAAKmN,KAAL,CAAWC,QAAX,GAAsB,UAAtB;AACApN,QAAKmN,KAAL,CAAW/L,IAAX,GAAkB,UAAlB;AACApB,QAAKmN,KAAL,CAAWjM,GAAX,GAAiB,MAAjB;AACAlB,QAAKmN,KAAL,CAAW3L,KAAX,GAAmB,KAAnB;AACAxB,QAAKmN,KAAL,CAAW1L,MAAX,GAAoB,KAApB;AACAzB,QAAKmN,KAAL,CAAWE,QAAX,GAAsB,QAAtB;AACA,UAAOrN,IAAP;AACD;;;;;;;;;;;;mBCHuBsN,2B;;AAhBxB;;;;AACA;;;;AACA;;;;;;AAGA;;;;;;;;;;;AAWe,UAASA,2BAAT,CAAqC1M,EAArC,EAAyCP,CAAzC,EAA4CC,CAA5C,EAA+CtE,UAA/C,EAA2D;AACxE;AACA,OAAI,0CAA2B4E,EAA3B,EAA+BP,CAA/B,EAAkCC,CAAlC,EAAqCtE,UAArC,EAAiD,IAAjD,CAAJ,EAA4D;AAC1D,YAAO,IAAP;AACD;;AAED;AACA,OAAI0F,MAAMnD,SAASkF,aAAT,kCAAsDzH,UAAtD,QAAV;AACA,OAAI6E,OAAOa,IAAIZ,qBAAJ,EAAX;AACA,OAAIyM,qCAAY7L,IAAIzB,UAAJ,CAAeO,gBAAf,CAAgCtE,iBAAOsR,cAAP,KAA0B,QAA1D,CAAZ,EAAJ;;AAEAlN,OAAI,oBAAQoB,GAAR,EAAa,EAACpB,IAAD,EAAb,EAAkBA,CAAlB,GAAsBO,KAAKK,GAA/B;AACAb,OAAI,oBAAQqB,GAAR,EAAa,EAACrB,IAAD,EAAb,EAAkBA,CAAlB,GAAsBQ,KAAKO,IAA/B;;AAEA;AACA,QAAK,IAAIX,IAAE,CAAN,EAASC,IAAE6M,MAAM5M,MAAtB,EAA8BF,IAAEC,CAAhC,EAAmCD,GAAnC,EAAwC;AACtC,SAAIiD,IAAI6J,MAAM9M,CAAN,CAAR;AACA,SAAI0D,IAAIT,EAAE5C,qBAAF,EAAR;AACA,SAAIR,KAAK6D,EAAEjD,GAAX,EAAgB;AACdwC,SAAEzD,UAAF,CAAawN,YAAb,CAA0B7M,EAA1B,EAA8B8C,CAA9B;AACA,cAAO,IAAP;AACD;AACF;;AAED;AACA,OAAIgK,YAAYhM,IAAIzB,UAAJ,CAAewD,aAAf,CAA6BvH,iBAAOsR,cAAP,EAA7B,CAAhB;AACA,OAAIE,SAAJ,EAAe;AACb,SAAIC,WAAWD,UAAU5M,qBAAV,EAAf;AACA,SAAI,gCAAoBT,CAApB,EAAuBC,CAAvB,EAA0BqN,QAA1B,CAAJ,EAAyC;AACvCD,iBAAUhL,WAAV,CAAsB9B,EAAtB;AACA,cAAO,IAAP;AACD;AACF;;AAED,UAAO,KAAP;AACD;;;;;;;;;;;;mBCnDc;AACXgN,0BAAqB,iBADV;AAEXC,oBAAe,WAFJ;AAGXC,yBAAoB,8BAAY;AAC5B,gBAAO,SAAS,KAAKF,mBAArB;AACH,MALU;AAMXG,2BAAsB,gCAAY;AAC9B,gBAAO,MAAM,KAAKH,mBAAlB;AACH,MARU;AASXJ,qBAAgB,0BAAY;AACxB,gBAAO,MAAM,KAAKK,aAAlB;AACH;AAXU,E;;;;;;;;;;;;mBCkBSG,0B;;AAlBxB;;;;AACA;;;;;;AAMA;;;;;;;;;;;AAWe,UAASA,0BAAT,CAAoCpN,EAApC,EAAwCP,CAAxC,EAA2CC,CAA3C,EAA8CtE,UAA9C,EAA0DyR,YAA1D,EAAwE;AACrF,OAAMQ,gBAAgB,CAAtB;;AAEA;AACA;AACA;AACA;AACA5N,OAAI2B,KAAKkM,GAAL,CAAS7N,IAAK4N,iBAAiBR,eAAe,CAAf,GAAmB,CAAC,CAArC,CAAd,EAAwD,CAAxD,CAAJ;;AAEA,OAAIzN,OAAOmO,0BAA0B9N,CAA1B,EAA6BC,IAAI2N,aAAjC,EAAgDjS,UAAhD,CAAX;AACA,OAAI,CAACgE,IAAL,EAAW;AACT,YAAO,KAAP;AACD;;AAED;AACA;AACA;AACAK,OAAIA,IAAK4N,iBAAiBR,eAAe,CAAC,CAAhB,GAAoB,CAArC,CAAT;;AAEA,OAAI/L,MAAMnD,SAASkF,aAAT,kCAAsDzH,UAAtD,QAAV;AACA,OAAIoF,OAAO,sBAAUM,GAAV,EAAe,EAACN,MAAMpB,KAAKc,qBAAL,GAA6BM,IAApC,EAAf,EAA0DA,IAA1D,GAAiEM,IAAIZ,qBAAJ,GAA4BM,IAAxG;AACA,OAAIgN,OAAOpO,KAAKqO,SAAL,CAAe,IAAf,CAAX;AACA,OAAI5L,OAAO2L,KAAK5H,SAAL,CAAe8H,KAAf,CAAqB,EAArB,CAAX;AACA,OAAIC,OAAO,EAAX;;AAEA;AACAH,QAAKjB,KAAL,CAAWC,QAAX,GAAsB,UAAtB;AACAgB,QAAKjB,KAAL,CAAWjM,GAAX,GAAiB,UAAjB;AACAkN,QAAKjB,KAAL,CAAW/L,IAAX,GAAkB,UAAlB;AACA7C,YAASuB,IAAT,CAAc4C,WAAd,CAA0B0L,IAA1B;;AAEA,UAAO3L,KAAK9B,MAAZ,EAAoB;AAClB;AACA,SAAI8B,KAAKA,KAAK9B,MAAL,GAAc,CAAnB,MAA0B,GAA9B,EAAmC;AACjC,cAAM8B,KAAK9B,MAAX,EAAmB;AACjB4N,cAAKC,OAAL,CAAa/L,KAAKgM,GAAL,EAAb;AACA,aAAIF,KAAK,CAAL,MAAY,GAAhB,EAAqB;AACnB;AACD;AACF;AACF;;AAED;AACAH,UAAK5H,SAAL,GAAiB/D,KAAKgD,IAAL,CAAU,EAAV,CAAjB;AACA,SAAIjE,QAAQ,sBAAUE,GAAV,EAAe,EAACF,OAAO4M,KAAKtN,qBAAL,GAA6BU,KAArC,EAAf,EAA4DA,KAAxE;AACA,SAAIJ,OAAOI,KAAP,IAAgBnB,CAApB,EAAuB;AACrB;AACD;AACDkO,UAAKC,OAAL,CAAa/L,KAAKgM,GAAL,EAAb;AACD;;AAED;AACAzO,QAAKwG,SAAL,GAAiB/D,KAAKgD,IAAL,CAAU,EAAV,IAAgB7E,GAAG8N,SAAnB,GAA+BH,KAAK9I,IAAL,CAAU,EAAV,CAAhD;AACA2I,QAAKnO,UAAL,CAAgB0C,WAAhB,CAA4ByL,IAA5B;;AAEA,UAAO,IAAP;AACD;;AAED;;;;;;;;AAQA,UAASD,yBAAT,CAAmC9N,CAAnC,EAAsCC,CAAtC,EAAyCtE,UAAzC,EAAqD;AACnD,OAAI0F,MAAMnD,SAASkF,aAAT,kCAAsDzH,UAAtD,QAAV;AACA,OAAI6E,OAAOa,IAAIZ,qBAAJ,EAAX;AACAR,OAAI,oBAAQoB,GAAR,EAAa,EAACpB,IAAD,EAAb,EAAkBA,CAAlB,GAAsBO,KAAKK,GAA/B;AACAb,OAAI,oBAAQqB,GAAR,EAAa,EAACrB,IAAD,EAAb,EAAkBA,CAAlB,GAAsBQ,KAAKO,IAA/B;AACA,UAAO,6BAAIM,IAAIzB,UAAJ,CAAeO,gBAAf,CAAgCtE,iBAAOsR,cAAP,KAA0B,sBAA1D,CAAJ,GAAuFlD,MAAvF,CAA8F,UAAC1J,EAAD,EAAQ;AAC3G,YAAO,gCAAoBP,CAApB,EAAuBC,CAAvB,EAA0BM,GAAGE,qBAAH,EAA1B,CAAP;AACD,IAFM,EAEJ,CAFI,CAAP;AAGD;;;;;;;;;;;;mBClEuB6N,0B;;AA1BxB;;;;AACA;;;;;;AAEA;;;;;;;;;;;;;;;;;;;;;;;AAuBe,UAASA,0BAAT,CAAoC7S,UAApC,EAAgDW,YAAhD,EAA8DmS,QAA9D,EAAwE;AACrF,OAAIC,gBAAJ;;AAEA,OAAI/C,MAAMC,OAAN,CAAc6C,QAAd,CAAJ,EAA6B;AAC3BC,eAAU3E,QAAQC,OAAR,CAAgByE,QAAhB,CAAV;AACD,IAFD,MAEO;AACLC,eAAU5T,wBAAcO,eAAd,GAAgCsP,WAAhC,CAA4ChP,UAA5C,EAAwDW,YAAxD,CAAV;AACD;;AAED,UAAOoS,QAAQ9R,IAAR,CAAa,UAAC6R,QAAD,EAAc;AAChC;AACA;AACA,SAAI5O,OAAOzB,SAASuQ,cAAT,gCAAqDrS,YAArD,CAAX;AACA,SAAIuD,IAAJ,EAAU;AACR,WAAI+O,OAAOxQ,SAAS0O,aAAT,CAAuB,IAAvB,CAAX;AACA8B,YAAKhP,YAAL,CAAkB,IAAlB,8CAAkEtD,YAAlE;AACAsS,YAAKhP,YAAL,CAAkB,YAAlB,EAAgC,UAAhC;AACAC,YAAK0C,WAAL,CAAiBqM,IAAjB;AACAH,gBAASrS,OAAT,CAAiByS,mCAAjB;AACD;AACF,IAXM,CAAP;AAYD;;;;;;;;;;;;mBC1CuBA,yB;AALxB;;;;;AAKe,UAASA,yBAAT,CAAmCrR,OAAnC,EAA4C;AACzD,OAAI,CAACA,OAAL,EAAc;AACZ;AACD;;AAED,OAAIoR,OAAOxQ,SAASkF,aAAT,iCAAqD9F,QAAQjB,UAA7D,SAAX;AACA,OAAIqS,IAAJ,EAAU;AACR,SAAIE,OAAO1Q,SAAS0O,aAAT,CAAuB,IAAvB,CAAX;AACAgC,UAAKlP,YAAL,CAAkB,IAAlB,yCAA6DpC,QAAQxB,IAArE;AACA8S,UAAKvM,WAAL,CAAiBnE,SAAS2O,cAAT,MAA2BvP,QAAQhB,OAAnC,CAAjB;AACAoS,UAAKrM,WAAL,CAAiBuM,IAAjB;AACD;AACF;;;;;;;;;;;;mBCPuBC,iB;;AAVxB;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;;;;;AAEA;;;AAGe,UAASA,iBAAT,GAA6B;AAC1C,gCAAiB,gBAAjB,EAAmC,UAACpT,UAAD,EAAaC,MAAb,EAAqBC,UAArB,EAAiCU,UAAjC,EAAgD;AACjFyS,8BAAyBrT,UAAzB,EAAqCC,MAArC,EAA6CC,UAA7C,EAAyDU,WAAWuE,IAApE;AACD,IAFD;AAGA,gCAAiB,iBAAjB,EAAoC,UAACnF,UAAD,EAAaC,MAAb,EAAqBU,YAArB,EAAmCC,UAAnC,EAAkD;AACpFyS,8BAAyBrT,UAAzB,EAAqCC,MAArC,EAA6CW,WAAW6N,IAAxD,EAA8D7N,WAAWuE,IAAzE;AACD,IAFD;AAGA,gCAAiB,mBAAjB,EAAsCmO,gBAAtC;AACA,gCAAiB,aAAjB,EAAgCC,aAAhC;AACA,gCAAiB,gBAAjB,EAAmCC,aAAnC;AACD;;AAED;;;;;;;;AAQA,UAASH,wBAAT,CAAkCrT,UAAlC,EAA8CC,MAA9C,EAAsDC,UAAtD,EAAkEiF,IAAlE,EAAwE;AACtEhG,2BAAcO,eAAd,GAAgCK,cAAhC,CAA+CC,UAA/C,EAA2DC,MAA3D,EAAmEC,UAAnE,EACGe,IADH,CACQ,UAACC,WAAD,EAAiB;AACrB,YAAOA,YAAYA,WAAZ,CAAwBsN,MAAxB,CAA+B,UAACrN,CAAD,EAAO;AAC3C,cAAOA,EAAEgE,IAAF,KAAWA,IAAlB;AACD,MAFM,CAAP;AAGD,IALH,EAMGlE,IANH,CAMQ,UAACC,WAAD,EAAiB;AACrBA,iBAAYT,OAAZ,CAAoB,UAACU,CAAD,EAAO;AACzBmS,wBAAiBtT,UAAjB,EAA6BmB,EAAEd,IAA/B;AACD,MAFD;;AAIA,YAAOa,WAAP;AACD,IAZH,EAaGD,IAbH,CAaQiP,iCAbR;AAcD;;AAED;;;;;;AAMA,UAASoD,gBAAT,CAA0BtT,UAA1B,EAAsCW,YAAtC,EAAoD;AAClD8S,oDAA+C9S,YAA/C;AACA8S,oDAA+C9S,YAA/C;AACD;;AAED;;;;;;;AAOA,UAAS4S,aAAT,CAAuBvT,UAAvB,EAAmCW,YAAnC,EAAiDkB,OAAjD,EAA0D;AACxD,OAAIoR,OAAOxQ,SAASkF,aAAT,6CAAiEhH,YAAjE,CAAX;AACA,OAAIoS,gBAAJ;;AAEA,OAAI,CAACE,IAAL,EAAW;AACTF,eAAU,0CAA2B/S,UAA3B,EAAuCW,YAAvC,EAAqD,EAArD,EAAyDM,IAAzD,CAA8D,YAAM;AAC5EgS,cAAOxQ,SAASkF,aAAT,6CAAiEhH,YAAjE,CAAP;AACA,cAAO,IAAP;AACD,MAHS,CAAV;AAID,IALD,MAKO;AACLoS,eAAU3E,QAAQC,OAAR,CAAgB,IAAhB,CAAV;AACD;;AAED0E,WAAQ9R,IAAR,CAAa,YAAM;AACjB,8CAA0BY,OAA1B;AACD,IAFD;AAGD;;AAED;;;;;;AAMA,UAAS2R,aAAT,CAAuBxT,UAAvB,EAAmCc,SAAnC,EAA8C;AAC5C2S,4DAAuD3S,SAAvD;AACD;;AAED;;;;;AAKA,UAAS2S,iBAAT,CAA2BC,SAA3B,EAAsC;AACpC,OAAI5O,KAAKrC,SAASuQ,cAAT,CAAwBU,SAAxB,CAAT;AACA,OAAI5O,EAAJ,EAAQ;AACNA,QAAGX,UAAH,CAAc0C,WAAd,CAA0B/B,EAA1B;AACD;AACF;;;;;;;;;;;;;ACvGD;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;mBAEe;AACb1C,4CADa,EACKC,+CADL,EAC0BF,2BAD1B;AAEbwR,iCAFa,EAEAC,4BAFA;AAGbC,8BAHa,EAGDC,yBAHC,EAGUC,mBAHV;AAIbC,qCAJa,EAICC,oCAJD;AAKbC,oCALa,EAKCC,+BALD;AAMbC,iCANa,EAMAC,4BANA;AAObC,uCAPa,EAOEC,kCAPF,EAOgBC,4BAPhB,EAO2BC,4BAP3B;AAQbC,oCARa,EAQCC,+BARD,EAQcC,yBARd;AASbC,iCATa,EASAC,4BATA,EASYC,sBATZ;AAUbC,+BAVa,EAUDC;AAVC,E;;;;;;;;;;;;;;;SC4UCrB,U,GAAAA,U;SAUAD,W,GAAAA,W;;AAjWhB;;;;AACA;;;;AACA;;AACA;;AAIA;;;;;;AAYA,KAAIuB,WAAW,KAAf;AACA,KAAIC,aAAa,KAAjB;AAAA,KAAwBC,gBAAxB;AACA,KAAIC,oBAAJ;AAAA,KAAiBC,oBAAjB;AAAA,KAA8BC,mBAA9B;AAAA,KAA0CC,mBAA1C;AACA,KAAMC,sBAAsB,CAA5B;;AAEA;;;;;AAKA,UAASC,iBAAT,CAA2B5S,MAA3B,EAAmC;AACjC6S;;AAEAP,aAAU3S,SAAS0O,aAAT,CAAuB,KAAvB,CAAV;AACA,OAAIyE,SAASnT,SAAS0O,aAAT,CAAuB,GAAvB,CAAb;AACA,OAAIhN,aAAa,6BAAiBrB,MAAjB,EAAyBqB,UAA1C;AACA,OAAI0R,KAAK/S,OAAOwB,YAAP,CAAoB,sBAApB,CAAT;AACA,OAAIS,OAAO,oCAAwBjC,MAAxB,CAAX;AACA,OAAIgT,YAAY/Q,KAAKO,IAAL,GAAYmQ,mBAA5B;AACA,OAAIM,WAAWhR,KAAKK,GAAL,GAAWqQ,mBAA1B;;AAEAL,WAAQnR,YAAR,CAAqB,IAArB,EAA2B,2BAA3B;AACAmR,WAAQnR,YAAR,CAAqB,gBAArB,EAAuC4R,EAAvC;AACAT,WAAQ/D,KAAR,CAAc2E,SAAd,GAA0B,aAA1B;AACAZ,WAAQ/D,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACA8D,WAAQ/D,KAAR,CAAcjM,GAAd,GAAuB2Q,QAAvB;AACAX,WAAQ/D,KAAR,CAAc/L,IAAd,GAAwBwQ,SAAxB;AACAV,WAAQ/D,KAAR,CAAc3L,KAAd,GAAyBX,KAAKW,KAA9B;AACA0P,WAAQ/D,KAAR,CAAc1L,MAAd,GAA0BZ,KAAKY,MAA/B;AACAyP,WAAQ/D,KAAR,CAAc4E,MAAd,GAA0BR,mBAA1B,iBAAyD3R,mBAAzD;AACAsR,WAAQ/D,KAAR,CAAc6E,YAAd,GAAgCT,mBAAhC;AACAL,WAAQ/D,KAAR,CAAc8E,MAAd,GAAuB,KAAvB;;AAEAP,UAAOlL,SAAP,GAAmB,GAAnB;AACAkL,UAAO3R,YAAP,CAAoB,MAApB,EAA4B,eAA5B;AACA2R,UAAOvE,KAAP,CAAa+E,UAAb,GAA0B,MAA1B;AACAR,UAAOvE,KAAP,CAAa6E,YAAb,GAA4B,MAA5B;AACAN,UAAOvE,KAAP,CAAa4E,MAAb,GAAsB,gBAAtB;AACAL,UAAOvE,KAAP,CAAanJ,KAAb,GAAqB,MAArB;AACA0N,UAAOvE,KAAP,CAAa7G,QAAb,GAAwB,MAAxB;AACAoL,UAAOvE,KAAP,CAAagF,OAAb,GAAuB,KAAvB;AACAT,UAAOvE,KAAP,CAAaiF,SAAb,GAAyB,QAAzB;AACAV,UAAOvE,KAAP,CAAakF,cAAb,GAA8B,MAA9B;AACAX,UAAOvE,KAAP,CAAaC,QAAb,GAAwB,UAAxB;AACAsE,UAAOvE,KAAP,CAAajM,GAAb,GAAmB,OAAnB;AACAwQ,UAAOvE,KAAP,CAAa9L,KAAb,GAAqB,OAArB;AACAqQ,UAAOvE,KAAP,CAAa3L,KAAb,GAAqB,MAArB;AACAkQ,UAAOvE,KAAP,CAAa1L,MAAb,GAAsB,MAAtB;;AAEAyP,WAAQxO,WAAR,CAAoBgP,MAApB;AACAzR,cAAWyC,WAAX,CAAuBwO,OAAvB;AACA3S,YAASL,gBAAT,CAA0B,OAA1B,EAAmCM,mBAAnC;AACAD,YAASL,gBAAT,CAA0B,OAA1B,EAAmCoU,mBAAnC;AACA/T,YAASL,gBAAT,CAA0B,WAA1B,EAAuCqU,uBAAvC;AACAb,UAAOxT,gBAAP,CAAwB,OAAxB,EAAiCX,gBAAjC;AACAmU,UAAOxT,gBAAP,CAAwB,WAAxB,EAAqC,YAAM;AACzCwT,YAAOvE,KAAP,CAAanJ,KAAb,GAAqB,SAArB;AACA0N,YAAOvE,KAAP,CAAaqF,WAAb,GAA2B,MAA3B;AACAd,YAAOvE,KAAP,CAAasF,SAAb,GAAyB,gBAAzB;AACD,IAJD;AAKAf,UAAOxT,gBAAP,CAAwB,UAAxB,EAAoC,YAAM;AACxCwT,YAAOvE,KAAP,CAAanJ,KAAb,GAAqB,MAArB;AACA0N,YAAOvE,KAAP,CAAaqF,WAAb,GAA2B,MAA3B;AACAd,YAAOvE,KAAP,CAAasF,SAAb,GAAyB,EAAzB;AACD,IAJD;AAKAvB,WAAQhT,gBAAR,CAAyB,WAAzB,EAAsC,YAAM;AAC1C,SAAI,CAAC+S,UAAL,EAAiB;AAAES,cAAOvE,KAAP,CAAauF,OAAb,GAAuB,EAAvB;AAA4B;AAChD,IAFD;AAGAxB,WAAQhT,gBAAR,CAAyB,UAAzB,EAAqC,YAAM;AACzCwT,YAAOvE,KAAP,CAAauF,OAAb,GAAuB,MAAvB;AACD,IAFD;AAGD;;AAED;;;AAGA,UAASjB,kBAAT,GAA8B;AAC5B,OAAIP,OAAJ,EAAa;AACXA,aAAQjR,UAAR,CAAmB0C,WAAnB,CAA+BuO,OAA/B;AACAA,eAAU,IAAV;AACD;;AAED3S,YAASJ,mBAAT,CAA6B,OAA7B,EAAsCK,mBAAtC;AACAD,YAASJ,mBAAT,CAA6B,OAA7B,EAAsCmU,mBAAtC;AACA/T,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CoU,uBAA1C;AACAhU,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACApU,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACA;AACD;;AAED;;;AAGA,UAASrV,gBAAT,GAA4B;AAC1B,OAAI,CAAC2T,OAAL,EAAc;AAAE;AAAS;;AAEzB,OAAIzU,eAAeyU,QAAQ9Q,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAImN,QAAQhP,SAASiC,gBAAT,6BAAoD/D,YAApD,QAAZ;AACA,OAAIiF,MAAMwP,QAAQjR,UAAR,CAAmBwD,aAAnB,CAAiCvH,iBAAO4R,kBAAP,EAAjC,CAAV;;AAL0B,sBAML,wBAAYpM,GAAZ,CANK;AAAA,OAMpB5F,UANoB,gBAMpBA,UANoB;;AAQ1B,gCAAIyR,KAAJ,GAAWhR,OAAX,CAAmB,UAACmH,CAAD,EAAO;AACxBA,OAAEzD,UAAF,CAAa0C,WAAb,CAAyBe,CAAzB;AACD,IAFD;;AAIAzI,2BAAcO,eAAd,GAAgC+B,gBAAhC,CAAiDzB,UAAjD,EAA6DW,YAA7D;;AAEAgV;AACD;;AAED;;;;;AAKA,UAASjT,mBAAT,CAA6BC,CAA7B,EAAgC;AAC9B,OAAI,CAAC,2BAAeA,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAL,EAA2C;AAAE;AAAS;;AAEtD;AACA,OAAIuS,UAAU3S,SAASuQ,cAAT,CAAwB,2BAAxB,CAAd;AACA,OAAIoC,OAAJ,EAAa;AACX,SAAID,cAAcxS,EAAEG,MAAF,KAAasS,OAA/B,EAAwC;AACtC;AACD;;AAEDO;AACD;AACF;;AAED;;;;;AAKA,UAASa,mBAAT,CAA6B7T,CAA7B,EAAgC;AAC9B,OAAIyS,WAAWzS,EAAEoU,OAAF,KAAc,EAAzB,IACApU,EAAEG,MAAF,CAASsB,QAAT,CAAkBqD,WAAlB,OAAoC,UADpC,IAEA9E,EAAEG,MAAF,CAASsB,QAAT,CAAkBqD,WAAlB,OAAoC,OAFxC,EAEiD;AAC/ChG;AACD;AACF;;AAED;;;;;AAKA,UAASgV,uBAAT,CAAiC9T,CAAjC,EAAoC;AAClC,OAAIA,EAAEG,MAAF,KAAasS,OAAjB,EAA0B;AAAE;AAAS;;AAErC;AACA;AACA,OAAIzU,eAAeyU,QAAQ9Q,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIxB,SAASL,SAASkF,aAAT,6BAAiDhH,YAAjD,QAAb;AACA,OAAIwE,OAAOrC,OAAOwB,YAAP,CAAoB,wBAApB,CAAX;;AAEA,OAAIa,SAAS,WAAT,IAAwBA,SAAS,WAArC,EAAkD;AAAE;AAAS;;AAE7DgQ,gBAAa,IAAb;AACAE,iBAAc1S,EAAEC,OAAhB;AACA0S,iBAAc3S,EAAEE,OAAhB;AACA0S,gBAAaH,QAAQ5P,UAArB;AACAgQ,gBAAaJ,QAAQ3P,SAArB;;AAEA2P,WAAQ/D,KAAR,CAAc+E,UAAd,GAA2B,0BAA3B;AACAhB,WAAQ/D,KAAR,CAAc2F,MAAd,GAAuB,MAAvB;AACA5B,WAAQzN,aAAR,CAAsB,GAAtB,EAA2B0J,KAA3B,CAAiCuF,OAAjC,GAA2C,MAA3C;;AAEAnU,YAASL,gBAAT,CAA0B,WAA1B,EAAuCyU,uBAAvC;AACApU,YAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACA;AACD;;AAED;;;;;AAKA,UAASD,uBAAT,CAAiClU,CAAjC,EAAoC;AAClC,OAAIhC,eAAeyU,QAAQ9Q,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIH,aAAaiR,QAAQjR,UAAzB;AACA,OAAIY,OAAOZ,WAAWa,qBAAX,EAAX;AACA,OAAIR,IAAKgR,cAAc7S,EAAEE,OAAF,GAAYyS,WAA1B,CAAT;AACA,OAAI/Q,IAAKgR,cAAc5S,EAAEC,OAAF,GAAYyS,WAA1B,CAAT;AACA,OAAI4B,OAAO,CAAX;AACA,OAAIC,OAAOnS,KAAKY,MAAhB;AACA,OAAIwR,OAAO,CAAX;AACA,OAAIC,OAAOrS,KAAKW,KAAhB;;AAEA,OAAIlB,IAAIyS,IAAJ,IAAYzS,IAAI4Q,QAAQiC,YAAZ,GAA2BH,IAA3C,EAAiD;AAC/C9B,aAAQ/D,KAAR,CAAcjM,GAAd,GAAuBZ,CAAvB;AACD;;AAED,OAAID,IAAI4S,IAAJ,IAAY5S,IAAI6Q,QAAQkC,WAAZ,GAA0BF,IAA1C,EAAgD;AAC9ChC,aAAQ/D,KAAR,CAAc/L,IAAd,GAAwBf,CAAxB;AACD;AACF;;AAED;;;;;AAKA,UAASuS,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIhC,eAAeyU,QAAQ9Q,YAAR,CAAqB,gBAArB,CAAnB;AACA,OAAIxB,SAASL,SAASiC,gBAAT,6BAAoD/D,YAApD,QAAb;AACA,OAAIwE,OAAOrC,OAAO,CAAP,EAAUwB,YAAV,CAAuB,wBAAvB,CAAX;AACA,OAAIsB,MAAMwP,QAAQjR,UAAR,CAAmBwD,aAAnB,CAAiCvH,iBAAO4R,kBAAP,EAAjC,CAAV;;AAJgC,uBAKH,wBAAYpM,GAAZ,CALG;AAAA,OAK1B5F,UAL0B,iBAK1BA,UAL0B;AAAA,OAKdC,MALc,iBAKdA,MALc;;AAOhCmV,WAAQzN,aAAR,CAAsB,GAAtB,EAA2B0J,KAA3B,CAAiCuF,OAAjC,GAA2C,EAA3C;;AAEAzX,2BAAcO,eAAd,GAAgCiP,aAAhC,CAA8C3O,UAA9C,EAA0DC,MAA1D,EAAkEU,YAAlE,EAAgFM,IAAhF,CAAqF,UAACL,UAAD,EAAgB;AACnG,SAAI2W,UAAU,GAAd;AACA,SAAIC,UAAU,GAAd;AACA,SAAI,CAAC,QAAD,EAAW,YAAX,EAAyB,aAAzB,EAAwCzO,OAAxC,CAAgD5D,IAAhD,IAAwD,CAAC,CAA7D,EAAgE;AAC9DoS,iBAAU,IAAV;AACAC,iBAAU,IAAV;AACD;AACD,SAAI,CAAC,MAAD,EAAS,WAAT,EAAsB,OAAtB,EAA+B,SAA/B,EAA0C,QAA1C,EAAoD,YAApD,EAAkE,aAAlE,EAAiFzO,OAAjF,CAAyF5D,IAAzF,IAAiG,CAAC,CAAtG,EAAyG;AACvG,WAAIsS,aAAa,8BAAkB,CAAClC,UAAD,EAAaC,UAAb,CAAlB,EAA4C5P,GAA5C,CAAjB;AACA,WAAI8R,WAAW,8BAAkB,CAACtC,QAAQ5P,UAAT,EAAqB4P,QAAQ3P,SAA7B,CAAlB,EAA2DG,GAA3D,CAAf;AACA,WAAI+R,aAAa;AACfpT,YAAGmT,SAAS,CAAT,IAAcD,WAAW,CAAX,CADF;AAEfjT,YAAGkT,SAAS,CAAT,IAAcD,WAAW,CAAX;AAFF,QAAjB;;AAKA,WAAItS,SAAS,SAAb,EAAwB;AACtBrC,kBAAS,CAACA,OAAO,CAAP,EAAU8U,UAAX,CAAT;AACD;;AAED,oCAAI9U,MAAJ,GAAYrC,OAAZ,CAAoB,UAACoX,CAAD,EAAIlT,CAAJ,EAAU;AAC5B,aAAImT,SAAShR,SAAS+Q,EAAEvT,YAAF,CAAeiT,OAAf,CAAT,EAAkC,EAAlC,CAAb;AACA,aAAIQ,SAASjR,SAAS+Q,EAAEvT,YAAF,CAAekT,OAAf,CAAT,EAAkC,EAAlC,CAAb;AACA,aAAIG,WAAWnT,CAAX,KAAiB,CAArB,EAAwB;AACtBuT,oBAASA,SAASJ,WAAWnT,CAA7B;AACA,eAAIwT,QAAQD,MAAZ;;AAEA,eAAI5S,SAAS,OAAb,EAAsB;AACpB6S,qBAAQ,oBAAQpS,GAAR,EAAa,EAAEoS,YAAF,EAAb,EAAwBA,KAAhC;AACD;;AAEDH,aAAE5T,YAAF,CAAeuT,OAAf,EAAwBQ,KAAxB;AACA,eAAIpX,WAAWwH,UAAX,IAAyBzD,IAAI/D,WAAWwH,UAAX,CAAsBvD,MAAvD,EAA+D;AAC7DjE,wBAAWwH,UAAX,CAAsBzD,CAAtB,EAAyBH,CAAzB,GAA6BuT,MAA7B;AACD,YAFD,MAEO,IAAInX,WAAW4W,OAAX,CAAJ,EAAyB;AAC9B5W,wBAAW4W,OAAX,IAAsBO,MAAtB;AACD;AACF;AACD,aAAIJ,WAAWpT,CAAX,KAAiB,CAArB,EAAwB;AACtBuT,oBAASA,SAASH,WAAWpT,CAA7B;AACA,eAAI0T,QAAQH,MAAZ;;AAEA,eAAI3S,SAAS,OAAb,EAAsB;AACpB8S,qBAAQ,oBAAQrS,GAAR,EAAa,EAAEqS,YAAF,EAAb,EAAwBA,KAAhC;AACD;;AAEDJ,aAAE5T,YAAF,CAAesT,OAAf,EAAwBU,KAAxB;AACA,eAAIrX,WAAWwH,UAAX,IAA0BzD,IAAI/D,WAAWwH,UAAX,CAAsBvD,MAAxD,EAAgE;AAC9DjE,wBAAWwH,UAAX,CAAsBzD,CAAtB,EAAyBJ,CAAzB,GAA6BuT,MAA7B;AACD,YAFD,MAEO,IAAIlX,WAAW2W,OAAX,CAAJ,EAAyB;AAC9B3W,wBAAW2W,OAAX,IAAsBO,MAAtB;AACD;AACF;AACF,QAjCD;AAkCF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACC,MA5DD,MA4DO,IAAI3S,SAAS,SAAT,IAAsBA,SAAS,OAAnC,EAA4C;AACjD,WAAIsS,cAAa,8BAAkB,CAAClC,UAAD,EAAaC,UAAb,CAAlB,EAA4C5P,GAA5C,CAAjB;AACA,WAAI8R,YAAW,8BAAkB,CAACtC,QAAQ5P,UAAT,EAAqB4P,QAAQ3P,SAA7B,CAAlB,EAA2DG,GAA3D,CAAf;AACA,WAAI+R,cAAa;AACfpT,YAAGmT,UAAS,CAAT,IAAcD,YAAW,CAAX,CADF;AAEfjT,YAAGkT,UAAS,CAAT,IAAcD,YAAW,CAAX;AAFF,QAAjB;;AAKA7W,kBAAW2I,KAAX,CAAiB9I,OAAjB,CAAyB,UAAC6H,IAAD,EAAO3D,CAAP,EAAa;AAAA,kDACvB/D,WAAW2I,KAAX,CAAiB5E,CAAjB,CADuB;AAAA,aAC/BJ,CAD+B;AAAA,aAC5BC,CAD4B;;AAEpC5D,oBAAW2I,KAAX,CAAiB5E,CAAjB,EAAoB,CAApB,IAAyBJ,IAAIoT,YAAWpT,CAAxC;AACA3D,oBAAW2I,KAAX,CAAiB5E,CAAjB,EAAoB,CAApB,IAAyBH,IAAImT,YAAWnT,CAAxC;AACD,QAJD;;AAMA1B,cAAO,CAAP,EAAUqB,UAAV,CAAqB0C,WAArB,CAAiC/D,OAAO,CAAP,CAAjC;AACA,qCAAY8C,GAAZ,EAAiBhF,UAAjB;AACD;;AAEDzB,6BAAcO,eAAd,GAAgC6B,cAAhC,CAA+CvB,UAA/C,EAA2DW,YAA3D,EAAyEC,UAAzE;AACD,IAtFD;;AAwFAsX,cAAW,YAAM;AACf/C,kBAAa,KAAb;AACD,IAFD,EAEG,CAFH;;AAIAC,WAAQ/D,KAAR,CAAc+E,UAAd,GAA2B,EAA3B;AACAhB,WAAQ/D,KAAR,CAAc2F,MAAd,GAAuB,EAAvB;;AAEAvU,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACApU,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACA;AACD;;AAED;;;;;AAKA,UAASqB,qBAAT,CAA+BrV,MAA/B,EAAuC;AACrC4S,qBAAkB5S,MAAlB;AACD;;AAED;;;AAGO,UAAS8Q,UAAT,GAAuB;AAC5B,OAAIsB,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACA,gCAAiB,kBAAjB,EAAqCiD,qBAArC;AACD;;AAED;;;AAGO,UAASxE,WAAT,GAAwB;AAC7BgC;;AAEA,OAAI,CAACT,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACA,mCAAoB,kBAApB,EAAwCiD,qBAAxC;AACD,G;;;;;;;;;;;SCxNepE,M,GAAAA,M;SAQAD,S,GAAAA,S;SAwBAD,U,GAAAA,U;;AAhLhB;;;;AACA;;AACA;;;;AAQA,KAAIqB,WAAW,KAAf;AACA,KAAIkD,WAAW,KAAf;AACA,KAAIC,iBAAJ;AACA,KAAIC,kBAAJ;AACA,KAAI5Q,aAAJ;AACA,KAAI6B,QAAQ,EAAZ;;AAEA,KAAMpC,YAAY,WAAWC,IAAX,CAAgBC,UAAUC,SAA1B,CAAlB;;AAEA;;;AAGA,UAASiR,yBAAT,CAAmC5V,CAAnC,EAAsC;AACpCA,KAAE6V,cAAF;AACA9Q,UAAO,IAAP;AACA6B,WAAQ,EAAR;AACA6O,cAAW,IAAX;AACD;;AAED;;;;;AAKA,UAASK,6BAAT,CAAuC9V,CAAvC,EAAyC;AACvC+V,iBAAc/V,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB/V,OAAlC,EAA2CD,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB9V,OAA/D;AACD;;AAED,UAAS+V,uBAAT,CAAiCjW,CAAjC,EAAoC;AAClC+V,iBAAc/V,EAAEC,OAAhB,EAAyBD,EAAEE,OAA3B;AACD;;AAED,UAAS6V,aAAT,CAAuBnU,CAAvB,EAA0BC,CAA1B,EAA4B;AAC1B4T,cAAW,KAAX;AACA,OAAIxS,YAAJ;AACA,OAAI2D,MAAM1E,MAAN,GAAe,CAAf,KAAqBe,MAAM,2BAAerB,CAAf,EAAkBC,CAAlB,CAA3B,CAAJ,EAAsD;AAAA,wBACX,wBAAYoB,GAAZ,CADW;AAAA,SAC9C5F,UAD8C,gBAC9CA,UAD8C;AAAA,SAClCC,MADkC,gBAClCA,MADkC;AAAA,SAC1BC,UAD0B,gBAC1BA,UAD0B;;AAEpDf,6BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DC,MAA1D,EAAkEC,UAAlE,EAA8E;AAC1EiF,aAAM,SADoE;AAE1EO,cAAO2S,QAFmE;AAG1EnQ,cAAOoQ,SAHmE;AAI1E/O;AAJ0E,MAA9E,EAMEtI,IANF,CAMO,UAACL,UAAD,EAAgB;AACrB,WAAI8G,IAAJ,EAAU;AACR9B,aAAIiB,WAAJ,CAAgBa,IAAhB;AACD;;AAED,qCAAY9B,GAAZ,EAAiBhF,UAAjB;AACD,MAZD;AAaD;AACF;;AAED;;;;;AAKA,UAASiY,yBAAT,CAAmClW,CAAnC,EAAsC;AACpC,OAAG,CAACA,EAAEmW,UAAF,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,iBAAhC,CAAJ,EAAuD;AACrD;AACD;AACD,OAAGZ,QAAH,EAAY;AACVa,eAAUtW,EAAEC,OAAZ,EAAqBD,EAAEE,OAAvB;AACD;AACF;;AAED,UAASqW,+BAAT,CAAyCvW,CAAzC,EAA2C;AACzC,OAAG,CAACA,EAAEmW,UAAF,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,iBAAhC,CAAJ,EAAuD;AACrD;AACD;AACD,OAAGZ,QAAH,EAAY;AACVa,eAAUtW,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB/V,OAA9B,EAAuCD,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB9V,OAA3D;AACD;AACF;;AAED;;;;;AAKA,UAAS2T,mBAAT,CAA6B7T,CAA7B,EAAgC;AAC9B;AACA,OAAIA,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AACpBxN,aAAQ,IAAR;AACA7B,UAAKvD,UAAL,CAAgB0C,WAAhB,CAA4Ba,IAA5B;AACAjF,cAASJ,mBAAT,CAA6B,aAA7B,EAA4CwW,yBAA5C;AACApW,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CuW,uBAA1C;AACD;AACF;;AAED;;;;;;AAMA,UAASK,SAAT,CAAmB1U,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,OAAIoB,MAAM,2BAAerB,CAAf,EAAkBC,CAAlB,CAAV;AACA,OAAI,CAACoB,GAAL,EAAU;AACR;AACD;;AAED,OAAIb,OAAOa,IAAIZ,qBAAJ,EAAX;AACA,OAAImU,QAAQ,8BAAkB,CAC5B5U,IAAIQ,KAAKO,IADmB,EAE5Bd,IAAIO,KAAKK,GAFmB,CAAlB,EAGTQ,GAHS,CAAZ;AAIAuT,SAAM,CAAN,IAAWA,MAAM,CAAN,EAASC,OAAT,CAAiB,CAAjB,CAAX;AACAD,SAAM,CAAN,IAAWA,MAAM,CAAN,EAASC,OAAT,CAAiB,CAAjB,CAAX;AACA7P,SAAMG,IAAN,CAAWyP,KAAX;;AAEA,OAAI5P,MAAM1E,MAAN,IAAgB,CAApB,EAAuB;AACrB;AACD;;AAED,OAAI6C,IAAJ,EAAU;AACR9B,SAAIiB,WAAJ,CAAgBa,IAAhB;AACD;;AAEDA,UAAO,8BAAY9B,GAAZ,EAAiB;AACtBT,WAAM,SADgB;AAEtB+C,YAAOoQ,SAFe;AAGtB5S,YAAO2S,QAHe;AAItB9O;AAJsB,IAAjB,CAAP;AAMD;;AAED;;;;;;AAMO,UAASwK,MAAT,GAAkD;AAAA,OAAlCsF,OAAkC,uEAAxB,CAAwB;AAAA,OAArBC,QAAqB,uEAAV,QAAU;;AACvDjB,cAAWvR,SAASuS,OAAT,EAAkB,EAAlB,CAAX;AACAf,eAAYgB,QAAZ;AACD;;AAED;;;AAGO,UAASxF,SAAT,GAAqB;AAC1B,OAAIoB,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACA;AACA,OAAI,CAAC/N,SAAL,EAAe;AACb1E,cAASL,gBAAT,CAA0B,YAA1B,EAAwCmW,yBAAxC;AACA9V,cAASL,gBAAT,CAA0B,WAA1B,EAAuC8W,+BAAvC;AACAzW,cAASL,gBAAT,CAA0B,UAA1B,EAAsCqW,6BAAtC;AACAhW,cAASL,gBAAT,CAA0B,WAA1B,EAAuCmW,yBAAvC;AACA9V,cAASL,gBAAT,CAA0B,WAA1B,EAAuCyW,yBAAvC;AACApW,cAASL,gBAAT,CAA0B,SAA1B,EAAqCwW,uBAArC;AACD,IAPD,MAOO;AACLnW,cAASL,gBAAT,CAA0B,aAA1B,EAAyCmW,yBAAzC;AACA9V,cAASL,gBAAT,CAA0B,aAA1B,EAAyCyW,yBAAzC;AACApW,cAASL,gBAAT,CAA0B,WAA1B,EAAuCwW,uBAAvC;AACD;AACDnW,YAASL,gBAAT,CAA0B,OAA1B,EAAmCoU,mBAAnC;AACA;AACD;;AAED;;;AAGO,UAAS3C,UAAT,GAAsB;AAC3B,OAAI,CAACqB,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACA,OAAI,CAAC/N,SAAL,EAAe;AACb1E,cAASJ,mBAAT,CAA6B,YAA7B,EAA2CkW,yBAA3C;AACA9V,cAASJ,mBAAT,CAA6B,WAA7B,EAA0C6W,+BAA1C;AACAzW,cAASJ,mBAAT,CAA6B,UAA7B,EAAyCoW,6BAAzC;AACAhW,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CkW,yBAA1C;AACA9V,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CwW,yBAA1C;AACApW,cAASJ,mBAAT,CAA6B,SAA7B,EAAwCuW,uBAAxC;AACD,IAPD,MAOO;AACLnW,cAASJ,mBAAT,CAA6B,aAA7B,EAA4CkW,yBAA5C;AACA9V,cAASJ,mBAAT,CAA6B,aAA7B,EAA4CwW,yBAA5C;AACApW,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CuW,uBAA1C;AACD;AACDnW,YAASJ,mBAAT,CAA6B,OAA7B,EAAsCmU,mBAAtC;AACA;AACD,E;;;;;;;;;;;SCxJexC,Y,GAAAA,Y;SAUAC,a,GAAAA,a;;AApDhB;;;;AACA;;;;AACA;;;;;;AAMA,KAAIsF,YAAY,KAAhB;AACA,KAAItZ,SAAS,MAAb;;AAEA,UAASuZ,kBAAT,CAA4B7W,CAA5B,EAA8B;AAC5B4W,eAAY,IAAZ;AACD;;AAED,UAASE,gBAAT,CAA0B9W,CAA1B,EAA4B;AAC1B4W,eAAY,KAAZ;AACD;;AAED,UAASG,uBAAT,CAAiC/W,CAAjC,EAAmC;AACjCgX,SAAM,kCAAsBhX,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB/V,OAA1C,EAAmDD,EAAEgW,cAAF,CAAiB,CAAjB,EAAoB9V,OAAvE,CAAN;AACD;;AAED,UAAS+W,uBAAT,CAAiCjX,CAAjC,EAAmC;AACjCgX,SAAM,kCAAsBhX,EAAEC,OAAxB,EAAiCD,EAAEE,OAAnC,CAAN;AACD;;AAED,UAAS8W,KAAT,CAAe7W,MAAf,EAAsB;AACpB,OAAGyW,SAAH,EAAa;AACX,SAAGzW,UAAUA,OAAOwB,YAAP,CAAoB,0BAApB,KAAmDrE,MAAhE,EAAuE;AAAA,0BAChD,wBAAY6C,OAAO+W,aAAnB,CADgD;AAAA,WAC/D7Z,UAD+D,gBAC/DA,UAD+D;;AAErE,WAAIW,eAAemC,OAAOwB,YAAP,CAAoB,sBAApB,CAAnB;AACA,WAAImN,QAAQhP,SAASiC,gBAAT,6BAAoD/D,YAApD,QAAZ;AACA,oCAAI8Q,KAAJ,GAAWhR,OAAX,CAAmB,UAACmH,CAAD,EAAO;AACxBA,WAAEzD,UAAF,CAAa0C,WAAb,CAAyBe,CAAzB;AACD,QAFD;;AAIAzI,+BAAcO,eAAd,GAAgC+B,gBAAhC,CAAiDzB,UAAjD,EAA6DC,MAA7D,EAAqEU,YAArE;AACD;AACF;AACF;;AAEM,UAASqT,YAAT,GAAuB;AAC5B/T,YAASd,wBAAcO,eAAd,GAAgCO,MAAzC;AACAwC,YAASL,gBAAT,CAA0B,WAA1B,EAAuCwX,uBAAvC;AACAnX,YAASL,gBAAT,CAA0B,WAA1B,EAAuCoX,kBAAvC;AACA/W,YAASL,gBAAT,CAA0B,SAA1B,EAAqCqX,gBAArC;AACAhX,YAASL,gBAAT,CAA0B,YAA1B,EAAwCoX,kBAAxC;AACA/W,YAASL,gBAAT,CAA0B,WAA1B,EAAuCsX,uBAAvC;AACAjX,YAASL,gBAAT,CAA0B,UAA1B,EAAsCqX,gBAAtC;AACD;;AAEM,UAASxF,aAAT,GAAwB;AAC7BxR,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CuX,uBAA1C;AACAnX,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CmX,kBAA1C;AACA/W,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCoX,gBAAxC;AACAhX,YAASJ,mBAAT,CAA6B,YAA7B,EAA2CmX,kBAA3C;AACA/W,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CqX,uBAA1C;AACAjX,YAASJ,mBAAT,CAA6B,UAA7B,EAAyCoX,gBAAzC;AACD,E;;;;;;;;;;;SCoGe7E,Q,GAAAA,Q;SAQAD,W,GAAAA,W;SAYAD,Y,GAAAA,Y;;AAnLhB;;;;AACA;;AACA;;;;AAWA,KAAIQ,WAAW,KAAf;AACA,KAAImD,iBAAJ;AACA,KAAIC,kBAAJ;AACA,KAAI5Q,aAAJ;AACA,KAAI6B,cAAJ;AACA,KAAIuQ,gBAAJ;AACA,KAAIC,gBAAJ;;AAEA;;;AAGA,UAAStD,uBAAT,CAAiC9T,CAAjC,EAAoC;AAClC,OAAIG,SAAS,kCAAsBH,EAAEC,OAAxB,EAAiCD,EAAEE,OAAnC,CAAb;AACA,OAAIC,WAAW,IAAf,EACE;;AAEF,OAAIqC,OAAOrC,OAAOwB,YAAP,CAAoB,wBAApB,CAAX;AACA,OAAIa,SAAS,QAAT,IAAqBA,SAAS,YAA9B,IAA8CA,SAAS,aAA3D,EAA0E;AACxE;AACD;;AAED,OAAIS,MAAM,6BAAiB9C,MAAjB,CAAV;;AAVkC,sBAWL,wBAAY8C,GAAZ,CAXK;AAAA,OAW5B5F,UAX4B,gBAW5BA,UAX4B;AAAA,OAWhBC,MAXgB,gBAWhBA,MAXgB;;AAYlC,OAAIU,eAAemC,OAAOwB,YAAP,CAAoB,sBAApB,CAAnB;;AAEA,OAAI0V,QAAQrX,CAAZ;AACAxD,2BAAcO,eAAd,GAAgCiP,aAAhC,CAA8C3O,UAA9C,EAA0DC,MAA1D,EAAkEU,YAAlE,EAAgFM,IAAhF,CAAqF,UAACL,UAAD,EAAgB;AACnG,SAAIA,UAAJ,EAAgB;AACd8G,cAAO,IAAP;AACA6B,eAAQ,EAAR;;AAEA,WAAI4P,QAAQ,iCAAqB,CAC/BvY,WAAWmK,EADoB,EAE/BnK,WAAWoK,EAFoB,CAArB,EAGTpF,GAHS,CAAZ;;AAKA,WAAIb,OAAOa,IAAIZ,qBAAJ,EAAX;;AAEA+U,iBAAUZ,MAAM,CAAN,IAAWpU,KAAKO,IAA1B;AACAwU,iBAAUX,MAAM,CAAN,IAAWpU,KAAKK,GAA1B;;AAEA3C,gBAASL,gBAAT,CAA0B,WAA1B,EAAuCyU,uBAAvC;AACApU,gBAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACD;AACF,IAlBD;AAmBD;;AAED;;;;;AAKA,UAASA,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIiD,YAAJ;AACA,OAAI2D,MAAM1E,MAAN,GAAe,CAAf,KAAqBe,MAAM,2BAAejD,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAA3B,CAAJ,EAAsE;AAAA,yBACnC,wBAAY+C,GAAZ,CADmC;AAAA,SAC9D5F,UAD8D,iBAC9DA,UAD8D;AAAA,SAClDE,UADkD,iBAClDA,UADkD;;AAGpEf,6BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DE,UAA1D,EAAsE;AAClEiF,aAAM,OAD4D;AAElEO,cAAO2S,QAF2D;AAGlEnQ,cAAOoQ,SAH2D;AAIlE/O;AAJkE,MAAtE,EAMEtI,IANF,CAMO,UAACL,UAAD,EAAgB;AACrB,WAAI8G,IAAJ,EAAU;AACR9B,aAAIiB,WAAJ,CAAgBa,IAAhB;AACD;;AAED,qCAAY9B,GAAZ,EAAiBhF,UAAjB;AACD,MAZD;AAaD;;AAED6B,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACApU,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACD;;AAED;;;;;AAKA,UAASD,uBAAT,CAAiClU,CAAjC,EAAoC;AAClC,OAAI4B,IAAIgF,MAAM1E,MAAN,KAAiB,CAAjB,GAAqBkV,OAArB,GAA+BpX,EAAEC,OAAzC;AACA,OAAI4B,IAAI+E,MAAM1E,MAAN,KAAiB,CAAjB,GAAqBiV,OAArB,GAA+BnX,EAAEE,OAAzC;;AAEAoW,aAAU1U,CAAV,EAAaC,CAAb;AACD;;AAED;;;;;AAKA,UAASgS,mBAAT,CAA6B7T,CAA7B,EAAgC;AAC9B;AACA,OAAIA,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AACpBxN,aAAQ,IAAR;AACA7B,UAAKvD,UAAL,CAAgB0C,WAAhB,CAA4Ba,IAA5B;AACAjF,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACApU,cAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACD;AACF;;AAED;;;;;;AAMA,UAASmC,SAAT,CAAmB1U,CAAnB,EAAsBC,CAAtB,EAAyB;AACvB,OAAIoB,MAAM,2BAAerB,CAAf,EAAkBC,CAAlB,CAAV;AACA,OAAI,CAACoB,GAAL,EAAU;AACR;AACD;;AAED,OAAIb,OAAOa,IAAIZ,qBAAJ,EAAX;AACA,OAAImU,QAAQ,8BAAkB,CAC5B5U,IAAIQ,KAAKO,IADmB,EAE5Bd,IAAIO,KAAKK,GAFmB,CAAlB,EAGTQ,GAHS,CAAZ;;AAKA,OAAI2D,MAAM1E,MAAN,GAAe,CAAnB,EAAsB;AACpB0E,WAAMG,IAAN,CAAWyP,KAAX;AACA;AACD,IAHD,MAGO;AACL5P,WAAM,CAAN,IAAW4P,KAAX,CADK,CACa;AACnB;;AAED,OAAIzR,IAAJ,EAAU;AACR9B,SAAIiB,WAAJ,CAAgBa,IAAhB;AACD;;AAEDA,UAAO,8BAAY9B,GAAZ,EAAiB;AACtBT,WAAM,OADgB;AAEtB+C,YAAOoQ,SAFe;AAGtB5S,YAAO2S,QAHe;AAItB9O;AAJsB,IAAjB,CAAP;AAMD;;AAED;;;;;;AAMO,UAASqL,QAAT,GAAqD;AAAA,OAAnCyE,OAAmC,uEAAzB,EAAyB;AAAA,OAArBC,QAAqB,uEAAV,QAAU;;AAC1DjB,cAAWvR,SAASuS,OAAT,EAAkB,EAAlB,CAAX;AACAf,eAAYgB,QAAZ;AACD;;AAED;;;AAGO,UAAS3E,WAAT,GAAuB;AAC5B,OAAIO,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAzS,YAASL,gBAAT,CAA0B,WAA1B,EAAuCqU,uBAAvC;AACAhU,YAASL,gBAAT,CAA0B,OAA1B,EAAmCoU,mBAAnC;AACA;AACD;;AAED;;;AAGO,UAAS9B,YAAT,GAAwB;AAC7B,OAAI,CAACQ,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAzS,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CoU,uBAA1C;AACAhU,YAASJ,mBAAT,CAA6B,OAA7B,EAAsCmU,mBAAtC;AACA;AACD,E;;;;;;;;;;;SC7EerC,W,GAAAA,W;SAUAD,Y,GAAAA,Y;;AAvHhB;;;;AACA;;AACA;;;;AAOA,KAAIgB,WAAW,KAAf;AACA,KAAI+E,cAAJ;;AAEA;;;;;AAKA,UAASnD,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIsX,SAAS,CAAC,2BAAetX,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAd,EAAoD;AAClD;AACD;;AAEDoX,WAAQxX,SAAS0O,aAAT,CAAuB,OAAvB,CAAR;AACA8I,SAAMhW,YAAN,CAAmB,IAAnB,EAAyB,0BAAzB;AACAgW,SAAMhW,YAAN,CAAmB,aAAnB,EAAkC,eAAlC;AACAgW,SAAM5I,KAAN,CAAY4E,MAAZ,kBAAkCnS,mBAAlC;AACAmW,SAAM5I,KAAN,CAAY6E,YAAZ,GAA2B,KAA3B;AACA+D,SAAM5I,KAAN,CAAYC,QAAZ,GAAuB,UAAvB;AACA2I,SAAM5I,KAAN,CAAYjM,GAAZ,GAAqBzC,EAAEE,OAAvB;AACAoX,SAAM5I,KAAN,CAAY/L,IAAZ,GAAsB3C,EAAEC,OAAxB;;AAEAqX,SAAM7X,gBAAN,CAAuB,MAAvB,EAA+B8X,eAA/B;AACAD,SAAM7X,gBAAN,CAAuB,OAAvB,EAAgC+X,gBAAhC;;AAEA1X,YAASuB,IAAT,CAAc4C,WAAd,CAA0BqT,KAA1B;AACAA,SAAMG,KAAN;AACD;;AAED;;;AAGA,UAASF,eAAT,GAA2B;AACzBjB;AACD;;AAED;;;;;AAKA,UAASkB,gBAAT,CAA0BxX,CAA1B,EAA6B;AAC3B,OAAIA,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AACpBsD;AACD,IAFD,MAEO,IAAI1X,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AAC3BkC;AACD;AACF;;AAED;;;AAGA,UAASA,SAAT,GAAqB;AACnB,OAAIgB,MAAMK,KAAN,CAAYC,IAAZ,GAAmB1V,MAAnB,GAA4B,CAAhC,EAAmC;AACjC,SAAIjC,UAAUkE,SAASmT,MAAM5I,KAAN,CAAY/L,IAArB,EAA2B,EAA3B,CAAd;AACA,SAAIzC,UAAUiE,SAASmT,MAAM5I,KAAN,CAAYjM,GAArB,EAA0B,EAA1B,CAAd;AACA,SAAIvE,UAAUoZ,MAAMK,KAAN,CAAYC,IAAZ,EAAd;AACA,SAAI3U,MAAM,2BAAehD,OAAf,EAAwBC,OAAxB,CAAV;AACA,SAAI,CAAC+C,GAAL,EAAU;AACR;AACD;;AAED,SAAIb,OAAOa,IAAIZ,qBAAJ,EAAX;;AATiC,wBAUQ,wBAAYY,GAAZ,CAVR;AAAA,SAU3B5F,UAV2B,gBAU3BA,UAV2B;AAAA,SAUfC,MAVe,gBAUfA,MAVe;AAAA,SAUPC,UAVO,gBAUPA,UAVO;;AAWjC,SAAIU,aAAaL,OAAOia,MAAP,CAAc;AAC3BrV,aAAM;AADqB,MAAd,EAEZ,sBAAUS,GAAV,EAAe;AAChBrB,UAAG3B,UAAUmC,KAAKO,IADF;AAEhBd,UAAG3B,UAAUkC,KAAKK;AAFF,MAAf,CAFY,CAAjB;;AAQAjG,6BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DC,MAA1D,EAAkEC,UAAlE,EAA8EU,UAA9E,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpBzB,+BAAcO,eAAd,GAAgCkC,UAAhC,CACE5B,UADF,EAEEY,WAAWP,IAFb,EAGEQ,OAHF;;AAMA,qCAAY+E,GAAZ,EAAiBhF,UAAjB;AACD,MATH;AAUD;;AAEDyZ;AACD;;AAED;;;AAGA,UAASA,UAAT,GAAsB;AACpBJ,SAAM5X,mBAAN,CAA0B,MAA1B,EAAkC6X,eAAlC;AACAD,SAAM5X,mBAAN,CAA0B,OAA1B,EAAmC8X,gBAAnC;AACA1X,YAASuB,IAAT,CAAc6C,WAAd,CAA0BoT,KAA1B;AACAA,WAAQ,IAAR;AACD;;AAED;;;AAGO,UAAS9F,WAAT,GAAuB;AAC5B,OAAIe,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAzS,YAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACD;;AAED;;;AAGO,UAAS5C,YAAT,GAAwB;AAC7B,OAAI,CAACgB,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAzS,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACD,E;;;;;;;;;;;SCqFezC,U,GAAAA,U;SAcAD,W,GAAAA,W;;AA/NhB;;;;AACA;;;;AACA;;AACA;;;;;;AASA,KAAIc,WAAW,KAAf;AACA,KAAIuF,cAAJ;AACA,KAAIrF,gBAAJ;AACA,KAAI0E,gBAAJ;AACA,KAAIC,gBAAJ;;AAEA;;;;;AAKA,UAASW,iBAAT,GAA6B;AAC3B,OAAI;AACF,SAAIC,YAAYC,OAAOC,YAAP,EAAhB;AACA,SAAIC,QAAQH,UAAUI,UAAV,CAAqB,CAArB,CAAZ;AACA,SAAIhK,QAAQ+J,MAAME,cAAN,EAAZ;;AAEA,SAAIjK,MAAMlM,MAAN,GAAe,CAAf,IACAkM,MAAM,CAAN,EAASrL,KAAT,GAAiB,CADjB,IAEAqL,MAAM,CAAN,EAASpL,MAAT,GAAkB,CAFtB,EAEyB;AACvB,cAAOoL,KAAP;AACD;AACF,IAVD,CAUE,OAAOpO,CAAP,EAAU,CAAE;;AAEd,UAAO,IAAP;AACD;;AAED;;;;;AAKA,UAAS8T,uBAAT,CAAiC9T,CAAjC,EAAoC;AAClC,OAAIiD,YAAJ;AACA,OAAI6U,UAAU,MAAV,IAAoB,EAAE7U,MAAM,2BAAejD,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAR,CAAxB,EAAuE;AACrE;AACD;;AAED,OAAIkC,OAAOa,IAAIZ,qBAAJ,EAAX;AACA8U,aAAUnX,EAAEE,OAAZ;AACAkX,aAAUpX,EAAEC,OAAZ;;AAEAwS,aAAU3S,SAAS0O,aAAT,CAAuB,KAAvB,CAAV;AACAiE,WAAQ/D,KAAR,CAAcC,QAAd,GAAyB,UAAzB;AACA8D,WAAQ/D,KAAR,CAAcjM,GAAd,GAAuB0U,UAAU/U,KAAKK,GAAtC;AACAgQ,WAAQ/D,KAAR,CAAc/L,IAAd,GAAwByU,UAAUhV,KAAKO,IAAvC;AACA8P,WAAQ/D,KAAR,CAAc4E,MAAd,kBAAoCnS,mBAApC;AACAsR,WAAQ/D,KAAR,CAAc6E,YAAd,GAA6B,KAA7B;AACAtQ,OAAIzB,UAAJ,CAAeyC,WAAf,CAA2BwO,OAA3B;;AAEA3S,YAASL,gBAAT,CAA0B,WAA1B,EAAuCyU,uBAAvC;AACA;AACD;;AAED;;;;;AAKA,UAASA,uBAAT,CAAiClU,CAAjC,EAAoC;AAClC,OAAIiD,MAAMwP,QAAQjR,UAAR,CAAmBwD,aAAnB,CAAiCvH,iBAAO4R,kBAAP,EAAjC,CAAV;AACA,OAAIjN,OAAOa,IAAIZ,qBAAJ,EAAX;;AAEA,OAAI+U,WAAWpX,EAAEC,OAAF,GAAYmX,OAAvB,IAAkChV,KAAKQ,KAA3C,EAAkD;AAChD6P,aAAQ/D,KAAR,CAAc3L,KAAd,GAAyB/C,EAAEC,OAAF,GAAYmX,OAArC;AACD;;AAED,OAAID,WAAWnX,EAAEE,OAAF,GAAYiX,OAAvB,IAAkC/U,KAAKM,MAA3C,EAAmD;AACjD+P,aAAQ/D,KAAR,CAAc1L,MAAd,GAA0BhD,EAAEE,OAAF,GAAYiX,OAAtC;AACD;AACF;;AAED;;;;;AAKA,UAAShD,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIoO,cAAJ;AACA,OAAI0J,UAAU,MAAV,KAAqB1J,QAAQ2J,mBAA7B,CAAJ,EAAuD;AACrD,SAAI9U,MAAM,2BAAemL,MAAM,CAAN,EAASzL,IAAxB,EAA8ByL,MAAM,CAAN,EAAS3L,GAAvC,CAAV;AACA6V,cAASR,KAAT,EAAgB,6BAAI1J,KAAJ,GAAWmK,GAAX,CAAe,UAAC7S,CAAD,EAAO;AACpC,cAAO;AACLjD,cAAKiD,EAAEjD,GADF;AAELE,eAAM+C,EAAE/C,IAFH;AAGLI,gBAAO2C,EAAE3C,KAHJ;AAILC,iBAAQ0C,EAAE1C;AAJL,QAAP;AAMD,MAPe,CAAhB;AAQD,IAVD,MAUO,IAAI8U,UAAU,MAAV,IAAoBrF,OAAxB,EAAiC;AACtC,SAAIxP,OAAMwP,QAAQjR,UAAR,CAAmBwD,aAAnB,CAAiCvH,iBAAO4R,kBAAP,EAAjC,CAAV;AACA,SAAIjN,OAAOa,KAAIZ,qBAAJ,EAAX;AACAiW,cAASR,KAAT,EAAgB,CAAC;AACfrV,YAAK0B,SAASsO,QAAQ/D,KAAR,CAAcjM,GAAvB,EAA4B,EAA5B,IAAkCL,KAAKK,GAD7B;AAEfE,aAAMwB,SAASsO,QAAQ/D,KAAR,CAAc/L,IAAvB,EAA6B,EAA7B,IAAmCP,KAAKO,IAF/B;AAGfI,cAAOoB,SAASsO,QAAQ/D,KAAR,CAAc3L,KAAvB,EAA8B,EAA9B,CAHQ;AAIfC,eAAQmB,SAASsO,QAAQ/D,KAAR,CAAc1L,MAAvB,EAA+B,EAA/B;AAJO,MAAD,CAAhB;;AAOAyP,aAAQjR,UAAR,CAAmB0C,WAAnB,CAA+BuO,OAA/B;AACAA,eAAU,IAAV;;AAEA3S,cAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACA;AACD;AACF;;AAED;;;;;AAKA,UAASL,mBAAT,CAA6B7T,CAA7B,EAAgC;AAC9B;AACA,OAAIA,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AACpB,SAAI4D,YAAYC,OAAOC,YAAP,EAAhB;AACAF,eAAUQ,eAAV;AACA,SAAI/F,WAAWA,QAAQjR,UAAvB,EAAmC;AACjCiR,eAAQjR,UAAR,CAAmB0C,WAAnB,CAA+BuO,OAA/B;AACAA,iBAAU,IAAV;AACA3S,gBAASJ,mBAAT,CAA6B,WAA7B,EAA0CwU,uBAA1C;AACD;AACF;AACF;;AAED;;;;;;;AAOA,UAASoE,QAAT,CAAkB9V,IAAlB,EAAwB4L,KAAxB,EAA+B7I,KAA/B,EAAsC;AACpC,OAAItC,MAAM,2BAAemL,MAAM,CAAN,EAASzL,IAAxB,EAA8ByL,MAAM,CAAN,EAAS3L,GAAvC,CAAV;AACA,OAAIxE,mBAAJ;;AAEA,OAAI,CAACgF,GAAL,EAAU;AACR;AACD;;AAED,OAAIwV,eAAexV,IAAIZ,qBAAJ,EAAnB;;AAEA,OAAI,CAACkD,KAAL,EAAY;AACV,SAAI/C,SAAS,WAAb,EAA0B;AACxB+C,eAAQ,QAAR;AACD,MAFD,MAEO,IAAI/C,SAAS,WAAb,EAA0B;AAC/B+C,eAAQ,QAAR;AACD;AACF;;AAED;AACAtH,gBAAa;AACXuE,eADW;AAEX+C,iBAFW;AAGXE,iBAAY,6BAAI2I,KAAJ,GAAWmK,GAAX,CAAe,UAAC7S,CAAD,EAAO;AAChC,WAAI7B,SAAS,CAAb;;AAEA,WAAIrB,SAAS,WAAb,EAA0B;AACxBqB,kBAAS6B,EAAE1C,MAAF,GAAW,CAApB;AACD;;AAED,cAAO,6BAAiB;AACtBnB,YAAI6D,EAAEjD,GAAF,GAAQoB,MAAT,GAAmB4U,aAAahW,GADb;AAEtBb,YAAG8D,EAAE/C,IAAF,GAAS8V,aAAa9V,IAFH;AAGtBI,gBAAO2C,EAAE3C,KAHa;AAItBC,iBAAQ0C,EAAE1C;AAJY,QAAjB,EAKJC,GALI,CAAP;AAMD,MAbW,EAaT4I,MAbS,CAaF,UAACnG,CAAD;AAAA,cAAOA,EAAE3C,KAAF,GAAU,CAAV,IAAe2C,EAAE1C,MAAF,GAAW,CAA1B,IAA+B0C,EAAE9D,CAAF,GAAM,CAAC,CAAtC,IAA2C8D,EAAE7D,CAAF,GAAM,CAAC,CAAzD;AAAA,MAbE;AAHD,IAAb;;AAmBA;AACA,OAAI5D,WAAWwH,UAAX,CAAsBvD,MAAtB,KAAiC,CAArC,EAAwC;AACtC;AACD;;AAED;AACA,OAAIM,SAAS,MAAb,EAAqB;AACnB,SAAIJ,OAAOnE,WAAWwH,UAAX,CAAsB,CAAtB,CAAX;AACA,YAAOxH,WAAWwH,UAAlB;AACAxH,gBAAW2D,CAAX,GAAeQ,KAAKR,CAApB;AACA3D,gBAAW4D,CAAX,GAAeO,KAAKP,CAApB;AACA5D,gBAAW8E,KAAX,GAAmBX,KAAKW,KAAxB;AACA9E,gBAAW+E,MAAX,GAAoBZ,KAAKY,MAAzB;AACD;;AAnDmC,sBAqDK,wBAAYC,GAAZ,CArDL;AAAA,OAqD9B5F,UArD8B,gBAqD9BA,UArD8B;AAAA,OAqDlBC,MArDkB,gBAqDlBA,MArDkB;AAAA,OAqDVC,UArDU,gBAqDVA,UArDU;;AAuDpC;;;AACAf,2BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DC,MAA1D,EAAkEC,UAAlE,EAA8EU,UAA9E,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,mCAAYgF,GAAZ,EAAiBhF,UAAjB;AACD,IAHH;AAID;;AAED;;;AAGO,UAASyT,UAAT,CAAoBlP,IAApB,EAA0B;AAC/BsV,WAAQtV,IAAR;;AAEA,OAAI+P,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAzS,YAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACArU,YAASL,gBAAT,CAA0B,WAA1B,EAAuCqU,uBAAvC;AACAhU,YAASL,gBAAT,CAA0B,OAA1B,EAAmCoU,mBAAnC;AACD;;AAED;;;AAGO,UAASpC,WAAT,GAAuB;AAC5B,OAAI,CAACc,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAzS,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACArU,YAASJ,mBAAT,CAA6B,WAA7B,EAA0CoU,uBAA1C;AACAhU,YAASJ,mBAAT,CAA6B,OAA7B,EAAsCmU,mBAAtC;AACD,E;;;;;;;;;;;SClNehC,S,GAAAA,S;SAqDAD,Y,GAAAA,Y;SAYAD,a,GAAAA,a;SAOAG,S,GAAAA,S;;AA5FhB;;;;AACA;;;;AACA;;AACA;;;;AAMA,KAAIS,WAAW,KAAf;AACA,KAAIuF,cAAJ;AACA,KAAIY,gBAAgB,EAApB;AACA,KAAIC,eAAe,QAAnB;;AAEA;;;;;;AAMO,UAAS9G,SAAT,GAA8D;AAAA,OAA3C+G,YAA2C,uEAA5B,EAA4B;AAAA,OAAxBC,WAAwB,uEAAV,QAAU;;AACnEH,mBAAgBvU,SAASyU,YAAT,EAAuB,EAAvB,CAAhB;AACAD,kBAAeE,WAAf;AACD;;AAED;;;;;AAKA,UAAS1E,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIiD,MAAM,2BAAejD,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAV;AACA,OAAI,CAAC+C,GAAL,EAAU;AACR;AACD;AACD,OAAIb,OAAOa,IAAIZ,qBAAJ,EAAX;AACAyW,cAAW7V,GAAX,EAAgB6U,KAAhB,EAAuB;AACnBlW,QAAG5B,EAAEC,OAAF,GAAYmC,KAAKO,IADD;AAEnBd,QAAG7B,EAAEE,OAAF,GAAYkC,KAAKK;AAFD,IAAvB,EAGKiW,aAHL,EAGoBC,YAHpB;AAKD;;AAED;;;;;;;AAOA,UAASG,UAAT,CAAoB7V,GAApB,EAAyBT,IAAzB,EAA+BkB,EAA/B,EAAmCqV,MAAnC,EAA2CxT,KAA3C,EAAkD;AAChD;AACA,OAAIyT,SAAS,8BAAkB,CAAEtV,GAAG9B,CAAL,EAAQ8B,GAAG7B,CAAX,CAAlB,EAAkCoB,GAAlC,CAAb;AACA,OAAIhF,aAAa;AACfuE,eADe;AAEf+C,iBAFe;AAGf6C,SAAI4Q,OAAO,CAAP,CAHW;AAIf3Q,SAAI2Q,OAAO,CAAP,CAJW;AAKftT,QAAGqT;AALY,IAAjB;;AAHgD,sBAWP,wBAAY9V,GAAZ,CAXO;AAAA,OAW1C5F,UAX0C,gBAW1CA,UAX0C;AAAA,OAW9BC,MAX8B,gBAW9BA,MAX8B;AAAA,OAWtBC,UAXsB,gBAWtBA,UAXsB;;AAahD;;;AACAf,2BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DC,MAA1D,EAAkEC,UAAlE,EAA8EU,UAA9E,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,mCAAYgF,GAAZ,EAAiBhF,UAAjB;AACD,IAHH;AAID;;AAED;;;AAGO,UAAS2T,YAAT,CAAsBpP,IAAtB,EAA4B;AACjCsV,WAAQtV,IAAR;;AAEA,OAAI+P,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAzS,YAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACD;;AAED;;;AAGO,UAASxC,aAAT,GAAyB;AAC9B,OAAI,CAACY,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAzS,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACD;;AAEM,UAASrC,SAAT,CAAmBtP,IAAnB,EAAyBxC,CAAzB,EAA4B;AACjC,OAAIiZ,UAAUnB,KAAd;AACAA,WAAQtV,IAAR;AACA2R,yBAAsBnU,CAAtB;AACA8X,WAAQmB,OAAR;AACD,E;;;;;;;;;;;SCqBe7G,O,GAAAA,O;SASAD,U,GAAAA,U;SAWAD,W,GAAAA,W;;AA1IhB;;;;AACA;;AACA;;;;AAOA,KAAIK,WAAW,KAAf;AACA,KAAI+E,cAAJ;AACA,KAAI4B,kBAAJ;AACA,KAAIC,mBAAJ;;AAEA;;;;;AAKA,UAAShF,qBAAT,CAA+BnU,CAA/B,EAAkC;AAChC,OAAIsX,SAAS,CAAC,2BAAetX,EAAEC,OAAjB,EAA0BD,EAAEE,OAA5B,CAAd,EAAoD;AAClD;AACD;AACD,OAAG,CAACF,EAAEmW,UAAF,CAAaC,SAAb,CAAuBC,QAAvB,CAAgC,iBAAhC,CAAJ,EAAuD;AACrD;AACD;AACDiB,WAAQxX,SAAS0O,aAAT,CAAuB,OAAvB,CAAR;AACA8I,SAAMhW,YAAN,CAAmB,IAAnB,EAAyB,yBAAzB;AACAgW,SAAMhW,YAAN,CAAmB,aAAnB,EAAkC,YAAlC;AACAgW,SAAM5I,KAAN,CAAY4E,MAAZ,kBAAkCnS,mBAAlC;AACAmW,SAAM5I,KAAN,CAAY6E,YAAZ,GAA2B,KAA3B;AACA+D,SAAM5I,KAAN,CAAYC,QAAZ,GAAuB,UAAvB;AACA2I,SAAM5I,KAAN,CAAYjM,GAAZ,GAAqBzC,EAAEE,OAAvB;AACAoX,SAAM5I,KAAN,CAAY/L,IAAZ,GAAsB3C,EAAEC,OAAxB;AACAqX,SAAM5I,KAAN,CAAY7G,QAAZ,GAA0BqR,SAA1B;AACA5B,SAAM5I,KAAN,CAAY8E,MAAZ,GAAqB,IAArB;AACA8D,SAAM7X,gBAAN,CAAuB,MAAvB,EAA+B8X,eAA/B;AACAD,SAAM7X,gBAAN,CAAuB,OAAvB,EAAgC+X,gBAAhC;;AAEA1X,YAASuB,IAAT,CAAc4C,WAAd,CAA0BqT,KAA1B;AACAA,SAAMG,KAAN;AACD;;AAED;;;AAGA,UAASF,eAAT,GAA2B;AACzB6B;AACD;;AAED;;;;;AAKA,UAAS5B,gBAAT,CAA0BxX,CAA1B,EAA6B;AAC3B,OAAIA,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AACpBsD;AACD,IAFD,MAEO,IAAI1X,EAAEoU,OAAF,KAAc,EAAlB,EAAsB;AAC3BgF;AACD;AACF;;AAED;;;AAGA,UAASA,QAAT,GAAoB;AAClB,OAAI9B,MAAMK,KAAN,CAAYC,IAAZ,GAAmB1V,MAAnB,GAA4B,CAAhC,EAAmC;AACjC,SAAIjC,UAAUkE,SAASmT,MAAM5I,KAAN,CAAY/L,IAArB,EAA2B,EAA3B,CAAd;AACA,SAAIzC,UAAUiE,SAASmT,MAAM5I,KAAN,CAAYjM,GAArB,EAA0B,EAA1B,CAAd;AACA,SAAIQ,MAAM,2BAAehD,OAAf,EAAwBC,OAAxB,CAAV;AACA,SAAI,CAAC+C,GAAL,EAAU;AACR;AACD;AACD,SAAID,SAASkW,SAAb;;AAPiC,wBAQkB,wBAAYjW,GAAZ,CARlB;AAAA,SAQ3B5F,UAR2B,gBAQ3BA,UAR2B;AAAA,SAQfC,MARe,gBAQfA,MARe;AAAA,SAQPC,UARO,gBAQPA,UARO;AAAA,SAQK4F,QARL,gBAQKA,QARL;;AASjC,SAAIC,QAAQ,IAAID,SAASC,KAAzB;AACA,SAAIhB,OAAOa,IAAIZ,qBAAJ,EAAX;AACA,SAAIqB,KAAK,8BAAkB,CACzBzD,UAAUmC,KAAKO,IADU,EAEzBzC,UAAWkC,KAAKK,GAAhB,GAAsBO,MAFG,CAAlB,EAEwBC,GAFxB,EAE6BE,QAF7B,CAAT;AAGA,SAAIlF,aAAa;AACbuE,aAAM,SADO;AAEbsF,aAAMoR,YAAY9V,KAFL;AAGbmC,cAAO4T,UAHM;AAIbjb,gBAASoZ,MAAMK,KAAN,CAAYC,IAAZ,EAJI;AAKbhW,UAAG8B,GAAG,CAAH,CALU;AAMb7B,UAAG6B,GAAG,CAAH,CANU;AAObE,iBAAU,CAACT,SAASS;AAPP,MAAjB;;AAUApH,6BAAcO,eAAd,GAAgC2B,aAAhC,CAA8CrB,UAA9C,EAA0DC,MAA1D,EAAkEC,UAAlE,EAA8EU,UAA9E,EACGK,IADH,CACQ,UAACL,UAAD,EAAgB;AACpB,qCAAYgF,GAAZ,EAAiBhF,UAAjB;AACD,MAHH;AAID;;AAEDyZ;AACD;;AAED;;;AAGA,UAASA,UAAT,GAAsB;AACpB,OAAIJ,KAAJ,EAAW;AACTA,WAAM5X,mBAAN,CAA0B,MAA1B,EAAkC6X,eAAlC;AACAD,WAAM5X,mBAAN,CAA0B,OAA1B,EAAmC8X,gBAAnC;AACA1X,cAASuB,IAAT,CAAc6C,WAAd,CAA0BoT,KAA1B;AACAA,aAAQ,IAAR;AACD;AACF;;AAED;;;;;;AAMO,UAASlF,OAAT,GAAsD;AAAA,OAArCiH,QAAqC,uEAA1B,EAA0B;AAAA,OAAtBC,SAAsB,uEAAV,QAAU;;AAC3DJ,eAAY/U,SAASkV,QAAT,EAAmB,EAAnB,CAAZ;AACAF,gBAAaG,SAAb;AACD;;AAGD;;;AAGO,UAASnH,UAAT,GAAsB;AAC3B,OAAII,QAAJ,EAAc;AAAE;AAAS;;AAEzBA,cAAW,IAAX;AACAzS,YAASL,gBAAT,CAA0B,SAA1B,EAAqC0U,qBAArC;AACD;;AAGD;;;AAGO,UAASjC,WAAT,GAAuB;AAC5B,OAAI,CAACK,QAAL,EAAe;AAAE;AAAS;;AAE1BA,cAAW,KAAX;AACAzS,YAASJ,mBAAT,CAA6B,SAA7B,EAAwCyU,qBAAxC;AACD,E;;;;;;;;;;;;;;SC1He9B,U,GAAAA,U;SA0BAC,U,GAAAA,U;;AA/ChB;;;;AACA;;;;AACA;;;;;;AAEA;AACA,KAAMiH,gBAAgB,mKAKF9b,iBAAO2R,aALL,kCAMF3R,iBAAO0R,mBANL,yBAAtB;;AAUA;;;;;;AAMO,UAASkD,UAAT,CAAoB9U,UAApB,EAAgC;AACrC,OAAIoS,OAAO7P,SAAS0O,aAAT,CAAuB,KAAvB,CAAX;AACAmB,QAAK5H,SAAL,GAAiBwR,aAAjB;;AAEA,OAAIzN,OAAO6D,KAAK6J,QAAL,CAAc,CAAd,CAAX;AACA,OAAIC,SAAS3N,KAAK9G,aAAL,CAAmB,QAAnB,CAAb;;AAEA8G,QAAKxK,YAAL,CAAkB,IAAlB,oBAAwC/D,UAAxC;AACAuO,QAAKxK,YAAL,CAAkB,kBAAlB,EAAsC/D,UAAtC;;AAEAkc,UAAOC,SAAP,GAAmB,IAAnB;AACAD,UAAOnY,YAAP,CAAoB,IAApB,WAAiC/D,UAAjC;;AAEA,UAAOuO,IAAP;AACD;;AAED;;;;;;;;;;AAUO,UAASwG,UAAT,CAAoB/U,UAApB,EAAgCoc,aAAhC,EAA+C;AAAA,OAElDtc,UAFkD,GAOhDsc,aAPgD,CAElDtc,UAFkD;AAAA,OAGlDC,MAHkD,GAOhDqc,aAPgD,CAGlDrc,MAHkD;AAAA,OAIlDsc,WAJkD,GAOhDD,aAPgD,CAIlDC,WAJkD;AAAA,OAKlDxW,KALkD,GAOhDuW,aAPgD,CAKlDvW,KALkD;AAAA,OAMlDoG,MANkD,GAOhDmQ,aAPgD,CAMlDnQ,MANkD;;AASpD;;AACA,UAAOiC,QAAQoO,GAAR,CAAY,CACjBD,YAAYE,OAAZ,CAAoBvc,UAApB,CADiB,EAEjBf,wBAAcY,cAAd,CAA6BC,UAA7B,EAAyCC,MAAzC,EAAiDC,UAAjD,CAFiB,CAAZ,EAGJe,IAHI,CAGC,gBAA4B;AAAA;AAAA,SAA1Byb,OAA0B;AAAA,SAAjBxb,WAAiB;;AAClC,SAAIuN,OAAOhM,SAASuQ,cAAT,mBAAwC9S,UAAxC,CAAX;AACA,SAAI0F,MAAM6I,KAAK9G,aAAL,CAAmBvH,iBAAO6R,oBAAP,EAAnB,CAAV;AACA,SAAImK,SAAS3N,KAAK9G,aAAL,CAAmB,uBAAnB,CAAb;AACA,SAAIgV,gBAAgBP,OAAOQ,UAAP,CAAkB,IAAlB,EAAwB,EAACC,OAAO,KAAR,EAAxB,CAApB;AACA,SAAIC,gBAAgB,CAAC3Q,SAASuQ,QAAQvQ,MAAlB,IAA4B,GAAhD;AACA,SAAIrG,WAAW4W,QAAQK,WAAR,CAAoBhX,KAApB,EAA2B+W,aAA3B,CAAf;AACA,SAAIvV,YAAYyV,UAAU9c,UAAV,EAAsB4F,QAAtB,EAAgC6W,aAAhC,CAAhB;;AAEA;AACA,YAAOvO,QAAQoO,GAAR,CAAY,CACjBE,QAAQ5c,MAAR,CAAe,EAAE6c,4BAAF,EAAiB7W,kBAAjB,EAA2ByB,oBAA3B,EAAf,CADiB,EAEjBpI,wBAAcW,MAAd,CAAqB8F,GAArB,EAA0BE,QAA1B,EAAoC5E,WAApC,CAFiB,CAAZ,EAGJD,IAHI,CAGC,YAAM;AACZ;AACA;AACA,cAAOyb,QAAQO,cAAR,CAAuB,EAACC,qBAAqB,IAAtB,EAAvB,EAAoDjc,IAApD,CAAyD,UAACkc,WAAD,EAAiB;AAC/E,gBAAO,IAAI/O,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC;AACA,eAAIsD,YAAYnD,KAAK9G,aAAL,CAAmBvH,iBAAOsR,cAAP,EAAnB,CAAhB;AACA,eAAI0L,mBAAmB,IAAIC,MAAMC,uBAAV,EAAvB;AACA,eAAIC,mBAAmBH,iBAAiBI,sBAAjB,CAAwC5L,SAAxC,EAAmD1R,aAAY,CAA/D,EAAkE4F,QAAlE,CAAvB;AACAyX,4BAAiBE,cAAjB,CAAgCN,WAAhC;AACAI,4BAAiBzd,MAAjB;;AAEA;AACA;AACAoY,sBAAW,YAAM;AACf,iBAAI;AACF,sDAAwBhX,YAAYA,WAApC;AACAmN;AACD,cAHD,CAGE,OAAO1L,CAAP,EAAU;AACV2L,sBAAO3L,CAAP;AACD;AACF,YAPD;AAQD,UAlBM,CAAP;AAmBD,QApBM,CAAP;AAqBD,MA3BM,EA2BJ1B,IA3BI,CA2BC,YAAM;AACZ;AACAwN,YAAKxK,YAAL,CAAkB,aAAlB,EAAiC,MAAjC;;AAEA,cAAO,CAACyY,OAAD,EAAUxb,WAAV,CAAP;AACD,MAhCM,CAAP;AAiCD,IA9CM,CAAP;AA+CD;;AAED;;;;;;;;AAQA,UAAS8b,SAAT,CAAmB9c,UAAnB,EAA+B4F,QAA/B,EAAyC4X,OAAzC,EAAkD;AAChD,OAAIjP,OAAOhM,SAASuQ,cAAT,mBAAwC9S,UAAxC,CAAX;AACA,OAAIkc,SAAS3N,KAAK9G,aAAL,CAAmB,uBAAnB,CAAb;AACA,OAAI/B,MAAM6I,KAAK9G,aAAL,CAAmBvH,iBAAO6R,oBAAP,EAAnB,CAAV;AACA,OAAI0L,UAAUlP,KAAK9G,aAAL,CAAmB,gBAAnB,CAAd;AACA,OAAIiK,YAAYnD,KAAK9G,aAAL,CAAmBvH,iBAAOsR,cAAP,EAAnB,CAAhB;AACA,OAAIkM,cAAcC,eAAeH,OAAf,CAAlB;AACA,OAAInW,YAAY,CAACqW,YAAYE,MAAb,GAAsB,IAAtB,GAA6B,CAACF,YAAYG,EAAb,EAAiB,CAAjB,EAAoB,CAApB,EAAuBH,YAAYI,EAAnC,EAAuC,CAAvC,EAA0C,CAA1C,CAA7C;AACA,OAAIC,MAAMC,oBAAoBN,YAAYG,EAAhC,CAAV;AACA,OAAII,MAAMD,oBAAoBN,YAAYI,EAAhC,CAAV;;AAEA;AACAvP,QAAK4C,KAAL,CAAW+M,UAAX,GAAwB,EAAxB;AACAhC,UAAO1W,KAAP,GAAe2Y,cAAcvY,SAASJ,KAAT,GAAiBkY,YAAYG,EAA3C,EAA+CE,IAAI,CAAJ,CAA/C,CAAf;AACA7B,UAAOzW,MAAP,GAAgB0Y,cAAcvY,SAASH,MAAT,GAAkBiY,YAAYI,EAA5C,EAAgDG,IAAI,CAAJ,CAAhD,CAAhB;AACA/B,UAAO/K,KAAP,CAAa3L,KAAb,GAAqB2Y,cAAcvY,SAASJ,KAAvB,EAA8BuY,IAAI,CAAJ,CAA9B,IAAwC,IAA7D;AACA7B,UAAO/K,KAAP,CAAa1L,MAAb,GAAsB0Y,cAAcvY,SAASH,MAAvB,EAA+BsY,IAAI,CAAJ,CAA/B,IAAyC,IAA/D;AACArY,OAAI3B,YAAJ,CAAiB,OAAjB,EAA0B6B,SAASJ,KAAnC;AACAE,OAAI3B,YAAJ,CAAiB,QAAjB,EAA2B6B,SAASH,MAApC;AACAC,OAAIyL,KAAJ,CAAU3L,KAAV,GAAqBI,SAASJ,KAA9B;AACAE,OAAIyL,KAAJ,CAAU1L,MAAV,GAAsBG,SAASH,MAA/B;AACA8I,QAAK4C,KAAL,CAAW3L,KAAX,GAAsBI,SAASJ,KAA/B;AACA+I,QAAK4C,KAAL,CAAW1L,MAAX,GAAuBG,SAASH,MAAhC;AACAgY,WAAQtM,KAAR,CAAc3L,KAAd,GAAyBI,SAASJ,KAAlC;AACAiY,WAAQtM,KAAR,CAAc1L,MAAd,GAA0BG,SAASH,MAAnC;AACAiM,aAAUP,KAAV,CAAgB3L,KAAhB,GAA2BI,SAASJ,KAApC;AACAkM,aAAUP,KAAV,CAAgB1L,MAAhB,GAA4BG,SAASH,MAArC;;AAEA,UAAO4B,SAAP;AACD;;AAGD;;;;;;;AAOA,UAAS2W,mBAAT,CAA6B3Z,CAA7B,EAAgC;AAC9B;AACA,OAAI2B,KAAKoY,KAAL,CAAW/Z,CAAX,MAAkBA,CAAtB,EAAyB;AACvB,YAAO,CAACA,CAAD,EAAI,CAAJ,CAAP;AACD;;AAED,OAAMga,OAAO,IAAIha,CAAjB;AACA,OAAMia,QAAQ,CAAd;AACA,OAAID,OAAOC,KAAX,EAAkB;AAChB,YAAO,CAAC,CAAD,EAAIA,KAAJ,CAAP;AACD,IAFD,MAEO,IAAItY,KAAKoY,KAAL,CAAWC,IAAX,MAAqBA,IAAzB,EAA+B;AACpC,YAAO,CAAC,CAAD,EAAIA,IAAJ,CAAP;AACD;;AAED,OAAME,KAAKla,IAAI,CAAJ,GAAQga,IAAR,GAAeha,CAA1B;;AAEA;AACA,OAAIpD,IAAI,CAAR;AAAA,OAAWoP,IAAI,CAAf;AAAA,OAAkBZ,IAAI,CAAtB;AAAA,OAAyBrG,IAAI,CAA7B;;AAEA;AACA,UAAO,IAAP,EAAa;AACX;AACA,SAAIuD,IAAI1L,IAAIwO,CAAZ;AAAA,SAAe+O,IAAInO,IAAIjH,CAAvB;AACA,SAAIoV,IAAIF,KAAR,EAAe;AACb;AACD;AACD,SAAIC,MAAM5R,IAAI6R,CAAd,EAAiB;AACf/O,WAAI9C,CAAJ,CAAOvD,IAAIoV,CAAJ;AACR,MAFD,MAEO;AACLvd,WAAI0L,CAAJ,CAAO0D,IAAImO,CAAJ;AACR;AACF;;AAED;AACA,OAAID,KAAKtd,IAAIoP,CAAT,GAAaZ,IAAIrG,CAAJ,GAAQmV,EAAzB,EAA6B;AAC3B,YAAOA,OAAOla,CAAP,GAAW,CAACpD,CAAD,EAAIoP,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAIpP,CAAJ,CAA3B;AACD,IAFD,MAEO;AACL,YAAOsd,OAAOla,CAAP,GAAW,CAACoL,CAAD,EAAIrG,CAAJ,CAAX,GAAoB,CAACA,CAAD,EAAIqG,CAAJ,CAA3B;AACD;AACF;;AAED,UAASkO,cAAT,CAAwBc,GAAxB,EAA6B;AAC3B,OAAIC,mBAAmBhE,OAAOgE,gBAAP,IAA2B,CAAlD;AACA,OAAIC,oBAAoBF,IAAIG,4BAAJ,IACAH,IAAII,yBADJ,IAEAJ,IAAIK,wBAFJ,IAGAL,IAAIM,uBAHJ,IAIAN,IAAIO,sBAJJ,IAI8B,CAJtD;AAKA,OAAIC,aAAaP,mBAAmBC,iBAApC;AACA,UAAO;AACLd,SAAIoB,UADC;AAELnB,SAAImB,UAFC;AAGLrB,aAAQqB,eAAe;AAHlB,IAAP;AAKD;;AAED,UAASd,aAAT,CAAuB9Z,CAAvB,EAA0B6a,GAA1B,EAA+B;AAC7B,OAAI/W,IAAI9D,IAAI6a,GAAZ;AACA,UAAO/W,MAAM,CAAN,GAAU9D,CAAV,GAAc2B,KAAKmZ,KAAL,CAAW9a,IAAI8D,CAAJ,GAAQ+W,GAAnB,CAArB;AACD,E","file":"dist/pdf-annotate.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 59e89cdaf93308c40d35\n **/","import PDFJSAnnotate from './src/PDFJSAnnotate';\r\n\r\nexport default PDFJSAnnotate;\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./index.js\n **/","import StoreAdapter from './adapter/StoreAdapter';\r\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\r\nimport render from './render';\r\nimport UI from './UI';\r\nimport config from './config';\r\nimport uuid from './utils/uuid';\r\nimport { \r\n  findAnnotationAtPoint, \r\n  findSVGContainer,\r\n  convertToScreenPoint\r\n} from './UI/utils';\r\n\r\nexport default {\r\n  findAnnotationAtPoint,\r\n  findSVGContainer,\r\n  convertToScreenPoint,\r\n\r\n  /**\r\n   * Abstract class that needs to be defined so PDFJSAnnotate\r\n   * knows how to communicate with your server.\r\n   */\r\n  StoreAdapter,\r\n\r\n  /**\r\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\r\n   */\r\n  LocalStoreAdapter,\r\n\r\n  /**\r\n   * Abstract instance of StoreAdapter\r\n   */\r\n  __storeAdapter: new StoreAdapter(),\r\n\r\n  /**\r\n   * Getter for the underlying StoreAdapter property\r\n   *\r\n   * @return {StoreAdapter}\r\n   */\r\n  getStoreAdapter() {\r\n    return this.__storeAdapter;\r\n  },\r\n\r\n  /**\r\n   * Setter for the underlying StoreAdapter property\r\n   *\r\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\r\n   */\r\n  setStoreAdapter(adapter) {\r\n    // TODO this throws an error when bundled\r\n    // if (!(adapter instanceof StoreAdapter)) {\r\n    //   throw new Error('adapter must be an instance of StoreAdapter');\r\n    // }\r\n\r\n    this.__storeAdapter = adapter;\r\n  },\r\n\r\n  /**\r\n   * UI is a helper for instrumenting UI interactions for creating,\r\n   * editing, and deleting annotations in the browser.\r\n   */\r\n  UI,\r\n\r\n  /**\r\n   * Render the annotations for a page in the PDF Document\r\n   *\r\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\r\n   * @param {PageViewport} viewport The PDFPage.getViewport data\r\n   * @param {Object} data The StoreAdapter.getAnnotations data\r\n   * @return {Promise}\r\n   */\r\n  render,\r\n\r\n  /**\r\n   * Convenience method for getting annotation data\r\n   *\r\n   * @alias StoreAdapter.getAnnotations\r\n   * @param {String} documentId The ID of the document\r\n   * @param {String} pageNumber The page number\r\n   * @return {Promise}\r\n   */\r\n  getAnnotations(documentId, userId, pageNumber) {\r\n    return this.getStoreAdapter().getAnnotations(...arguments);\r\n  },\r\n\r\n  config,\r\n\r\n  uuid\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/PDFJSAnnotate.js\n **/","import abstractFunction from '../utils/abstractFunction';\r\nimport { fireEvent } from '../UI/event';\r\n\r\n// Adapter should never be invoked publicly\r\nexport default class StoreAdapter {\r\n  /**\r\n   * Create a new StoreAdapter instance\r\n   *\r\n   * @param {Object} [definition] The definition to use for overriding abstract methods\r\n   */\r\n  constructor(definition = {}) {\r\n    // Copy each function from definition if it is a function we know about\r\n    Object.keys(definition).forEach((key) => {\r\n      if (typeof definition[key] === 'function' &&\r\n          typeof this[key] === 'function') {\r\n        this[key] = definition[key];\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get all the annotations for a given document and page number.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotations belong to\r\n   * @param {String} userId The user makeing changes to this document\r\n   * @param {Number} pageNumber The number of the page the annotations belong to\r\n   * @return {Promise}\r\n   */\r\n  __getAnnotations(documentId, userId, pageNumber) { abstractFunction('getAnnotations'); }\r\n  get getAnnotations() { return this.__getAnnotations; }\r\n  set getAnnotations(fn) {\r\n    this.__getAnnotations = function getAnnotations(documentId, userId, pageNumber) {\r\n      return fn(...arguments).then((annotations) => {\r\n        // TODO may be best to have this happen on the server\r\n        if (annotations.annotations) {\r\n          annotations.annotations.forEach((a) => {\r\n            a.documentId = documentId;\r\n          });\r\n        }\r\n        return annotations;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get the definition for a specific annotation.\r\n   *\r\n   * @param {String} documentId The ID for the document the annotation belongs to\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\r\n\r\n  /**\r\n   * Add an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document to add the annotation to\r\n   * @param {String} pageNumber The page number to add the annotation to\r\n   * @param {Object} annotation The definition for the new annotation\r\n   * @return {Promise}\r\n   */\r\n  __addAnnotation(documentId, userId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\r\n  get addAnnotation() { return this.__addAnnotation; }\r\n  set addAnnotation(fn) {\r\n    this.__addAnnotation = function addAnnotation(documentId, userId, pageNumber, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:add', documentId, userId, pageNumber, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Edit an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} pageNumber the page number of the annotation\r\n   * @param {Object} annotation The definition of the modified annotation\r\n   * @return {Promise}\r\n   */\r\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\r\n  get editAnnotation() { return this.__editAnnotation; }\r\n  set editAnnotation(fn) {\r\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\r\n      return fn(...arguments).then((annotation) => {\r\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\r\n        return annotation;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\r\n  get deleteAnnotation() { return this.__deleteAnnotation; }\r\n  set deleteAnnotation(fn) {\r\n    this.__deleteAnnotation = function deleteAnnotation(documentId, userId, annotationId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('annotation:delete', documentId, userId, annotationId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get all the comments for an annotation\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @return {Promise}\r\n   */\r\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\r\n\r\n  /**\r\n   * Add a new comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} annotationId The ID for the annotation\r\n   * @param {Object} content The definition of the comment\r\n   * @return {Promise}\r\n   */\r\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\r\n  get addComment() { return this.__addComment; }\r\n  set addComment(fn) {\r\n    this.__addComment = function addComment(documentId, annotationId, content) {\r\n      return fn(...arguments).then((comment) => {\r\n        fireEvent('comment:add', documentId, annotationId, comment);\r\n        return comment;\r\n      });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a comment\r\n   *\r\n   * @param {String} documentId The ID for the document\r\n   * @param {String} commentId The ID for the comment\r\n   * @return {Promise}\r\n   */\r\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\r\n  get deleteComment() { return this.__deleteComment; }\r\n  set deleteComment(fn) {\r\n    this.__deleteComment = function deleteComment(documentId, commentId) {\r\n      return fn(...arguments).then((success) => {\r\n        if (success) {\r\n          fireEvent('comment:delete', documentId, commentId);\r\n        }\r\n        return success;\r\n      });\r\n    };\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/adapter/StoreAdapter.js\n **/","/**\r\n * Throw an Error for an abstract function that hasn't been implemented.\r\n *\r\n * @param {String} name The name of the abstract function\r\n */\r\nexport default function abstractFunction(name) {\r\n  throw new Error(name + ' is not implemented');\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/abstractFunction.js\n **/","import EventEmitter from 'events';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGAtPoint\r\n} from './utils';\r\n\r\nconst emitter = new EventEmitter;\r\n\r\nlet clickNode;\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\ndocument.addEventListener('click', function handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n\r\n  // Emit annotation:blur if clickNode is no longer clicked\r\n  if (clickNode && clickNode !== target) {\r\n    emitter.emit('annotation:blur', clickNode);\r\n  }\r\n\r\n  // Emit annotation:click if target was clicked\r\n  if (target) {\r\n    emitter.emit('annotation:click', target);\r\n  }\r\n\r\n  clickNode = target;\r\n});\r\n\r\n// let mouseOverNode;\r\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\r\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n//\r\n//   // Emit annotation:mouseout if target was mouseout'd\r\n//   if (mouseOverNode && !target) {\r\n//     emitter.emit('annotation:mouseout', mouseOverNode);\r\n//   }\r\n//\r\n//   // Emit annotation:mouseover if target was mouseover'd\r\n//   if (target && mouseOverNode !== target) {\r\n//     emitter.emit('annotation:mouseover', target);\r\n//   }\r\n//\r\n//   mouseOverNode = target;\r\n// });\r\n\r\nexport function fireEvent() { emitter.emit(...arguments); };\r\nexport function addEventListener() { emitter.on(...arguments); };\r\nexport function removeEventListener() { emitter.removeListener(...arguments); };\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/event.js\n **/","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/events/events.js\n ** module id = 5\n ** module chunks = 0\n **/","import createStyleSheet from 'create-stylesheet';\r\nimport { getTranslation } from '../render/appendChild';\r\nimport { \r\n  applyTransform, \r\n  applyInverseTransform, \r\n  translate,\r\n  rotate,\r\n  scale \r\n} from '../utils/mathUtils';\r\n\r\n\r\nexport const BORDER_COLOR = '#00BFFF';\r\n\r\nconst userSelectStyleSheet = createStyleSheet({\r\n  body: {\r\n    '-webkit-user-select': 'none',\r\n       '-moz-user-select': 'none',\r\n        '-ms-user-select': 'none',\r\n            'user-select': 'none'\r\n  }\r\n});\r\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\r\n\r\n/**\r\n * Find the SVGElement that contains all the annotations for a page\r\n *\r\n * @param {Element} node An annotation within that container\r\n * @return {SVGElement} The container SVG or null if it can't be found\r\n */\r\nexport function findSVGContainer(node) {\r\n  let parentNode = node;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\r\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\r\n      return parentNode;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an SVGElement container at a given point\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {SVGElement} The container SVG or null if one can't be found\r\n */\r\nexport function findSVGAtPoint(x, y) {\r\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\r\n\r\n  for (let i=0, l=elements.length; i<l; i++) {\r\n    let el = elements[i];\r\n    let rect = el.getBoundingClientRect();\r\n\r\n    if (pointIntersectsRect(x, y, rect)) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * Find an Element that represents an annotation at a given point.\r\n * \r\n * IMPORTANT: Requires the annotation layer to be the top most element so\r\n *            either use z-ordering or make it the leaf container.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @return {Element} The annotation element or null if one can't be found\r\n */\r\nexport function findAnnotationAtPoint(x, y) {\r\n  let el = null;\r\n  var candidate = document.elementFromPoint(x, y)\r\n  while (!el && candidate && candidate !== document) {  \r\n    let type = candidate.getAttribute('data-pdf-annotate-type');\r\n    if (type) {\r\n      el = candidate;\r\n    }\r\n    candidate = candidate.parentNode;\r\n  }\r\n  return el;\r\n}\r\n\r\n/**\r\n * Determine if a point intersects a rect\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\r\n * @return {Boolean} True if a collision occurs, otherwise false\r\n */\r\nexport function pointIntersectsRect(x, y, rect) {\r\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\r\n}\r\n\r\n/**\r\n * Get the rect of an annotation element accounting for offset.\r\n *\r\n * @param {Element} el The element to get the rect of\r\n * @return {Object} The dimensions of the element\r\n */\r\nexport function getOffsetAnnotationRect(el) {\r\n  let rect = el.getBoundingClientRect();\r\n  let { offsetLeft, offsetTop } = getOffset(el);\r\n  return {\r\n    top: rect.top - offsetTop,\r\n    left: rect.left - offsetLeft,\r\n    right: rect.right - offsetLeft,\r\n    bottom: rect.bottom - offsetTop,\r\n    width: rect.width,\r\n    height: rect.height\r\n  };\r\n}\r\n\r\n/**\r\n * Adjust scale from normalized scale (100%) to rendered scale.\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled up\r\n */\r\nexport function scaleUp(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] * viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\nexport function convertToSvgRect(rect, svg, viewport) {\r\n  var pt1 = [rect.x, rect.y];\r\n  var pt2 = [rect.x + rect.width, rect.y + rect.height];\r\n\r\n  pt1 = convertToSvgPoint(pt1, svg, viewport);\r\n  pt2 = convertToSvgPoint(pt2, svg, viewport);\r\n\r\n  return {\r\n    x: Math.min(pt1[0], pt2[0]),\r\n    y: Math.min(pt1[1], pt2[1]),\r\n    width: Math.abs(pt2[0] - pt1[0]),\r\n    height: Math.abs(pt2[1] - pt1[1])\r\n  };\r\n}\r\n\r\nexport function convertToSvgPoint(pt, svg, viewport) {\r\n  let result = {};\r\n  viewport = viewport || getMetadata(svg).viewport;\r\n\r\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\r\n  xform = scale(xform, viewport.scale, viewport.scale);\r\n  xform = rotate(xform, viewport.rotation);\r\n\r\n  let offset = getTranslation(viewport);\r\n  xform = translate(xform, offset.x, offset.y);\r\n\r\n  return applyInverseTransform(pt, xform);\r\n}\r\n\r\nexport function convertToScreenPoint(pt, svg, viewport) {\r\n  let result = {};\r\n  viewport = viewport || getMetadata(svg).viewport;\r\n\r\n  let xform = [ 1, 0, 0, 1, 0, 0 ];\r\n  xform = scale(xform, viewport.scale, viewport.scale);\r\n  xform = rotate(xform, viewport.rotation);\r\n\r\n  let offset = getTranslation(viewport);\r\n  xform = translate(xform, offset.x, offset.y);\r\n\r\n  return applyTransform(pt, xform);\r\n}\r\n\r\n/**\r\n * Adjust scale from rendered scale to a normalized scale (100%).\r\n *\r\n * @param {SVGElement} svg The SVG to gather metadata from\r\n * @param {Object} rect A map of numeric values to scale\r\n * @return {Object} A copy of `rect` with values scaled down\r\n */\r\nexport function scaleDown(svg, rect) {\r\n  let result = {};\r\n  let { viewport } = getMetadata(svg);\r\n\r\n  Object.keys(rect).forEach((key) => {\r\n    result[key] = rect[key] / viewport.scale;\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Get the scroll position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the scroll position for\r\n * @return {Object} The scrollTop and scrollLeft position\r\n */\r\nexport function getScroll(el) {\r\n  let scrollTop = 0;\r\n  let scrollLeft = 0;\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    scrollTop += parentNode.scrollTop;\r\n    scrollLeft += parentNode.scrollLeft;\r\n  }\r\n\r\n  return { scrollTop, scrollLeft };\r\n}\r\n\r\n/**\r\n * Get the offset position of an element, accounting for parent elements\r\n *\r\n * @param {Element} el The element to get the offset position for\r\n * @return {Object} The offsetTop and offsetLeft position\r\n */\r\nexport function getOffset(el) {\r\n  let parentNode = el;\r\n\r\n  while ((parentNode = parentNode.parentNode) &&\r\n          parentNode !== document) {\r\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\r\n      break;\r\n    }\r\n  }\r\n\r\n  let rect = parentNode.getBoundingClientRect();\r\n\r\n  return { offsetLeft: rect.left, offsetTop: rect.top };\r\n}\r\n\r\n/**\r\n * Disable user ability to select text on page\r\n */\r\nexport function disableUserSelect() {\r\n  if (!userSelectStyleSheet.parentNode) {\r\n    document.head.appendChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n\r\n/**\r\n * Enable user ability to select text on page\r\n */\r\nexport function enableUserSelect() {\r\n  if (userSelectStyleSheet.parentNode) {\r\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * Get the metadata for a SVG container\r\n *\r\n * @param {SVGElement} svg The SVG container to get metadata for\r\n */\r\nexport function getMetadata(svg) {\r\n  return {\r\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\r\n    userId: svg.getAttribute('data-pdf-annotate-user'),\r\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\r\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\r\n  };\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/utils.js\n **/","module.exports = function createStyleSheet(blocks) {\n  var style = document.createElement('style');\n  var text = Object.keys(blocks).map(function (selector) {\n    return processRuleSet(selector, blocks[selector]);\n  }).join('\\n');\n  \n  style.setAttribute('type', 'text/css');\n  style.appendChild(document.createTextNode(text));\n\n  return style;\n}\n\nfunction processRuleSet(selector, block) {\n  return selector + ' {\\n' + processDeclarationBlock(block) + '\\n}';\n}\n\nfunction processDeclarationBlock(block) {\n  return Object.keys(block).map(function (prop) {\n    return processDeclaration(prop, block[prop]);\n  }).join('\\n');\n}\n\nfunction processDeclaration(prop, value) {\n  if (!isNaN(value) && value != 0) {\n    value = value + 'px';\n  }\n\n  return hyphenate(prop) + ': ' + value + ';';\n}\n\nfunction hyphenate(prop) {\n  return prop.replace(/[A-Z]/g, function (match) {\n    return '-' + match.toLowerCase();\n  });\n}\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/create-stylesheet/index.js\n ** module id = 7\n ** module chunks = 0\n **/","import objectAssign from 'object-assign';\r\nimport renderLine from './renderLine';\r\nimport renderPath from './renderPath';\r\nimport renderPoint from './renderPoint';\r\nimport renderRect from './renderRect';\r\nimport renderText from './renderText';\r\nimport renderCircle from './renderCircle';\r\nimport renderArrow from './renderArrow';\r\n\r\nconst isFirefox = /firefox/i.test(navigator.userAgent);\r\n\r\n/**\r\n * Get the x/y translation to be used for transforming the annotations\r\n * based on the rotation of the viewport.\r\n *\r\n * @param {Object} viewport The viewport data from the page\r\n * @return {Object}\r\n */\r\nexport function getTranslation(viewport) {\r\n  let x;\r\n  let y;\r\n\r\n  // Modulus 360 on the rotation so that we only\r\n  // have to worry about four possible values.\r\n  switch(viewport.rotation % 360) {\r\n    case 0:\r\n      x = y = 0;\r\n      break;\r\n    case 90:\r\n      x = 0;\r\n      y = (viewport.width / viewport.scale) * -1;\r\n      break;\r\n    case 180:\r\n      x = (viewport.width / viewport.scale) * -1;\r\n      y = (viewport.height / viewport.scale) * -1;\r\n      break;\r\n    case 270:\r\n      x = (viewport.height / viewport.scale) * -1;\r\n      y = 0;\r\n      break;\r\n  }\r\n\r\n  return { x, y };\r\n}\r\n\r\n/**\r\n * Transform the rotation and scale of a node using SVG's native transform attribute.\r\n *\r\n * @param {Node} node The node to be transformed\r\n * @param {Object} viewport The page's viewport data\r\n * @return {Node}\r\n */\r\nfunction transform(node, viewport) {\r\n  let trans = getTranslation(viewport);\r\n\r\n  // Let SVG natively transform the element\r\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\r\n  \r\n  // Manually adjust x/y for nested SVG nodes\r\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\r\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\r\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\r\n\r\n    let x = parseInt(node.getAttribute('x', 10));\r\n    let y = parseInt(node.getAttribute('y', 10));\r\n    let width = parseInt(node.getAttribute('width'), 10);\r\n    let height = parseInt(node.getAttribute('height'), 10);\r\n    let path = node.querySelector('path');\r\n    let svg = path.parentNode;\r\n   \r\n    // Scale width/height\r\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\r\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\r\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\r\n    });\r\n\r\n    // Transform path but keep scale at 100% since it will be handled natively\r\n    transform(path, objectAssign({}, viewport, { scale: 1 }));\r\n    \r\n    switch(viewport.rotation % 360) {\r\n      case 90:\r\n        node.setAttribute('x', viewport.width - y - width);\r\n        node.setAttribute('y', x);\r\n        svg.setAttribute('x', 1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n      case 180:\r\n        node.setAttribute('x', viewport.width - x - width);\r\n        node.setAttribute('y', viewport.height - y - height);\r\n        svg.setAttribute('y', 2);\r\n        break;\r\n      case 270:\r\n        node.setAttribute('x', y);\r\n        node.setAttribute('y', viewport.height - x - height);\r\n        svg.setAttribute('x', -1);\r\n        svg.setAttribute('y', 0);\r\n        break;\r\n    }\r\n  }\r\n\r\n  return node;\r\n}\r\n\r\n/**\r\n * Append an annotation as a child of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element to append the annotation to\r\n * @param {Object} annotation The annotation definition to render and append\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was created and appended by this function\r\n */\r\nexport function appendChild(svg, annotation, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n  \r\n  let child;\r\n  switch (annotation.type) {\r\n    case 'area':\r\n    case 'highlight':\r\n      child = renderRect(annotation);\r\n      break;\r\n    case 'circle':\r\n    case 'fillcircle':\r\n    case 'emptycircle':\r\n      child = renderCircle(annotation);\r\n      break;\r\n    case 'strikeout':\r\n      child = renderLine(annotation);\r\n      break;\r\n    case 'point':\r\n      child = renderPoint(annotation);\r\n      break;\r\n    case 'textbox':\r\n      child = renderText(annotation);\r\n      break;\r\n    case 'drawing':\r\n      child = renderPath(annotation);\r\n      break;\r\n    case 'arrow':\r\n      child = renderArrow(annotation);\r\n      break;\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip appending/transforming if node doesn't exist.\r\n  if (child) {\r\n    // Set attributes\r\n    child.setAttribute('data-pdf-annotate-id', annotation.uuid);\r\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\r\n    child.setAttribute('data-pdf-annotate-userId', annotation.userId);\r\n    child.setAttribute('aria-hidden', true);\r\n\r\n    svg.appendChild(transform(child, viewport));\r\n  }\r\n\r\n  return child;\r\n}\r\n\r\n/**\r\n * Transform a child annotation of an SVG.\r\n *\r\n * @param {SVGElement} svg The SVG element with the child annotation\r\n * @param {Object} child The SVG child to transform\r\n * @param {Object} viewport The page's viewport data\r\n * @return {SVGElement} A node that was transformed by this function\r\n */\r\nexport function transformChild(svg, child, viewport) {\r\n  if (!viewport) {\r\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\r\n  }\r\n\r\n  // If no type was provided for an annotation it will result in node being null.\r\n  // Skip transforming if node doesn't exist.\r\n  if (child) {\r\n    child = transform(child, viewport);\r\n  }\r\n\r\n  return child;\r\n}\r\n\r\nexport default {\r\n  /**\r\n   * Get the x/y translation to be used for transforming the annotations\r\n   * based on the rotation of the viewport.\r\n   */\r\n  getTranslation,\r\n  \r\n  /**\r\n   * Append an SVG child for an annotation\r\n   */\r\n  appendChild,\r\n\r\n  /**\r\n   * Transform an existing SVG child\r\n   */  \r\n  transformChild\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/appendChild.js\n **/","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/object-assign/index.js\n ** module id = 9\n ** module chunks = 0\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGLineElements from an annotation definition.\r\n * This is used for anntations of type `strikeout`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement} A group of all lines to be rendered\r\n */\r\nexport default function renderLine(a) {\r\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  setAttributes(group, {\r\n    stroke: normalizeColor(a.color || '#f00'),\r\n    strokeWidth: 1\r\n  });\r\n\r\n  a.rectangles.forEach((r) => {\r\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\r\n\r\n    setAttributes(line, {\r\n      x1: r.x,\r\n      y1: r.y,\r\n      x2: r.x + r.width,\r\n      y2: r.y,\r\n    });\r\n\r\n    group.appendChild(line);\r\n  });\r\n\r\n  return group;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderLine.js\n **/","const UPPER_REGEX = /[A-Z]/g;\r\n\r\n// Don't convert these attributes from camelCase to hyphenated-attributes\r\nconst BLACKLIST = [\r\n  'viewBox'\r\n];\r\n\r\nlet keyCase = (key) => {\r\n  if (BLACKLIST.indexOf(key) === -1) {\r\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\r\n  }\r\n  return key;\r\n}\r\n\r\n/**\r\n * Set attributes for a node from a map\r\n *\r\n * @param {Node} node The node to set attributes on\r\n * @param {Object} attributes The map of key/value pairs to use for attributes\r\n */\r\nexport default function setAttributes(node, attributes) {\r\n  Object.keys(attributes).forEach((key) => {\r\n    node.setAttribute(keyCase(key), attributes[key]);\r\n  });\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/setAttributes.js\n **/","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\r\n\r\n/**\r\n * Normalize a color value\r\n *\r\n * @param {String} color The color to normalize\r\n * @return {String}\r\n */\r\nexport default function normalizeColor(color) {\r\n  if (REGEX_HASHLESS_HEX.test(color)) {\r\n    color = `#${color}`;\r\n  }\r\n  return color;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/normalizeColor.js\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderPath(a) {\r\n  let d = [];\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n  \r\n  \r\n  for (let i=0, l=a.lines.length; i<l; i++) {\r\n    var p1 = a.lines[i];\r\n    var p2 = a.lines[i+1];\r\n    if (p2) {\r\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n    }\r\n  }\r\n\r\n/*\r\n  \r\n   if(a.lines.length>2) {\r\n    var p1 = a.lines[0];\r\n    var p2 = a.lines[a.lines.length-1];\r\n\r\n    var p3 = []; //arrow \r\n    var p4 = [];\r\n    var p0 = []; //arrow intersection\r\n\r\n\r\n \r\n    if (p2) {\r\n      var k = -(p2[0]-p1[0])/(p2[1]-p1[1]);\r\n\r\n      var deltaX = 3;\r\n      p0[0] = p1[0]+0.8*(p2[0]-p1[0]);\r\n      p0[1] = p1[1]+0.8*(p2[1]-p1[1]);\r\n\r\n      p3[0] = p0[0] + deltaX;\r\n      p3[1] = p0[1] + k*deltaX;\r\n\r\n      p4[0] = p0[0] - deltaX;\r\n      p4[1] = p0[1] - k*deltaX;\r\n\r\n      if(Math.abs(p2[1]-p1[1]) < 20) {\r\n\r\n        p3[0] = p0[0] ;\r\n        p3[1] = p0[1] + deltaX*1;\r\n\r\n        p4[0] = p0[0] ;\r\n        p4[1] = p0[1] - deltaX*1;\r\n\r\n      }\r\n\r\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n       //d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\r\n      d.push(`M${p2[0]} ${p2[1]} ${p3[0]} ${p3[1]}`);\r\n      d.push(`M${p3[0]} ${p3[1]} ${p4[0]} ${p4[1]}`);\r\n      d.push(`M${p4[0]} ${p4[1]} ${p2[0]} ${p2[1]}`);\r\n     }\r\n    }*/\r\n  \r\n  setAttributes(path, {\r\n    d: `${d.join(' ')}Z`,\r\n    stroke: normalizeColor(a.color || '#000'),\r\n    strokeWidth: a.width || 1,\r\n    fill: 'none'\r\n  });\r\n\r\n  return path;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderPath.js\n **/","import setAttributes from '../utils/setAttributes';\r\n\r\nconst SIZE = 25;\r\nconst D = 'M499.968 214.336q-113.832 0 -212.877 38.781t-157.356 104.625 -58.311 142.29q0 62.496 39.897 119.133t112.437 97.929l48.546 27.9 -15.066 53.568q-13.392 50.778 -39.06 95.976 84.816 -35.154 153.45 -95.418l23.994 -21.204 31.806 3.348q38.502 4.464 72.54 4.464 113.832 0 212.877 -38.781t157.356 -104.625 58.311 -142.29 -58.311 -142.29 -157.356 -104.625 -212.877 -38.781z';\r\n\r\n/**\r\n * Create SVGElement from an annotation definition.\r\n * This is used for anntations of type `comment`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGElement} A svg to be rendered\r\n */\r\nexport default function renderPoint(a) {\r\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let innerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n\r\n  setAttributes(outerSVG,  {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: a.x,\r\n    y: a.y\r\n  });\r\n\r\n  setAttributes(innerSVG, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    x: 0,\r\n    y: (SIZE * 0.05) * -1,\r\n    viewBox: '0 0 1000 1000'\r\n  });\r\n\r\n  setAttributes(rect, {\r\n    width: SIZE,\r\n    height: SIZE,\r\n    stroke: '#000',\r\n    fill: '#ff0'\r\n  });\r\n\r\n  setAttributes(path, {\r\n    d: D,\r\n    strokeWidth: 50,\r\n    stroke: '#000',\r\n    fill: '#fff'\r\n  });\r\n\r\n  innerSVG.appendChild(path);\r\n  outerSVG.appendChild(rect);\r\n  outerSVG.appendChild(innerSVG);\r\n\r\n  return outerSVG;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderPoint.js\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGRectElements from an annotation definition.\r\n * This is used for anntations of type `area` and `highlight`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\r\n */\r\nexport default function renderRect(a) {\r\n  if (a.type === 'highlight') {\r\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n    setAttributes(group, {\r\n      fill: normalizeColor(a.color || '#ff0'),\r\n      fillOpacity: 0.2\r\n    });\r\n    \r\n    a.rectangles.forEach((r) => {\r\n      group.appendChild(createRect(r));\r\n    });\r\n\r\n    return group;\r\n  } else {\r\n    let rect = createRect(a);\r\n    setAttributes(rect, {\r\n      stroke: normalizeColor(a.color || '#f00'),\r\n      fill: 'none'\r\n    });\r\n\r\n    return rect;\r\n  }\r\n}\r\n\r\nfunction createRect(r) {\r\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n\r\n  setAttributes(rect, {\r\n    x: r.x,\r\n    y: r.y,\r\n    width: r.width,\r\n    height: r.height\r\n  });\r\n\r\n  return rect;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderRect.js\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create SVGTextElement from an annotation definition.\r\n * This is used for anntations of type `textbox`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGTextElement} A text to be rendered\r\n */\r\nexport default function renderText(a) {\r\n\r\n  // Text should be rendered at 0 degrees relative to\r\n  // document rotation\r\n  let text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\r\n  let x = a.x;\r\n  let y = a.y;\r\n\r\n  setAttributes(text, {\r\n    x: x,\r\n    y: y,\r\n    fill: normalizeColor(a.color || '#000'),\r\n    fontSize: a.size,\r\n    transform: `rotate(${a.rotation}, ${x}, ${y})`\r\n  });\r\n  text.innerHTML = a.content;\r\n\r\n  var g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\r\n  g.appendChild(text);\r\n\r\n  return g;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderText.js\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\n\r\n/**\r\n * Create an SVGCircleElement from an annotation definition.\r\n * This is used for annotations of type `circle`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGGElement|SVGCircleElement} A circle to be rendered\r\n */\r\nexport default function renderCircle(a) {\r\n  let circle = createCircle(a);\r\n  let color = normalizeColor(a.color || '#f00')\r\n\r\n  if (a.type === 'circle')\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: 'none',\r\n      'stroke-width': 5\r\n    });\r\n  if (a.type === 'emptycircle')\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: 'none',\r\n      'stroke-width': 2\r\n    });\r\n\r\n  if (a.type === 'fillcircle')\r\n    setAttributes(circle, {\r\n      stroke: color,\r\n      fill: color,\r\n      'stroke-width': 5\r\n    });\r\n\r\n  return circle;\r\n}\r\n\r\nfunction createCircle(a) {\r\n  let circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n  setAttributes(circle, {\r\n    cx: a.cx,\r\n    cy: a.cy,\r\n    r: a.r\r\n  });\r\n\r\n  return circle;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderCircle.js\n **/","import setAttributes from '../utils/setAttributes';\r\nimport normalizeColor from '../utils/normalizeColor';\r\nimport { \r\n  makePoint, makeVector, makeVectorFromPoints,\r\n  magnitude, unitVector, crossProduct,\r\n  addVector, multiplyVector, negateVector\r\n} from '../utils/mathUtils';\r\n\r\n/**\r\n * Create SVGPathElement from an annotation definition.\r\n * This is used for anntations of type `drawing`.\r\n *\r\n * @param {Object} a The annotation definition\r\n * @return {SVGPathElement} The path to be rendered\r\n */\r\nexport default function renderArrow(a) {\r\n  let d = [];\r\n  let arrow = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');\r\n\r\n  if (a.lines.length == 2) {\r\n    let p1 = a.lines[0];\r\n    let p2 = a.lines[a.lines.length - 1];\r\n\r\n    let arrowLength = 40;\r\n    let pt0 = makePoint(p1[0], p1[1], 0);\r\n    let pt1 = makePoint(p2[0], p2[1], 0);\r\n    let x = makeVectorFromPoints(pt0, pt1);\r\n    let unitX = unitVector(x);\r\n    pt1 = addVector(pt0, multiplyVector(unitX, arrowLength));\r\n    x = makeVectorFromPoints(pt0, pt1);\r\n    let unitZ = makeVector(0, 0, 1);\r\n    let unitY = unitVector(crossProduct(unitX, unitZ));\r\n    let thickness = a.width || 10;\r\n\r\n    let A = addVector(pt0, multiplyVector(unitY, thickness * 0.5)); \r\n    let B = addVector(A, multiplyVector(unitX, magnitude(x) - thickness * 2.0)); \r\n    let C = addVector(B, multiplyVector(unitY, thickness)); \r\n    let D = pt1;\r\n    let G = addVector(pt0, multiplyVector(negateVector(unitY), thickness * 0.5)); \r\n    let F = addVector(G, multiplyVector(unitX, magnitude(x) - thickness * 2.0)); \r\n    let E = addVector(F, multiplyVector(negateVector(unitY), thickness)); \r\n\r\n    let points = '' + \r\n      A.x + ',' + A.y + ' ' +\r\n      B.x + ',' + B.y + ' ' +\r\n      C.x + ',' + C.y + ' ' +\r\n      D.x + ',' + D.y + ' ' +\r\n      E.x + ',' + E.y + ' ' +\r\n      F.x + ',' + F.y + ' ' +\r\n      G.x + ',' + G.y\r\n\r\n    setAttributes(arrow, {\r\n      points: points,\r\n      stroke: normalizeColor(a.color || '#000'),\r\n      fill: normalizeColor(a.color || '#000')\r\n    });\r\n  }\r\n\r\n  return arrow;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/renderArrow.js\n **/","// Transform point by matrix\r\n//\r\nexport function applyTransform(p, m) {\r\n  var xt = p[0] * m[0] + p[1] * m[2] + m[4];\r\n  var yt = p[0] * m[1] + p[1] * m[3] + m[5];\r\n  return [xt, yt];\r\n};\r\n\r\n// Transform point by matrix inverse\r\n//\r\nexport function applyInverseTransform(p, m) {\r\n  var d = m[0] * m[3] - m[1] * m[2];\r\n  var xt = (p[0] * m[3] - p[1] * m[2] + m[2] * m[5] - m[4] * m[3]) / d;\r\n  var yt = (-p[0] * m[1] + p[1] * m[0] + m[4] * m[1] - m[5] * m[0]) / d;\r\n  return [xt, yt];\r\n};\r\n\r\n\r\n// Concatenates two transformation matrices together and returns the result.\r\nexport function transform(m1, m2) {\r\n  return [\r\n    m1[0] * m2[0] + m1[2] * m2[1],\r\n    m1[1] * m2[0] + m1[3] * m2[1],\r\n    m1[0] * m2[2] + m1[2] * m2[3],\r\n    m1[1] * m2[2] + m1[3] * m2[3],\r\n    m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\r\n    m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\r\n  ];\r\n};\r\n\r\nexport function translate(m, x, y) {\r\n  return [\r\n    m[0],\r\n    m[1],\r\n    m[2],\r\n    m[3],\r\n    m[0] * x + m[2] * y + m[4],\r\n    m[1] * x + m[3] * y + m[5]\r\n  ];\r\n};\r\n\r\n\r\nexport function rotate(m, angle) {\r\n  angle = angle * Math.PI / 180;\r\n\r\n  var cosValue = Math.cos(angle);\r\n  var sinValue = Math.sin(angle);\r\n\r\n  return [\r\n    m[0] * cosValue + m[2] * sinValue,\r\n    m[1] * cosValue + m[3] * sinValue,\r\n    m[0] * (-sinValue) + m[2] * cosValue,\r\n    m[1] * (-sinValue) + m[3] * cosValue,\r\n    m[4],\r\n    m[5]\r\n  ];\r\n};\r\n\r\nexport function scale(m, x, y) {\r\n  return [\r\n    m[0] * x,\r\n    m[1] * x,\r\n    m[2] * y,\r\n    m[3] * y,\r\n    m[4],\r\n    m[5]\r\n  ];\r\n};\r\n  \r\nfunction getInverseTransform(m) {\r\n  var d = m[0] * m[3] - m[1] * m[2];\r\n  return [m[3] / d, -m[1] / d, -m[2] / d, m[0] / d,\r\n    (m[2] * m[5] - m[4] * m[3]) / d, (m[4] * m[1] - m[5] * m[0]) / d];\r\n};\r\n\r\n\r\nexport function makePoint(x, y, z) {\r\n  return { x: x, y: y, z: z }\r\n}\r\n\r\nexport function makeVector(xcoord, ycoord, zcoord) {\r\n  return { xcoord: xcoord, ycoord: ycoord, zcoord: zcoord }\r\n}\r\n\r\nexport function makeVectorFromPoints(pt1, pt2)\r\n{\r\n  let xcoord = pt2.x - pt1.x;\r\n  let ycoord = pt2.y - pt1.y;\r\n  let zcoord = pt2.z - pt1.z;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n}\r\n\r\nexport function addVector(pt, v) {\r\n  return makePoint(pt.x + v.xcoord, pt.y + v.ycoord, pt.z + v.zcoord);\r\n}\r\n\r\nexport function multiplyVector(v, scalar) {\r\n  return makeVector(v.xcoord * scalar, v.ycoord * scalar, v.zcoord * scalar);\r\n}\r\n\r\nexport function magnitude(v)\r\n{\r\n  return Math.sqrt(\r\n    Math.pow(v.xcoord, 2) + Math.pow(v.ycoord, 2) + Math.pow(v.zcoord, 2)\r\n  );\r\n}\r\n\r\nexport function negateVector(v) {\r\n  return multiplyVector(v, -1);\r\n}\r\n\r\nexport function unitVector(v) {\r\n  let mag = magnitude(v);\r\n  let xcoord = v.xcoord / mag;\r\n  let ycoord = v.ycoord / mag;\r\n  let zcoord = v.zcoord / mag;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n} \r\n\r\nexport function crossProduct(u, v) {\r\n  //\r\n  // u X v = < u2*v3 - u3*v2,\r\n  //           u3*v1 - u1*v3,\r\n  //           u1*v2 - u2*v1 >\r\n  let xcoord = u.ycoord * v.zcoord - u.zcoord * v.ycoord;\r\n  let ycoord = u.zcoord * v.xcoord - u.xcoord * v.zcoord;\r\n  let zcoord = u.xcoord * v.ycoord - u.ycoord * v.xcoord;\r\n  return makeVector(xcoord, ycoord, zcoord);\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/mathUtils.js\n **/","import uuid from '../utils/uuid';\r\nimport StoreAdapter from './StoreAdapter';\r\n\r\n// StoreAdapter for working with localStorage\r\n// This is ideal for testing, examples, and prototyping\r\nexport default class LocalStoreAdapter extends StoreAdapter {\r\n  constructor(userId = \"user\") {\r\n    super({\r\n      getAnnotations(documentId, userId, pageNumber) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAllAnnotations().filter((i) => {\r\n            return i.page === pageNumber && i.class === 'Annotation';\r\n          });\r\n\r\n          resolve({\r\n            documentId,\r\n            userId,\r\n            pageNumber,\r\n            annotations\r\n          });\r\n        });\r\n      },\r\n\r\n      getAnnotation(documentId, annotationId) {\r\n        return Promise.resolve(getAnnotations(documentId, userId)[findAnnotation(documentId, userId, annotationId)]);\r\n      },\r\n\r\n      addAnnotation(documentId, userId, pageNumber, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          annotation.class = 'Annotation';\r\n          annotation.uuid = uuid();\r\n          annotation.page = pageNumber;\r\n          annotation.userId = userId;\r\n\r\n          let annotations = getAnnotations(documentId, userId);\r\n          annotations.push(annotation);\r\n          updateAnnotations(documentId, userId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      editAnnotation(documentId, userId, annotationId, annotation) {\r\n        return new Promise((resolve, reject) => {\r\n          let annotations = getAnnotations(documentId, userId);\r\n          annotations[findAnnotation(documentId, userId, annotationId)] = annotation;\r\n          updateAnnotations(documentId, userId, annotations);\r\n\r\n          resolve(annotation);\r\n        });\r\n      },\r\n\r\n      deleteAnnotation(documentId, userId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          let index = findAnnotation(documentId, userId, annotationId);\r\n          if (index > -1) {\r\n            let annotations = getAnnotations(documentId, userId);\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, userId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      },\r\n\r\n      getComments(documentId, userId, annotationId) {\r\n        return new Promise((resolve, reject) => {\r\n          resolve(getAnnotations(documentId, userId).filter((i) => {\r\n            return i.class === 'Comment' && i.annotation === annotationId;\r\n          }));\r\n        });\r\n      },\r\n\r\n      addComment(documentId, userId, annotationId, content) {\r\n        return new Promise((resolve, reject) => {\r\n          let comment = {\r\n            class: 'Comment',\r\n            uuid: uuid(),\r\n            annotation: annotationId,\r\n            content: content\r\n          };\r\n\r\n          let annotations = getAnnotations(documentId, userId);\r\n          annotations.push(comment);\r\n          updateAnnotations(documentId, userId, annotations);\r\n\r\n          resolve(comment);\r\n        });\r\n      },\r\n\r\n      deleteComment(documentId, userId, commentId) {\r\n        return new Promise((resolve, reject) => {\r\n          getAnnotations(documentId, userId);\r\n          let index = -1;\r\n          let annotations = getAnnotations(documentId, userId);\r\n          for (let i=0, l=annotations.length; i<l; i++) {\r\n            if (annotations[i].uuid === commentId) {\r\n              index = i;\r\n              break;\r\n            }\r\n          }\r\n\r\n          if (index > -1) {\r\n            annotations.splice(index, 1);\r\n            updateAnnotations(documentId, userId, annotations);\r\n          }\r\n\r\n          resolve(true);\r\n        });\r\n      }\r\n    });\r\n    this._userId = userId;\r\n  }\r\n  get userId(){\r\n    return this._userId;\r\n  }\r\n}\r\n\r\nfunction getAllAnnotations(){\r\n  let all_annotations = [];\r\n  for(let i = 0 ; i < localStorage.length; i++){\r\n    if(localStorage.key(i).includes('annotations')){\r\n      all_annotations.push(...JSON.parse(localStorage.getItem(localStorage.key(i))));\r\n    }\r\n  }\r\n  return all_annotations;\r\n}\r\n\r\nfunction getAnnotations(documentId, userId) {\r\n  return JSON.parse(localStorage.getItem(`${documentId}/${userId}/annotations`)) || [];\r\n}\r\n\r\nfunction updateAnnotations(documentId, userId, annotations) {\r\n  localStorage.setItem(`${documentId}/${userId}/annotations`, JSON.stringify(annotations));\r\n}\r\n/**\r\n * \r\n * @param {String} documentId Document id of the annotation\r\n * @param {String} userId User id of the annotation\r\n * @param {String} annotationId The id of the annotation\r\n * \r\n * This function finds all the annotation made by one user.\r\n * \r\n * @return {int} The index of the annotation in localstorage\r\n */\r\nfunction findAnnotation(documentId, userId, annotationId) {\r\n  let index = -1;\r\n  let annotations = getAnnotations(documentId, userId);\r\n  for (let i=0, l=annotations.length; i<l; i++) {\r\n    if (annotations[i].uuid === annotationId) {\r\n      index = i;\r\n      break;\r\n    }\r\n  }\r\n  return index;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/adapter/LocalStoreAdapter.js\n **/","const REGEXP = /[xy]/g\r\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\r\n\r\nfunction replacement(c) {\r\n  let r = Math.random()*16|0;\r\n  let v = c == 'x' ? r : (r&0x3|0x8);\r\n  return v.toString(16);\r\n}\r\n\r\n/**\r\n * Generate a univierally unique identifier\r\n *\r\n * @return {String}\r\n */\r\nexport default function uuid() {\r\n  return PATTERN.replace(REGEXP, replacement);\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/utils/uuid.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild, transformChild } from './appendChild';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n/**\r\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\r\n *\r\n * @param {SVGElement} svg The SVG element to render the annotations to\r\n * @param {Object} viewport The page viewport data\r\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: SVGElement\r\n *    - rejected: Error\r\n */\r\nexport default function render(svg, viewport, data) {\r\n  return new Promise((resolve, reject) => {\r\n    // Reset the content of the SVG\r\n    svg.setAttribute('data-pdf-annotate-container', true);\r\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\r\n    svg.removeAttribute('data-pdf-annotate-document');\r\n    svg.removeAttribute('data-pdf-annotate-page');\r\n\r\n    // If there's no data nothing can be done\r\n    if (!data) {\r\n      svg.innerHTML = ''; \r\n      return resolve(svg);\r\n    }\r\n\r\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\r\n    svg.setAttribute('data-pdf-annotate-user', data.userId);\r\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\r\n  \r\n    // Make sure annotations is an array\r\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\r\n      return resolve(svg);\r\n    }\r\n\r\n    // Append or transform annotation to svg\r\n    data.annotations.forEach((a) => {\r\n      var node = svg.querySelector('[data-pdf-annotate-id=\"' + a.uuid + '\"]');\r\n      if (node) {\r\n        transformChild(svg, node, viewport);\r\n      } else {\r\n        appendChild(svg, a, viewport);\r\n      }\r\n    });\r\n\r\n    resolve(svg);\r\n  });\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/render/index.js\n **/","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport initEventHandlers from './initEventHandlers';\r\n\r\n// TODO This is not the right place for this to live\r\ninitEventHandlers();\r\n\r\n/**\r\n * Insert hints into the DOM for screen readers.\r\n *\r\n * @param {Array} annotations The annotations that hints are inserted for\r\n */\r\nexport default function renderScreenReaderHints(annotations) {\r\n  annotations = Array.isArray(annotations) ? annotations : [];\r\n\r\n  // Insert hints for each type\r\n  Object.keys(SORT_TYPES).forEach((type) => {\r\n    let sortBy = SORT_TYPES[type];\r\n    annotations\r\n      .filter((a) => a.type === type)\r\n      .sort(sortBy)\r\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\r\n  });\r\n}\r\n\r\n// Sort annotations first by y, then by x.\r\n// This allows hints to be injected in the order they appear,\r\n// which makes numbering them easier.\r\nfunction sortByPoint(a, b) {\r\n  if (a.y < b.y) {\r\n    return a.x - b.x;\r\n  } else {\r\n    return 1;\r\n  }\r\n}\r\n\r\n// Sort annotation by it's first rectangle\r\nfunction sortByRectPoint(a, b) {\r\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\r\n}\r\n\r\n// Sort annotation by it's first line\r\nfunction sortByLinePoint(a, b) {\r\n  let lineA = a.lines[0];\r\n  let lineB = b.lines[0];\r\n  return sortByPoint(\r\n    {x: lineA[0], y: lineA[1]},\r\n    {x: lineB[0], y: lineB[1]}\r\n  );\r\n}\r\n\r\n// Arrange supported types and associated sort methods\r\nconst SORT_TYPES = {\r\n  'highlight': sortByRectPoint,\r\n  'strikeout': sortByRectPoint,\r\n  'drawing': sortByLinePoint,\r\n  'textbox': sortByPoint,\r\n  'point': sortByPoint,\r\n  'area': sortByPoint\r\n};\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/renderScreenReaderHints.js\n **/","import createScreenReaderOnly from './createScreenReaderOnly';\r\nimport insertElementWithinChildren from './insertElementWithinChildren';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\n\r\n// Annotation types that support comments\r\nconst COMMENT_TYPES = ['highlight', 'point', 'area','circle','emptycircle','fillcircle'];\r\n\r\n/**\r\n * Insert a hint into the DOM for screen readers for a specific annotation.\r\n *\r\n * @param {Object} annotation The annotation to insert a hint for\r\n * @param {Number} num The number of the annotation out of all annotations of the same type\r\n */\r\nexport default function insertScreenReaderHint(annotation, num = 0) {\r\n  switch (annotation.type) {\r\n    case 'highlight':\r\n    case 'strikeout':\r\n      let rects = annotation.rectangles;\r\n      let first = rects[0];\r\n      let last = rects[rects.length - 1];\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.uuid),\r\n        first.x, first.y, annotation.page, true\r\n      );\r\n\r\n      insertElementWithinElement(\r\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.uuid}-end`),\r\n        last.x + last.width, last.y, annotation.page, false\r\n      );\r\n      break;\r\n\r\n    case 'textbox':\r\n    case 'point':\r\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.uuid),\r\n        annotation.x, annotation.y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'drawing':\r\n    case 'area':\r\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\r\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x, y, annotation.page\r\n      );\r\n      break;\r\n\r\n    case 'circle':\r\n    case 'fillcircle':\r\n    case 'emptycircle':\r\n      let x2 = typeof annotation.cx !== 'undefined' ? annotation.cx : annotation.lines[0][0];\r\n      let y2 = typeof annotation.cy !== 'undefined' ? annotation.cy : annotation.lines[0][1];\r\n\r\n      insertElementWithinChildren(\r\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.uuid),\r\n        x2, y2, annotation.page\r\n      );\r\n      break;\r\n  }\r\n\r\n  // Include comments in screen reader hint\r\n  if (COMMENT_TYPES.includes(annotation.type)) {\r\n    renderScreenReaderComments(annotation.documentId, annotation.uuid);\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertScreenReaderHint.js\n **/","/**\r\n * Create a node that is only visible to screen readers\r\n *\r\n * @param {String} content The text content that should be read by screen reader\r\n * @param {String} [annotationId] The ID of the annotation assocaited\r\n * @return {Element} An Element that is only visible to screen readers\r\n */\r\nexport default function createScreenReaderOnly(content, annotationId) {\r\n  let node = document.createElement('div');\r\n  let text = document.createTextNode(content);\r\n  node.appendChild(text);\r\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\r\n  node.style.position = 'absolute';\r\n  node.style.left = '-10000px';\r\n  node.style.top = 'auto';\r\n  node.style.width = '1px';\r\n  node.style.height = '1px';\r\n  node.style.overflow = 'hidden';\r\n  return node;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/createScreenReaderOnly.js\n **/","import config from '../config';\r\nimport insertElementWithinElement from './insertElementWithinElement';\r\nimport { pointIntersectsRect } from '../UI/utils';\r\nimport { scaleUp } from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will try to insert between elements if possible.\r\n * It will however use `insertElementWithinElement` if it is more accurate.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\r\n  // Try and use most accurate method of inserting within an element\r\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\r\n    return true;\r\n  }\r\n\r\n  // Fall back to inserting between elements\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  let nodes = [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' > div')];\r\n\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n\r\n  // Find the best node to insert before\r\n  for (let i=0, l=nodes.length; i<l; i++) {\r\n    let n = nodes[i];\r\n    let r = n.getBoundingClientRect();\r\n    if (y <= r.top) {\r\n      n.parentNode.insertBefore(el, n);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  // If all else fails try to append to the bottom\r\n  let textLayer = svg.parentNode.querySelector(config.textClassQuery());\r\n  if (textLayer) {\r\n    let textRect = textLayer.getBoundingClientRect();\r\n    if (pointIntersectsRect(x, y, textRect)) {\r\n      textLayer.appendChild(el);\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertElementWithinChildren.js\n **/","export default {\r\n    annotationLayerName: 'annotationLayer',\r\n    textLayerName: 'textLayer',\r\n    annotationSvgQuery: function () {\r\n        return 'svg.' + this.annotationLayerName;\r\n    },\r\n    annotationClassQuery: function () {\r\n        return '.' + this.annotationLayerName;\r\n    },\r\n    textClassQuery: function () {\r\n        return '.' + this.textLayerName;\r\n    }    \r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/config.js\n **/","import config from '../config'\r\nimport {\r\n  pointIntersectsRect,\r\n  scaleUp,\r\n  scaleDown\r\n} from '../UI/utils'; \r\n\r\n/**\r\n * Insert an element at a point within the document.\r\n * This algorithm will only insert within an element amidst it's text content.\r\n *\r\n * @param {Element} el The element to be inserted\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page number to limit elements to\r\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\r\n * @return {Boolean} True if element was able to be inserted, otherwise false\r\n */\r\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\r\n  const OFFSET_ADJUST = 2;\r\n\r\n  // If inserting before adjust `x` by looking for element a few px to the right\r\n  // Otherwise adjust a few px to the left\r\n  // This is to allow a little tolerance by searching within the box, instead\r\n  // of getting a false negative by testing right on the border.\r\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\r\n\r\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\r\n  if (!node) {\r\n    return false;\r\n  }\r\n  \r\n  // Now that node has been found inverse the adjustment for `x`.\r\n  // This is done to accomodate tolerance by cutting off on the outside of the\r\n  // text boundary, instead of missing a character by cutting off within.\r\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\r\n\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\r\n  let temp = node.cloneNode(true);\r\n  let head = temp.innerHTML.split('');\r\n  let tail = [];\r\n\r\n  // Insert temp off screen\r\n  temp.style.position = 'absolute';\r\n  temp.style.top = '-10000px';\r\n  temp.style.left = '-10000px';\r\n  document.body.appendChild(temp);\r\n\r\n  while (head.length) {\r\n    // Don't insert within HTML tags\r\n    if (head[head.length - 1] === '>') {\r\n      while(head.length) {\r\n        tail.unshift(head.pop());\r\n        if (tail[0] === '<') {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    \r\n    // Check if width of temp based on current head value satisfies x\r\n    temp.innerHTML = head.join('');\r\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\r\n    if (left + width <= x) {\r\n      break;\r\n    }\r\n    tail.unshift(head.pop());\r\n  }\r\n  \r\n  // Update original node with new markup, including element to be inserted\r\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\r\n  temp.parentNode.removeChild(temp);\r\n\r\n  return true;\r\n}\r\n\r\n/**\r\n * Get a text layer element at a given point on a page\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n * @param {Number} pageNumber The page to limit elements to\r\n * @return {Element} First text layer element found at the point\r\n */\r\nfunction textLayerElementFromPoint(x, y, pageNumber) {\r\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\r\n  let rect = svg.getBoundingClientRect();\r\n  y = scaleUp(svg, {y}).y + rect.top;\r\n  x = scaleUp(svg, {x}).x + rect.left;\r\n  return [...svg.parentNode.querySelectorAll(config.textClassQuery() + ' [data-canvas-width]')].filter((el) => {\r\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\r\n  })[0];\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertElementWithinElement.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\n\r\n/**\r\n * Insert the comments into the DOM to be available by screen reader\r\n *\r\n * Example output:\r\n *   <div class=\"screenReaderOnly\">\r\n *    <div>Begin highlight 1</div>\r\n *    <ol aria-label=\"Comments\">\r\n *      <li>Foo</li>\r\n *      <li>Bar</li>\r\n *      <li>Baz</li>\r\n *      <li>Qux</li>\r\n *    </ol>\r\n *  </div>\r\n *  <div>Some highlighted text goes here...</div>\r\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\r\n *\r\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of the annotation\r\n * @param {Array} [comments] Optionally preloaded comments to be rendered\r\n * @return {Promise}\r\n */\r\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\r\n  let promise;\r\n\r\n  if (Array.isArray(comments)) {\r\n    promise = Promise.resolve(comments);\r\n  } else {\r\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\r\n  }\r\n\r\n  return promise.then((comments) => {\r\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\r\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\r\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n    if (node) { \r\n      let list = document.createElement('ol');\r\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      list.setAttribute('aria-label', 'Comments');\r\n      node.appendChild(list);\r\n      comments.forEach(insertScreenReaderComment);\r\n    }\r\n  });\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/renderScreenReaderComments.js\n **/","/**\r\n * Insert a comment into the DOM to be available by screen reader\r\n *\r\n * @param {Object} comment The comment to be inserted\r\n */\r\nexport default function insertScreenReaderComment(comment) {\r\n  if (!comment) {\r\n    return;\r\n  }\r\n\r\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\r\n  if (list) {\r\n    let item = document.createElement('li');\r\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.uuid}`);\r\n    item.appendChild(document.createTextNode(`${comment.content}`));\r\n    list.appendChild(item);\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/insertScreenReaderComment.js\n **/","import insertScreenReaderHint from './insertScreenReaderHint';\r\nimport renderScreenReaderHints from './renderScreenReaderHints';\r\nimport insertScreenReaderComment from './insertScreenReaderComment';\r\nimport renderScreenReaderComments from './renderScreenReaderComments';\r\nimport { addEventListener } from '../UI/event';\r\nimport PDFJSAnnotate from '../PDFJSAnnotate';\r\n\r\n/**\r\n * Initialize the event handlers for keeping screen reader hints synced with data\r\n */\r\nexport default function initEventHandlers() {\r\n  addEventListener('annotation:add', (documentId, userId, pageNumber, annotation) => {\r\n    reorderAnnotationsByType(documentId, userId, pageNumber, annotation.type);\r\n  });\r\n  addEventListener('annotation:edit', (documentId, userId, annotationId, annotation) => {\r\n    reorderAnnotationsByType(documentId, userId, annotation.page, annotation.type);\r\n  });\r\n  addEventListener('annotation:delete', removeAnnotation);\r\n  addEventListener('comment:add', insertComment);\r\n  addEventListener('comment:delete', removeComment);\r\n}\r\n\r\n/**\r\n * Reorder the annotation numbers by annotation type\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} userId The ID of the user\r\n * @param {Number} pageNumber The page number of the annotations\r\n * @param {Strig} type The annotation type\r\n */\r\nfunction reorderAnnotationsByType(documentId, userId, pageNumber, type) {\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, userId, pageNumber)\r\n    .then((annotations) => {\r\n      return annotations.annotations.filter((a) => {\r\n        return a.type === type;\r\n      });\r\n    })\r\n    .then((annotations) => {\r\n      annotations.forEach((a) => {\r\n        removeAnnotation(documentId, a.uuid);\r\n      });\r\n\r\n      return annotations;\r\n    })\r\n    .then(renderScreenReaderHints);\r\n}\r\n\r\n/**\r\n * Remove the screen reader hint for an annotation\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The Id of the annotation\r\n */\r\nfunction removeAnnotation(documentId, annotationId) {\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\r\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\r\n}\r\n\r\n/**\r\n * Insert a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} annotationId The ID of tha assocated annotation\r\n * @param {Object} comment The comment to insert a hint for\r\n */\r\nfunction insertComment(documentId, annotationId, comment) {\r\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n  let promise;\r\n\r\n  if (!list) {\r\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\r\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\r\n      return true;\r\n    });\r\n  } else {\r\n    promise = Promise.resolve(true);\r\n  }\r\n\r\n  promise.then(() => {\r\n    insertScreenReaderComment(comment);\r\n  });\r\n}\r\n\r\n/**\r\n * Remove a screen reader hint for a comment\r\n *\r\n * @param {String} documentId The ID of the document\r\n * @param {String} commentId The ID of the comment\r\n */\r\nfunction removeComment(documentId, commentId) {\r\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\r\n}\r\n\r\n/**\r\n * Remove an element from the DOM by it's ID if it exists\r\n *\r\n * @param {String} elementID The ID of the element to be removed\r\n */\r\nfunction removeElementById(elementId) {\r\n  let el = document.getElementById(elementId);\r\n  if (el) {\r\n    el.parentNode.removeChild(el);\r\n  }\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/a11y/initEventHandlers.js\n **/","import { addEventListener, removeEventListener, fireEvent } from './event';\r\nimport { disableEdit, enableEdit } from './edit';\r\nimport { disablePen, enablePen, setPen } from './pen';\r\nimport { enableEraser, disableEraser } from './eraser';\r\nimport { disableArrow, enableArrow, setArrow } from './arrow';\r\nimport { disablePoint, enablePoint } from './point';\r\nimport { disableRect, enableRect } from './rect';\r\nimport { disableCircle, enableCircle, setCircle, addCircle } from './circle';\r\nimport { disableText, enableText, setText } from './text';\r\nimport { createPage, renderPage } from './page';\r\n\r\nexport default {\r\n  addEventListener, removeEventListener, fireEvent,\r\n  disableEdit, enableEdit,\r\n  disablePen, enablePen, setPen,\r\n  enableEraser, disableEraser,\r\n  disablePoint, enablePoint,\r\n  disableRect, enableRect,\r\n  disableCircle, enableCircle, setCircle, addCircle,\r\n  disableArrow, enableArrow, setArrow,\r\n  disableText, enableText, setText,\r\n  createPage, renderPage\r\n};\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/index.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  addEventListener,\r\n  removeEventListener\r\n} from './event';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGContainer,\r\n  findSVGAtPoint,\r\n  getOffsetAnnotationRect,\r\n  getMetadata,\r\n  scaleUp,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet isDragging = false, overlay;\r\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\r\nconst OVERLAY_BORDER_SIZE = 3;\r\n\r\n/**\r\n * Create an overlay for editing an annotation.\r\n *\r\n * @param {Element} target The annotation element to apply overlay for\r\n */\r\nfunction createEditOverlay(target) {\r\n  destroyEditOverlay();\r\n\r\n  overlay = document.createElement('div');\r\n  let anchor = document.createElement('a');\r\n  let parentNode = findSVGContainer(target).parentNode;\r\n  let id = target.getAttribute('data-pdf-annotate-id');\r\n  let rect = getOffsetAnnotationRect(target);\r\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\r\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\r\n  \r\n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\r\n  overlay.setAttribute('data-target-id', id);\r\n  overlay.style.boxSizing = 'content-box';\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${styleTop}px`;\r\n  overlay.style.left = `${styleLeft}px`;\r\n  overlay.style.width = `${rect.width}px`;\r\n  overlay.style.height = `${rect.height}px`;\r\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\r\n  overlay.style.zIndex = 20100;\r\n\r\n  anchor.innerHTML = '×';\r\n  anchor.setAttribute('href', 'javascript://');\r\n  anchor.style.background = '#fff';\r\n  anchor.style.borderRadius = '20px';\r\n  anchor.style.border = '1px solid #bbb';\r\n  anchor.style.color = '#bbb';\r\n  anchor.style.fontSize = '16px';\r\n  anchor.style.padding = '2px';\r\n  anchor.style.textAlign = 'center';\r\n  anchor.style.textDecoration = 'none';\r\n  anchor.style.position = 'absolute';\r\n  anchor.style.top = '-13px';\r\n  anchor.style.right = '-13px';\r\n  anchor.style.width = '25px';\r\n  anchor.style.height = '25px';\r\n  \r\n  overlay.appendChild(anchor);\r\n  parentNode.appendChild(overlay);\r\n  document.addEventListener('click', handleDocumentClick);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  anchor.addEventListener('click', deleteAnnotation);\r\n  anchor.addEventListener('mouseover', () => {\r\n    anchor.style.color = '#35A4DC';\r\n    anchor.style.borderColor = '#999';\r\n    anchor.style.boxShadow = '0 1px 1px #ccc';\r\n  });\r\n  anchor.addEventListener('mouseout', () => {\r\n    anchor.style.color = '#bbb';\r\n    anchor.style.borderColor = '#bbb';\r\n    anchor.style.boxShadow = '';\r\n  });\r\n  overlay.addEventListener('mouseover', () => {\r\n    if (!isDragging) { anchor.style.display = ''; }\r\n  });\r\n  overlay.addEventListener('mouseout', () => {\r\n    anchor.style.display = 'none';\r\n  });\r\n}\r\n\r\n/**\r\n * Destroy the edit overlay if it exists.\r\n */\r\nfunction destroyEditOverlay() {\r\n  if (overlay) {\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n  }\r\n\r\n  document.removeEventListener('click', handleDocumentClick);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Delete currently selected annotation\r\n */\r\nfunction deleteAnnotation() {\r\n  if (!overlay) { return; }\r\n\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let { documentId } = getMetadata(svg);\r\n\r\n  [...nodes].forEach((n) => {\r\n    n.parentNode.removeChild(n);\r\n  });\r\n  \r\n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\r\n\r\n  destroyEditOverlay();\r\n}\r\n\r\n/**\r\n * Handle document.click event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentClick(e) {\r\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\r\n\r\n  // Remove current overlay\r\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\r\n  if (overlay) {\r\n    if (isDragging || e.target === overlay) {\r\n      return;\r\n    }\r\n\r\n    destroyEditOverlay();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  if (overlay && e.keyCode === 46 &&\r\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\r\n      e.target.nodeName.toLowerCase() !== 'input') {\r\n    deleteAnnotation();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  if (e.target !== overlay) { return; }\r\n\r\n  // Highlight and strikeout annotations are bound to text within the document.\r\n  // It doesn't make sense to allow repositioning these types of annotations.\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n\r\n  if (type === 'highlight' || type === 'strikeout') { return; }\r\n\r\n  isDragging = true;\r\n  dragOffsetX = e.clientX;\r\n  dragOffsetY = e.clientY;\r\n  dragStartX = overlay.offsetLeft;\r\n  dragStartY = overlay.offsetTop;\r\n\r\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\r\n  overlay.style.cursor = 'move';\r\n  overlay.querySelector('a').style.display = 'none';\r\n\r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let parentNode = overlay.parentNode;\r\n  let rect = parentNode.getBoundingClientRect();\r\n  let y = (dragStartY + (e.clientY - dragOffsetY));\r\n  let x = (dragStartX + (e.clientX - dragOffsetX));\r\n  let minY = 0;\r\n  let maxY = rect.height;\r\n  let minX = 0;\r\n  let maxX = rect.width;\r\n\r\n  if (y > minY && y + overlay.offsetHeight < maxY) {\r\n    overlay.style.top = `${y}px`;\r\n  }\r\n\r\n  if (x > minX && x + overlay.offsetWidth < maxX) {\r\n    overlay.style.left = `${x}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event that needs to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let annotationId = overlay.getAttribute('data-target-id');\r\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n  let type = target[0].getAttribute('data-pdf-annotate-type');\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let { documentId, userId } = getMetadata(svg);\r\n  \r\n  overlay.querySelector('a').style.display = '';\r\n\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, userId, annotationId).then((annotation) => {\r\n    let attribX = 'x';\r\n    let attribY = 'y';\r\n    if (['circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\r\n      attribX = 'cx';\r\n      attribY = 'cy';\r\n    }\r\n    if (['area', 'highlight', 'point', 'textbox', 'circle', 'fillcircle', 'emptycircle'].indexOf(type) > -1) {\r\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\r\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\r\n      let modelDelta = {\r\n        x: modelEnd[0] - modelStart[0],\r\n        y: modelEnd[1] - modelStart[1]\r\n      };\r\n\r\n      if (type === 'textbox') {\r\n        target = [target[0].firstChild];\r\n      }\r\n\r\n      [...target].forEach((t, i) => {\r\n        let modelX = parseInt(t.getAttribute(attribX), 10);\r\n        let modelY = parseInt(t.getAttribute(attribY), 10);\r\n        if (modelDelta.y !== 0) {\r\n          modelY = modelY + modelDelta.y;\r\n          let viewY = modelY;\r\n\r\n          if (type === 'point') {\r\n            viewY = scaleUp(svg, { viewY }).viewY;\r\n          }\r\n\r\n          t.setAttribute(attribY, viewY);\r\n          if (annotation.rectangles && i < annotation.rectangles.length) {\r\n            annotation.rectangles[i].y = modelY;\r\n          } else if (annotation[attribY]) {\r\n            annotation[attribY] = modelY;\r\n          }\r\n        }\r\n        if (modelDelta.x !== 0) {\r\n          modelX = modelX + modelDelta.x;\r\n          let viewX = modelX;\r\n\r\n          if (type === 'point') {\r\n            viewX = scaleUp(svg, { viewX }).viewX;\r\n          }\r\n\r\n          t.setAttribute(attribX, viewX);\r\n          if (annotation.rectangles  && i < annotation.rectangles.length) {\r\n            annotation.rectangles[i].x = modelX;\r\n          } else if (annotation[attribX]) {\r\n            annotation[attribX] = modelX;\r\n          }\r\n        }\r\n      });\r\n    // } else if (type === 'strikeout') {\r\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\r\n    //   [...target].forEach(target, (t, i) => {\r\n    //     if (deltaY !== 0) {\r\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\r\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\r\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\r\n    //     }\r\n    //     if (deltaX !== 0) {\r\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\r\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\r\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\r\n    //     }\r\n    //   });\r\n    } else if (type === 'drawing' || type === 'arrow') {\r\n      let modelStart = convertToSvgPoint([dragStartX, dragStartY], svg);\r\n      let modelEnd = convertToSvgPoint([overlay.offsetLeft, overlay.offsetTop], svg);\r\n      let modelDelta = {\r\n        x: modelEnd[0] - modelStart[0],\r\n        y: modelEnd[1] - modelStart[1]\r\n      };\r\n\r\n      annotation.lines.forEach((line, i) => {\r\n        let [x, y] = annotation.lines[i];\r\n        annotation.lines[i][0] = x + modelDelta.x;\r\n        annotation.lines[i][1] = y + modelDelta.y;\r\n      });\r\n\r\n      target[0].parentNode.removeChild(target[0]);\r\n      appendChild(svg, annotation);\r\n    } \r\n\r\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\r\n  });\r\n\r\n  setTimeout(() => {\r\n    isDragging = false;\r\n  }, 0);\r\n\r\n  overlay.style.background = '';\r\n  overlay.style.cursor = '';\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  enableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle annotation.click event\r\n *\r\n * @param {Element} e The annotation element that was clicked\r\n */\r\nfunction handleAnnotationClick(target) {\r\n  createEditOverlay(target);\r\n}\r\n\r\n/**\r\n * Enable edit mode behavior.\r\n */\r\nexport function enableEdit () {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  addEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n/**\r\n * Disable edit mode behavior.\r\n */\r\nexport function disableEdit () {\r\n  destroyEditOverlay();\r\n\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  removeEventListener('annotation:click', handleAnnotationClick);\r\n};\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/edit.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _candraw = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines = [];\r\n\r\nconst isFirefox = /firefox/i.test(navigator.userAgent);\r\n\r\n/**\r\n * Handle document.touchdown or document.pointerdown event\r\n */\r\nfunction handleDocumentPointerdown(e) {\r\n  e.preventDefault();\r\n  path = null;\r\n  lines = [];\r\n  _candraw = true;\r\n}\r\n\r\n/**\r\n * Handle document.touchup or document.pointerup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentPointerupChrome(e){\r\n  saveToStorage(e.changedTouches[0].clientX, e.changedTouches[0].clientY);\r\n}\r\n\r\nfunction handleDocumentPointerup(e) {\r\n  saveToStorage(e.clientX, e.clientY);\r\n}\r\n\r\nfunction saveToStorage(x, y){\r\n  _candraw = false;\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(x, y))) {\r\n    let { documentId, userId, pageNumber } = getMetadata(svg);\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, userId, pageNumber, {\r\n        type: 'drawing',\r\n        width: _penSize,\r\n        color: _penColor,\r\n        lines\r\n      }\r\n    ).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentPointermove(e) {\r\n  if(!e.srcElement.classList.contains('annotationLayer')){\r\n    return;\r\n  }\r\n  if(_candraw){\r\n    savePoint(e.clientX, e.clientY);\r\n  }\r\n}\r\n\r\nfunction handleDocumentPointermoveChrome(e){\r\n  if(!e.srcElement.classList.contains('annotationLayer')){\r\n    return;\r\n  }\r\n  if(_candraw){\r\n    savePoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('pointermove', handleDocumentPointermove);\r\n    document.removeEventListener('pointerup', handleDocumentPointerup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = convertToSvgPoint([\r\n    x - rect.left,\r\n    y - rect.top\r\n  ], svg);\r\n  point[0] = point[0].toFixed(2);\r\n  point[1] = point[1].toFixed(2);\r\n  lines.push(point);\r\n\r\n  if (lines.length <= 1) {\r\n    return;\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'drawing',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setPen(penSize = 1, penColor = '000000') {\r\n  _penSize = parseInt(penSize, 10);\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enablePen() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  // Chrome and Firefox has different behaviors with how pen works, so we need different events.\r\n  if (!isFirefox){\r\n    document.addEventListener('touchstart', handleDocumentPointerdown);\r\n    document.addEventListener('touchmove', handleDocumentPointermoveChrome);\r\n    document.addEventListener('touchend', handleDocumentPointerupChrome);\r\n    document.addEventListener('mousedown', handleDocumentPointerdown);\r\n    document.addEventListener('mousemove', handleDocumentPointermove);\r\n    document.addEventListener('mouseup', handleDocumentPointerup);\r\n  } else {\r\n    document.addEventListener('pointerdown', handleDocumentPointerdown);\r\n    document.addEventListener('pointermove', handleDocumentPointermove);\r\n    document.addEventListener('pointerup', handleDocumentPointerup);\r\n  }\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disablePen() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  if (!isFirefox){\r\n    document.removeEventListener('touchstart', handleDocumentPointerdown);\r\n    document.removeEventListener('touchmove', handleDocumentPointermoveChrome);\r\n    document.removeEventListener('touchend', handleDocumentPointerupChrome);\r\n    document.removeEventListener('mousedown', handleDocumentPointerdown);\r\n    document.removeEventListener('mousemove', handleDocumentPointermove);\r\n    document.removeEventListener('mouseup', handleDocumentPointerup);\r\n  } else {\r\n    document.removeEventListener('pointerdown', handleDocumentPointerdown);\r\n    document.removeEventListener('pointermove', handleDocumentPointermove);\r\n    document.removeEventListener('pointerup', handleDocumentPointerup);\r\n  }\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/pen.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport {\r\n  findAnnotationAtPoint,\r\n  findSVGAtPoint,\r\n  getMetadata\r\n} from './utils';\r\n\r\nlet _canerase = false;\r\nlet userId = \"user\";\r\n\r\nfunction handleDocumentDown(e){\r\n  _canerase = true;\r\n}\r\n\r\nfunction handleDocumentUp(e){\r\n  _canerase = false;\r\n}\r\n\r\nfunction handleDocumentTouchMove(e){\r\n  erase(findAnnotationAtPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY));\r\n}\r\n\r\nfunction handleDocumentMouseMove(e){\r\n  erase(findAnnotationAtPoint(e.clientX, e.clientY));\r\n}\r\n\r\nfunction erase(target){\r\n  if(_canerase){\r\n    if(target && target.getAttribute('data-pdf-annotate-userId') == userId){\r\n      let { documentId } = getMetadata(target.parentElement);\r\n      let annotationId = target.getAttribute('data-pdf-annotate-id');\r\n      let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\r\n      [...nodes].forEach((n) => {\r\n        n.parentNode.removeChild(n);\r\n      });\r\n      \r\n      PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, userId, annotationId);\r\n    }\r\n  }\r\n}\r\n\r\nexport function enableEraser(){\r\n  userId = PDFJSAnnotate.getStoreAdapter().userId;\r\n  document.addEventListener('mousemove', handleDocumentMouseMove);\r\n  document.addEventListener('mousedown', handleDocumentDown);\r\n  document.addEventListener('mouseup', handleDocumentUp);\r\n  document.addEventListener('touchstart', handleDocumentDown);\r\n  document.addEventListener('touchmove', handleDocumentTouchMove);\r\n  document.addEventListener('touchend', handleDocumentUp);\r\n}\r\n\r\nexport function disableEraser(){\r\n  document.removeEventListener('mousemove', handleDocumentMouseMove);\r\n  document.removeEventListener('mousedown', handleDocumentDown);\r\n  document.removeEventListener('mouseup', handleDocumentUp);\r\n  document.removeEventListener('touchstart', handleDocumentDown);\r\n  document.removeEventListener('touchmove', handleDocumentTouchMove);\r\n  document.removeEventListener('touchend', handleDocumentUp);\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/eraser.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  findSVGContainer,\r\n  getMetadata,\r\n  convertToSvgPoint,\r\n  convertToScreenPoint,\r\n  findAnnotationAtPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _penSize;\r\nlet _penColor;\r\nlet path;\r\nlet lines;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Handle document.mousedown event\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\r\n  if (target === null)\r\n    return;\r\n\r\n  let type = target.getAttribute('data-pdf-annotate-type');\r\n  if (type !== 'circle' && type !== 'fillcircle' && type !== 'emptycircle') {\r\n    return;\r\n  }\r\n\r\n  let svg = findSVGContainer(target);\r\n  let { documentId, userId } = getMetadata(svg);\r\n  let annotationId = target.getAttribute('data-pdf-annotate-id');\r\n\r\n  let event = e;\r\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, userId, annotationId).then((annotation) => {\r\n    if (annotation) {\r\n      path = null;\r\n      lines = [];\r\n\r\n      let point = convertToScreenPoint([\r\n        annotation.cx,\r\n        annotation.cy\r\n      ], svg);\r\n\r\n      let rect = svg.getBoundingClientRect();\r\n\r\n      originX = point[0] + rect.left;\r\n      originY = point[1] + rect.top;    \r\n\r\n      document.addEventListener('mousemove', handleDocumentMousemove);\r\n      document.addEventListener('mouseup', handleDocumentMouseup);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg;\r\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    let { documentId, pageNumber } = getMetadata(svg);\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\r\n        type: 'arrow',\r\n        width: _penSize,\r\n        color: _penColor,\r\n        lines\r\n      }\r\n    ).then((annotation) => {\r\n      if (path) {\r\n        svg.removeChild(path);\r\n      }\r\n\r\n      appendChild(svg, annotation);\r\n    });\r\n  }\r\n\r\n  document.removeEventListener('mousemove', handleDocumentMousemove);\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let x = lines.length === 0 ? originX : e.clientX;\r\n  let y = lines.length === 0 ? originY : e.clientY;\r\n\r\n  savePoint(x, y);\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to be handled\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    lines = null;\r\n    path.parentNode.removeChild(path);\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  }\r\n}\r\n\r\n/**\r\n * Save a point to the line being drawn.\r\n *\r\n * @param {Number} x The x coordinate of the point\r\n * @param {Number} y The y coordinate of the point\r\n */\r\nfunction savePoint(x, y) {\r\n  let svg = findSVGAtPoint(x, y);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  let point = convertToSvgPoint([\r\n    x - rect.left,\r\n    y - rect.top\r\n  ], svg);\r\n\r\n  if (lines.length < 2) {\r\n    lines.push(point);\r\n    return;\r\n  } else {\r\n    lines[1] = point; // update end point\r\n  }\r\n\r\n  if (path) {\r\n    svg.removeChild(path);\r\n  }\r\n\r\n  path = appendChild(svg, {\r\n    type: 'arrow',\r\n    color: _penColor,\r\n    width: _penSize,\r\n    lines\r\n  });\r\n}\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} penSize The size of the lines drawn by the pen\r\n * @param {String} penColor The color of the lines drawn by the pen\r\n */\r\nexport function setArrow(penSize = 10, penColor = '0000FF') {\r\n  _penSize = parseInt(penSize, 10);\r\n  _penColor = penColor;\r\n}\r\n\r\n/**\r\n * Enable the pen behavior\r\n */\r\nexport function enableArrow() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Disable the pen behavior\r\n */\r\nexport function disableArrow() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n  enableUserSelect();\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/arrow.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  scaleDown\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} The DOM event to be handled\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return\r\n  }\r\n  \r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-point-input');\r\n  input.setAttribute('placeholder', 'Enter comment');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  savePoint();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    savePoint();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a new point annotation from input\r\n */\r\nfunction savePoint() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let content = input.value.trim();\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n\r\n    let rect = svg.getBoundingClientRect();\r\n    let { documentId, userId, pageNumber } = getMetadata(svg);\r\n    let annotation = Object.assign({\r\n        type: 'point'\r\n      }, scaleDown(svg, {\r\n        x: clientX - rect.left,\r\n        y: clientY - rect.top\r\n      })\r\n    );\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, userId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        PDFJSAnnotate.getStoreAdapter().addComment(\r\n          documentId,\r\n          annotation.uuid,\r\n          content\r\n        );\r\n\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n\r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input element\r\n */\r\nfunction closeInput() {\r\n  input.removeEventListener('blur', handleInputBlur);\r\n  input.removeEventListener('keyup', handleInputKeyup);\r\n  document.body.removeChild(input);\r\n  input = null;\r\n}\r\n\r\n/**\r\n * Enable point annotation behavior\r\n */\r\nexport function enablePoint() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable point annotation behavior\r\n */\r\nexport function disablePoint() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/point.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  disableUserSelect,\r\n  enableUserSelect,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgRect\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet overlay;\r\nlet originY;\r\nlet originX;\r\n\r\n/**\r\n * Get the current window selection as rects\r\n *\r\n * @return {Array} An Array of rects\r\n */\r\nfunction getSelectionRects() {\r\n  try {\r\n    let selection = window.getSelection();\r\n    let range = selection.getRangeAt(0);\r\n    let rects = range.getClientRects();\r\n\r\n    if (rects.length > 0 &&\r\n        rects[0].width > 0 &&\r\n        rects[0].height > 0) {\r\n      return rects;\r\n    }\r\n  } catch (e) {}\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Handle document.mousedown event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousedown(e) {\r\n  let svg;\r\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\r\n    return;\r\n  }\r\n\r\n  let rect = svg.getBoundingClientRect();\r\n  originY = e.clientY;\r\n  originX = e.clientX;\r\n\r\n  overlay = document.createElement('div');\r\n  overlay.style.position = 'absolute';\r\n  overlay.style.top = `${originY - rect.top}px`;\r\n  overlay.style.left = `${originX - rect.left}px`;\r\n  overlay.style.border = `3px solid ${BORDER_COLOR}`;\r\n  overlay.style.borderRadius = '3px';\r\n  svg.parentNode.appendChild(overlay);\r\n  \r\n  document.addEventListener('mousemove', handleDocumentMousemove);\r\n  disableUserSelect();\r\n}\r\n\r\n/**\r\n * Handle document.mousemove event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMousemove(e) {\r\n  let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n  let rect = svg.getBoundingClientRect();\r\n\r\n  if (originX + (e.clientX - originX) < rect.right) {\r\n    overlay.style.width = `${e.clientX - originX}px`;\r\n  }\r\n\r\n  if (originY + (e.clientY - originY) < rect.bottom) {\r\n    overlay.style.height = `${e.clientY - originY}px`;\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let rects;\r\n  if (_type !== 'area' && (rects = getSelectionRects())) {\r\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n    saveRect(_type, [...rects].map((r) => {\r\n      return {\r\n        top: r.top,\r\n        left: r.left,\r\n        width: r.width,\r\n        height: r.height\r\n      };\r\n    }));\r\n  } else if (_type === 'area' && overlay) {\r\n    let svg = overlay.parentNode.querySelector(config.annotationSvgQuery());\r\n    let rect = svg.getBoundingClientRect();\r\n    saveRect(_type, [{\r\n      top: parseInt(overlay.style.top, 10) + rect.top,\r\n      left: parseInt(overlay.style.left, 10) + rect.left,\r\n      width: parseInt(overlay.style.width, 10),\r\n      height: parseInt(overlay.style.height, 10)\r\n    }]);\r\n\r\n    overlay.parentNode.removeChild(overlay);\r\n    overlay = null;\r\n\r\n    document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    enableUserSelect();\r\n  }\r\n}\r\n\r\n/**\r\n * Handle document.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentKeyup(e) {\r\n  // Cancel rect if Esc is pressed\r\n  if (e.keyCode === 27) {\r\n    let selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    if (overlay && overlay.parentNode) {\r\n      overlay.parentNode.removeChild(overlay);\r\n      overlay = null;\r\n      document.removeEventListener('mousemove', handleDocumentMousemove);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Save a rect annotation\r\n *\r\n * @param {String} type The type of rect (area, highlight, strikeout)\r\n * @param {Array} rects The rects to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveRect(type, rects, color) {\r\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\r\n  let annotation;\r\n\r\n  if (!svg) {\r\n    return;\r\n  }\r\n\r\n  let boundingRect = svg.getBoundingClientRect();\r\n\r\n  if (!color) {\r\n    if (type === 'highlight') {\r\n      color = 'FFFF00';\r\n    } else if (type === 'strikeout') {\r\n      color = 'FF0000';\r\n    }\r\n  }\r\n\r\n  // Initialize the annotation\r\n  annotation = {\r\n    type,\r\n    color,\r\n    rectangles: [...rects].map((r) => {\r\n      let offset = 0;\r\n\r\n      if (type === 'strikeout') {\r\n        offset = r.height / 2;\r\n      }\r\n\r\n      return convertToSvgRect({\r\n        y: (r.top + offset) - boundingRect.top,\r\n        x: r.left - boundingRect.left,\r\n        width: r.width,\r\n        height: r.height\r\n      }, svg);\r\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\r\n  };\r\n  \r\n  // Short circuit if no rectangles exist\r\n  if (annotation.rectangles.length === 0) {\r\n    return;\r\n  }\r\n\r\n  // Special treatment for area as it only supports a single rect\r\n  if (type === 'area') {\r\n    let rect = annotation.rectangles[0];\r\n    delete annotation.rectangles;\r\n    annotation.x = rect.x;\r\n    annotation.y = rect.y;\r\n    annotation.width = rect.width;\r\n    annotation.height = rect.height;\r\n  }\r\n\r\n  let { documentId, userId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, userId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable rect behavior\r\n */\r\nexport function enableRect(type) {\r\n  _type = type;\r\n  \r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n  document.addEventListener('mousedown', handleDocumentMousedown);\r\n  document.addEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n/**\r\n * Disable rect behavior\r\n */\r\nexport function disableRect() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n  document.removeEventListener('mousedown', handleDocumentMousedown);\r\n  document.removeEventListener('keyup', handleDocumentKeyup);\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/rect.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet _type;\r\nlet _circleRadius = 10;\r\nlet _circleColor = '0000FF';\r\n\r\n/**\r\n * Set the attributes of the pen.\r\n *\r\n * @param {Number} circleRadius The radius of the circle\r\n * @param {String} circleColor The color of the circle\r\n */\r\nexport function setCircle(circleRadius = 10, circleColor = '0000FF') {\r\n  _circleRadius = parseInt(circleRadius, 10);\r\n  _circleColor = circleColor;\r\n}\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  let svg = findSVGAtPoint(e.clientX, e.clientY);\r\n  if (!svg) {\r\n    return;\r\n  }\r\n  let rect = svg.getBoundingClientRect();\r\n  saveCircle(svg, _type, {\r\n      x: e.clientX - rect.left,\r\n      y: e.clientY - rect.top\r\n    }, _circleRadius, _circleColor\r\n  );\r\n}\r\n\r\n/**\r\n * Save a circle annotation\r\n *\r\n * @param {String} type The type of circle (circle, emptycircle, fillcircle)\r\n * @param {Object} pt The point to use for annotation\r\n * @param {String} color The color of the rects\r\n */\r\nfunction saveCircle(svg, type, pt, radius, color) {\r\n  // Initialize the annotation\r\n  let svg_pt = convertToSvgPoint([ pt.x, pt.y ], svg)\r\n  let annotation = {\r\n    type,\r\n    color,\r\n    cx: svg_pt[0],\r\n    cy: svg_pt[1],\r\n    r: radius\r\n  };\r\n\r\n  let { documentId, userId, pageNumber } = getMetadata(svg);\r\n\r\n  // Add the annotation\r\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, userId, pageNumber, annotation)\r\n    .then((annotation) => {\r\n      appendChild(svg, annotation);\r\n    });\r\n}\r\n\r\n/**\r\n * Enable circle behavior\r\n */\r\nexport function enableCircle(type) {\r\n  _type = type;\r\n  \r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n/**\r\n * Disable circle behavior\r\n */\r\nexport function disableCircle() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\nexport function addCircle(type, e) {\r\n  let oldType = _type;\r\n  _type = type;\r\n  handleDocumentMouseup(e);\r\n  _type = oldType; \r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/circle.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport { appendChild } from '../render/appendChild';\r\nimport {\r\n  BORDER_COLOR,\r\n  findSVGAtPoint,\r\n  getMetadata,\r\n  convertToSvgPoint\r\n} from './utils';\r\n\r\nlet _enabled = false;\r\nlet input;\r\nlet _textSize;\r\nlet _textColor;\r\n\r\n/**\r\n * Handle document.mouseup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleDocumentMouseup(e) {\r\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\r\n    return;\r\n  }\r\n  if(!e.srcElement.classList.contains('annotationLayer')){\r\n    return;\r\n  }\r\n  input = document.createElement('input');\r\n  input.setAttribute('id', 'pdf-annotate-text-input');\r\n  input.setAttribute('placeholder', 'Enter text');\r\n  input.style.border = `3px solid ${BORDER_COLOR}`;\r\n  input.style.borderRadius = '3px';\r\n  input.style.position = 'absolute';\r\n  input.style.top = `${e.clientY}px`;\r\n  input.style.left = `${e.clientX}px`;\r\n  input.style.fontSize = `${_textSize}px`;\r\n  input.style.zIndex = \"41\";\r\n  input.addEventListener('blur', handleInputBlur);\r\n  input.addEventListener('keyup', handleInputKeyup);\r\n\r\n  document.body.appendChild(input);\r\n  input.focus();\r\n}\r\n\r\n/**\r\n * Handle input.blur event\r\n */\r\nfunction handleInputBlur() {\r\n  saveText();\r\n}\r\n\r\n/**\r\n * Handle input.keyup event\r\n *\r\n * @param {Event} e The DOM event to handle\r\n */\r\nfunction handleInputKeyup(e) {\r\n  if (e.keyCode === 27) {\r\n    closeInput();\r\n  } else if (e.keyCode === 13) {\r\n    saveText();\r\n  }\r\n}\r\n\r\n/**\r\n * Save a text annotation from input\r\n */\r\nfunction saveText() {\r\n  if (input.value.trim().length > 0) {\r\n    let clientX = parseInt(input.style.left, 10);\r\n    let clientY = parseInt(input.style.top, 10);\r\n    let svg = findSVGAtPoint(clientX, clientY);\r\n    if (!svg) {\r\n      return;\r\n    }\r\n    let height = _textSize;\r\n    let { documentId, userId, pageNumber, viewport } = getMetadata(svg);\r\n    let scale = 1 / viewport.scale;\r\n    let rect = svg.getBoundingClientRect();\r\n    let pt = convertToSvgPoint([\r\n      clientX - rect.left, \r\n      clientY -  rect.top + height], svg, viewport);\r\n    let annotation = {\r\n        type: 'textbox',\r\n        size: _textSize * scale,\r\n        color: _textColor,\r\n        content: input.value.trim(),\r\n        x: pt[0],\r\n        y: pt[1],\r\n        rotation: -viewport.rotation\r\n    }\r\n\r\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, userId, pageNumber, annotation)\r\n      .then((annotation) => {\r\n        appendChild(svg, annotation);\r\n      });\r\n  }\r\n  \r\n  closeInput();\r\n}\r\n\r\n/**\r\n * Close the input\r\n */\r\nfunction closeInput() {\r\n  if (input) {\r\n    input.removeEventListener('blur', handleInputBlur);\r\n    input.removeEventListener('keyup', handleInputKeyup);\r\n    document.body.removeChild(input);\r\n    input = null;\r\n  }\r\n}\r\n\r\n/**\r\n * Set the text attributes\r\n *\r\n * @param {Number} textSize The size of the text\r\n * @param {String} textColor The color of the text\r\n */\r\nexport function setText(textSize = 12, textColor = '000000') {\r\n  _textSize = parseInt(textSize, 10);\r\n  _textColor = textColor;\r\n}\r\n\r\n\r\n/**\r\n * Enable text behavior\r\n */\r\nexport function enableText() {\r\n  if (_enabled) { return; }\r\n\r\n  _enabled = true;\r\n  document.addEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\r\n/**\r\n * Disable text behavior\r\n */\r\nexport function disableText() {\r\n  if (!_enabled) { return; }\r\n\r\n  _enabled = false;\r\n  document.removeEventListener('mouseup', handleDocumentMouseup);\r\n}\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/text.js\n **/","import PDFJSAnnotate from '../PDFJSAnnotate';\r\nimport config from '../config';\r\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\r\n\r\n// Template for creating a new page\r\nconst PAGE_TEMPLATE = `\r\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\r\n    <div class=\"canvasWrapper\">\r\n      <canvas></canvas>\r\n    </div>\r\n    <div class=\"` + config.textLayerName + `\"></div>\r\n    <svg class=\"` + config.annotationLayerName + `\"></svg>\r\n  </div>\r\n`;\r\n\r\n/**\r\n * Create a new page to be appended to the DOM.\r\n *\r\n * @param {Number} pageNumber The page number that is being created\r\n * @return {HTMLElement}\r\n */\r\nexport function createPage(pageNumber) {\r\n  let temp = document.createElement('div');\r\n  temp.innerHTML = PAGE_TEMPLATE;\r\n\r\n  let page = temp.children[0];\r\n  let canvas = page.querySelector('canvas');\r\n\r\n  page.setAttribute('id', `pageContainer${pageNumber}`);\r\n  page.setAttribute('data-page-number', pageNumber);\r\n\r\n  canvas.mozOpaque = true;\r\n  canvas.setAttribute('id', `page${pageNumber}`);\r\n\r\n  return page;\r\n}\r\n\r\n/**\r\n * Render a page that has already been created.\r\n *\r\n * @param {Number} pageNumber The page number to be rendered\r\n * @param {Object} renderOptions The options for rendering\r\n * @return {Promise} Settled once rendering has completed\r\n *  A settled Promise will be either:\r\n *    - fulfilled: [pdfPage, annotations]\r\n *    - rejected: Error\r\n */\r\nexport function renderPage(pageNumber, renderOptions) {\r\n  let {\r\n    documentId,\r\n    userId,\r\n    pdfDocument,\r\n    scale,\r\n    rotate\r\n  } = renderOptions;\r\n\r\n  // Load the page and annotations\r\n  return Promise.all([\r\n    pdfDocument.getPage(pageNumber),\r\n    PDFJSAnnotate.getAnnotations(documentId, userId, pageNumber)\r\n  ]).then(([pdfPage, annotations]) => {\r\n    let page = document.getElementById(`pageContainer${pageNumber}`);\r\n    let svg = page.querySelector(config.annotationClassQuery());\r\n    let canvas = page.querySelector('.canvasWrapper canvas');\r\n    let canvasContext = canvas.getContext('2d', {alpha: false});\r\n    let totalRotation = (rotate + pdfPage.rotate) % 360;\r\n    let viewport = pdfPage.getViewport(scale, totalRotation);\r\n    let transform = scalePage(pageNumber, viewport, canvasContext);\r\n\r\n    // Render the page\r\n    return Promise.all([\r\n      pdfPage.render({ canvasContext, viewport, transform }),\r\n      PDFJSAnnotate.render(svg, viewport, annotations)\r\n    ]).then(() => {\r\n      // Text content is needed for a11y, but is also necessary for creating\r\n      // highlight and strikeout annotations which require selecting text.\r\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\r\n        return new Promise((resolve, reject) => {\r\n          // Render text layer for a11y of text content\r\n          let textLayer = page.querySelector(config.textClassQuery());\r\n          let textLayerFactory = new PDFJS.DefaultTextLayerFactory();\r\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(textLayer, pageNumber -1, viewport);\r\n          textLayerBuilder.setTextContent(textContent);\r\n          textLayerBuilder.render();\r\n\r\n          // Enable a11y for annotations\r\n          // Timeout is needed to wait for `textLayerBuilder.render`\r\n          setTimeout(() => {\r\n            try {\r\n              renderScreenReaderHints(annotations.annotations);\r\n              resolve();\r\n            } catch (e) {\r\n              reject(e);\r\n            }\r\n          });\r\n        });\r\n      });\r\n    }).then(() => {\r\n      // Indicate that the page was loaded\r\n      page.setAttribute('data-loaded', 'true');\r\n\r\n      return [pdfPage, annotations];\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Scale the elements of a page.\r\n *\r\n * @param {Number} pageNumber The page number to be scaled\r\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\r\n * @param {Object} context The canvas context that the PDF page is rendered to\r\n * @return {Array} The transform data for rendering the PDF page\r\n */\r\nfunction scalePage(pageNumber, viewport, context) {\r\n  let page = document.getElementById(`pageContainer${pageNumber}`);\r\n  let canvas = page.querySelector('.canvasWrapper canvas');\r\n  let svg = page.querySelector(config.annotationClassQuery());\r\n  let wrapper = page.querySelector('.canvasWrapper');\r\n  let textLayer = page.querySelector(config.textClassQuery());\r\n  let outputScale = getOutputScale(context);\r\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\r\n  let sfx = approximateFraction(outputScale.sx);\r\n  let sfy = approximateFraction(outputScale.sy);\r\n\r\n  // Adjust width/height for scale\r\n  page.style.visibility = '';\r\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\r\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\r\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\r\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\r\n  svg.setAttribute('width', viewport.width);\r\n  svg.setAttribute('height', viewport.height);\r\n  svg.style.width = `${viewport.width}px`;\r\n  svg.style.height = `${viewport.height}px`;\r\n  page.style.width = `${viewport.width}px`;\r\n  page.style.height = `${viewport.height}px`;\r\n  wrapper.style.width = `${viewport.width}px`;\r\n  wrapper.style.height = `${viewport.height}px`;\r\n  textLayer.style.width = `${viewport.width}px`;\r\n  textLayer.style.height = `${viewport.height}px`;\r\n\r\n  return transform;\r\n}\r\n\r\n\r\n/**\r\n * Approximates a float number as a fraction using Farey sequence (max order of 8).\r\n *\r\n * @param {Number} x Positive float number\r\n * @return {Array} Estimated fraction: the first array item is a numerator,\r\n *                 the second one is a denominator.\r\n */\r\nfunction approximateFraction(x) {\r\n  // Fast path for int numbers or their inversions.\r\n  if (Math.floor(x) === x) {\r\n    return [x, 1];\r\n  }\r\n\r\n  const xinv = 1 / x;\r\n  const limit = 8;\r\n  if (xinv > limit) {\r\n    return [1, limit];\r\n  } else if (Math.floor(xinv) === xinv) {\r\n    return [1, xinv];\r\n  }\r\n\r\n  const x_ = x > 1 ? xinv : x;\r\n  \r\n  // a/b and c/d are neighbours in Farey sequence.\r\n  let a = 0, b = 1, c = 1, d = 1;\r\n  \r\n  // Limit search to order 8.\r\n  while (true) {\r\n    // Generating next term in sequence (order of q).\r\n    let p = a + c, q = b + d;\r\n    if (q > limit) {\r\n      break;\r\n    }\r\n    if (x_ <= p / q) {\r\n      c = p; d = q;\r\n    } else {\r\n      a = p; b = q;\r\n    }\r\n  }\r\n\r\n  // Select closest of neighbours to x.\r\n  if (x_ - a / b < c / d - x_) {\r\n    return x_ === x ? [a, b] : [b, a];\r\n  } else {\r\n    return x_ === x ? [c, d] : [d, c];\r\n  }\r\n}\r\n\r\nfunction getOutputScale(ctx) {\r\n  let devicePixelRatio = window.devicePixelRatio || 1;\r\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\r\n                          ctx.mozBackingStorePixelRatio ||\r\n                          ctx.msBackingStorePixelRatio ||\r\n                          ctx.oBackingStorePixelRatio ||\r\n                          ctx.backingStorePixelRatio || 1;\r\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\r\n  return {\r\n    sx: pixelRatio,\r\n    sy: pixelRatio,\r\n    scaled: pixelRatio !== 1\r\n  };\r\n}\r\n\r\nfunction roundToDivide(x, div) {\r\n  let r = x % div;\r\n  return r === 0 ? x : Math.round(x - r + div);\r\n}\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/UI/page.js\n **/"],"sourceRoot":""}